---
title: 给产品经理讲技术
date: 2016-05-22 18:39:07
categories:
- 技术
tags:
- 互联网
---

![](http://img.smyhvae.com/2016052201.jpg)

> 公众号「给产品经历讲技术」的内容整理。

<!-- more -->

| 目录 | 
|:-------------|
| 2015-12-07-什么是HTTP 302跳转？ |
| 2015-12-08-网页与原生App如何交互 |
| 2015-12-09-没推送功能，你好意思叫App嘛? |
| 2015-12-10-谁把苹果6代换成了6袋苹果？——说说下载劫持那些事儿 |
| 2015-12-11-聊聊Android的系统权限 |
| 2015-12-12-React Native-目前最火的前端技术 |
| 2015-12-13-前端和后台的数据交互与协议 |
| 2015-12-14-大伙常见的存储设备简介 |
| 2015-12-15-分辨率越高就越清晰吗？|
| 2015-12-16-讲讲代理服务器 |
| 2015-12-17-GitHub是什么? |
| 2015-12-18-Web语言的浅显理解-HTML、CSS、JavaScript |
| 2015-12-19-平民化跨屏互联解决方案——DLNA简介 |
| 2015-12-20-讲讲应用程序、进程和线程 |
| 2015-12-21-聊聊同步、异步和回调 |
| 2015-12-22-机器配置很好，为什么还是卡？ |
| 2015-12-23-什么是渲染？ |
| 2015-12-24-Docker 简介 |
| 2015-12-25-手机app开发中，关于图片资源不得不知的秘密 |
| 2015-12-26-程序员冒死揭露黑产系列之：Cookie和广告联盟 |
| 2015-12-27-当我们谈论动画的时候，我们在谈论什么 |
| 2015-12-28-互联网上一切皆下载 |
| 2015-12-29-妈妈再也不用担心我的需求赶不上版本发布了 |
| 2015-12-30-如何成功地访问一个网站 |
| 2015-12-31-想让app市场为你的app提示更新，你就要这么干！ |
| 2016-01-01-超级APP诞生记(一)：登陆 |
| 2016-01-02-明修栈道，暗渡陈仓 |
| 2016-01-03-为啥我的Android手机抢不到红包 |
| 2016-01-04-朋友圈中的图片缓存系统 |
| 2016-01-05-不砸钱，如何让你的网站快如闪电互 |
| 2016-01-06-你脱掉了我华丽的外衣－广告过滤机制科普 |
| 2016-01-07-超级APP诞生记(二)：定位 |
| 2016-01-08-“熔断” |
| 2016-01-09-快播已倒下，P2P不死 |
| 2016-01-10-程序员冒死揭露黑产系列之：小心！下个“陈老师”可能是你！ |
| 2016-01-11-你敢使用公共WiFi吗？ |
| 2016-01-12-懂你的推荐算法，你懂的 |
| 2016-01-13-应用号，传统APP的革命？ |
| 2016-01-14-学好技术干百度，今天讲讲多线程 |
| 2016-01-15-如何获取安卓用户的app使用频率 |
| 2016-01-16-扒一扒Android应用的续命大法 |
| 2016-01-17-想念Google？先来学学VPN吧 |
| 2016-01-18-百度野史之白富美与矮矬穷 |
| 2016-01-19-天天鼓捣数据，你知道数据库长啥样吗？ |
| 2016-01-20-万万没想到，未来我们这样看片 |
| 2016-01-21-要想推广好，首先要有码 |
| 2016-01-22-天天鼓捣数据，你知道数据库长啥样吗？（续） |
| 2016-01-23-Toilet Administrator 升职记 |
| 2016-01-24-五分钟理解什么是接口 |
| 2016-01-25-压缩算法浅析 |
| 2016-01-26-产品经理需要掌握的开发技巧之：Chrome DevTools的使用 |
| 2016-01-27-程序员，你整天在忙啥 |
| 2016-01-28-微信红包照片，不给钱怎么看 |
| 2016-01-29-微信红包照片事件后记 |
| 2016-01-30-年会又没中奖？一起来review抽奖代码！ |
| 2016-01-31-琅琊榜-编程语言篇 |
| 2016-01-01-超级APP诞生记(一)：登陆 |
| 2016-02-01-产品后悔药来了，讲讲热补丁技术 |
| 2016-02-02-没线，并不可怕？ |
| 2016-02-03-不得不知的TCP和UDP |
| 2016-02-04-程序员冒死揭露黑产系列之：年产百亿的DDoS攻击 |
| 2016-02-05-2059万淘宝账户被盗，竟然是因为它！ |
| 2016-02-06-提需求的正确姿势是什么 |
| 2016-02-07-听说除夕跟红包助手更配哦 |
| 2016-02-08-Ajax技术的妙用 |
| 2016-02-09-红包抢的好，钱包也要捂紧了——HTTPS技术 |
| 2016-02-10-如何访问家庭服务器？ |
| 2016-02-11-大年初四，让我们一起来动手撸代码吧 |
| 2016-02-12-移动,您还记得那年动感地带的无限流量卡吗？ |
| 2016-02-13-把URL五马分尸 |
| 2016-02-14-IP地址枯竭的后悔药：网络地址转换（NAT） |
| 2016-02-15-乱码导致的悲剧告白 |
| 2016-02-16-你喜欢菊花吗 |
| 2016-02-17-谁是我爸爸？ |
| 2016-02-18-给你点儿“颜色”瞧瞧-RGB通识 |
| 2016-02-19-整天看用户埋点数据，知道数据是咋来的吗？ |
| 2016-02-20-Apple Pay来了，苹果用了什么黑科技？ |
| 2016-02-21-技术进阶：生产者与消费者模式 |
| 2016-02-22-如何让家里畅享360度无死角的wifi上网？ |
| 2016-02-23-3个软件开发中不好理解的名词 |
| 2016-02-24-如何抱上微信的大腿？——说说授权登录的那些事儿 |
| 2016-02-25-你了解计算机时间吗？小心肾6变砖6 |
| 2016-02-26-上帝视角看支付宝隐私门 |
| 2016-02-27-你的包裹到了——说说网络数据传输 |
| 2016-02-28-名词解释：控件、组件、框架 |
| 2016-02-29-讲讲那些被人选择性忽略的技术——Wi-Fi篇 |

打印版本：2016-05-21-v0.1

<br>
<br>




## 2015-12-07-什么是HTTP 302跳转？

Http 302对应生活中的真实例子，可以类比手机所对应的**呼叫转移**功能，这样打进A手机的电话，均转移到B手机接听。

302状态码应用的典型场景是服务器页面路径的重新规划，比如一个portal页面，换了新的域名，但是老的域名地址还有很多用户在使用，这样可以对老域名配置302跳转到新域名地址，保证服务的延续。另外对于一些客户端预埋的Url链接，免不了老版本地址失效与更改，将老地址配置302跳转到新地址，这样就能够全面兼容所有客户端版本。

对302有一个感性全面认知，在浏览器输入taobao.com，进行抓包，如下图，访问taobao.com后，服务器吐回状态码302 Found，然后Locatioin字段标识浏览器应该跳转到了www.taobao.com，从而打开了淘宝网站。对应于不同域名指向同一个地址的情况，大多是这么处理的。

![](http://img.smyhvae.com/2016052202.jpg)


我们先从网址说起，再说浏览器和服务器之间的应答状态码，再谈网络中302的作用以及这个标准的http状态码能够解决什么问题。

在互联网世界里面，已经存在数亿量级的网页，如何管理及标识每一个网页以及方便浏览器寻址到此网页并展示呢？其中，每个网页都对应着一个URL（Uniform ResourceLocation）地址，也叫网址，类似于一个真实世界中的门牌地址一样，真实世界中标识了物理地址（如北京市朝阳区某小区张大妈家的门牌号）。同样道理，网址标识了一个web页面所在的互联网里面的真实地址（这个页面处于www.baidu.com/file/1.html,处于baidu服务器file路径下的1这个文件）。

当你用浏览器点击一个页面链接的时候，随即你看到了一个新的网页展示在浏览器内，在这个过程中，浏览器其实是在不断的接收服务器端的应答（这个应答是服务器端的状态，所以返回码叫状态码），从而来决策下一步来做什么（尽管大部分情况下，你毫无感知的就打开了你想要的页面），这个应答即状态码（status code），在http协议里面，以三位数标识，共分为五类：分别为**1××，2××，3××，4××，5××**。一些常用状态码如下所示：

![](http://img.smyhvae.com/2016052203.jpg)

301和302表示重定向，301表示这个网页已经永久的由服务器的A路径下移动到路径B下，而302表示临时移动到B路径下，对应到Url地址也即http://baidu.com/file/A/1.html到http://baidu.com/file/B/1.html，当浏览器访问前面一个地址的时候，这个时候服务器会告知浏览器，请到B路径下获取这个文件，随后浏览器重新发起网络请求，请求B路径下的页面，经过渲染，呈现给用户，例如淘宝的例子，请求taobao.com，收到302，从而浏览器再次请求www.taobao.com获得页面内容。


## 2015-12-08-网页与原生App如何交互

想想平时用的App，你非常确信在浏览一个网页，然而需要登录时，它却唤起了你手机里的QQ或是微信，你不再需要输入帐号和密码就可以让你浏览的网页获取你的登录信息，这一切只发生在你指尖的两次点击。而在手机上，网页越来越炫酷，你都很难区分你在点击的是一个原生界面（指Native应用程序，说人话就是android app或ios应用）或仅仅是一个H5页面。你的操作一直穿梭在网页与原生界面之间，比如一个网页中的电话号码，点击就可以拨打电话，这种网页和app交互这一切是如何实现的呢？

这项能力在安卓中叫做Js2Java（ios上也提供类似的技术），很好理解，从Js到Java，从网页到app，他们是双向通信，可互相调用的，市面上大量的App程序，都在利用这项技术，**微信更是本质上利用这项技术打造了公众帐号整个体系，使得创业者用一个简简单单的网页就打通了帐号、身份、支付、客服、售后等一系列操作**，虽然简单，但是真的将移动互联网的Web生态囊括了更广阔的内容，也是移动互联网较PC互联网更优越、更猛烈的点之一。

以Android系统为例，Android手机上的App是使用Java语言编写的，而网页中则运行着一些Html、Javascript编写的代码，**虽然Java和Javascript名字看起来像亲哥俩，但它们其实没有一毛钱关系，一个是编译型语言，一个是解释性语言**，不多扩展，说不上哪天我就会写写编译型和解释性语言的区别。Android的App是通过WebView（请亲理解成一个组件，想象WebView就是一个没有任何操作按钮的浏览器，你输入baidu.com他就打开了百度的页面）来展示一个网页的，同时WebView为网页和原生App建立一个桥梁，让网页和原生App能够看到彼此暴露的一些方法，从而达到互相操作的目的。

当然，这些操作是需要前端页面和终端程序互相协商的。虽然很多App遵守了一些相同的原则，使网页在不同的APP中都能具备相同的能力，但是如果你看到同一个网页在一个App中能够调用一些安卓系统的能力，而在另一个APP中却没有对应的能力也不要觉得奇怪（找对应App的开发勾兑一下就好了）。

**一个原生应用为网页开放的能力越多，网页对原生系统的操作能力就越强，就越能做出逼近原生应用的体验**。但是，这却是一把双刃剑，因为原生App开放的能力有可能会被恶意的页面利用，对用户造成伤害，如何控制能力的开放，也是需要产品和开发一起思考的问题。例如微信是一个终端能力的宿主，拥有支付，登录，分享，获取App信息等能力，并以Js接口的形式提供给前端页面使用，前端开发则需要在微信申请对应的**Js接口**使用权限，才能够在微信中正常使用对应的能力。

最后总结一下，网页塑造界面的优势在于灵活，随时**可以更新**，而原生APP塑造的界面则能够提供更流畅的用户体验，但是却**无法热更新**，只能依靠发布版本来提供新功能。通过上面说的这种技术，就可以利用各自的优势，规避各自的劣势来提供更好用户体验，例如在微信中购物的展示是网页形式的，方便运营快速更新，通过Js接口调用起原生的支付界面，给用户更流畅的支付体验，提高支付成功率。

## 2015-12-09-没推送功能，你好意思叫App嘛?

相信大家对推送这项技术并不陌生。如果没听说过，那么作为一个充满好奇心的孩子，你一定想过这个问题：睡觉前我明明关闭了淘宝、网易新闻等app，为什么第二天他们又自动出现在我手机的通知栏上呢？这其实就是推送系统干的好事：在你睡觉的时候，服务器悄悄的向你的手机推送了一个消息，然后唤醒了你已经关闭的app。事实上，无论你愿意与否，现在大多数‘有节操’的app，都已经内置了推送系统，并时刻准备着登上你的通知栏的‘头条’。

![](http://img.smyhvae.com/2016052204.jpg)

传统的app架构里，通常是app**主动向服务器请求数据**，服务器被动的提供数据。以新闻客户端app为例：app被用户打开的时候，会通过网络(无论3g、4g还是wifi)连接到服务器上，向服务器请求最新的新闻。服务器收到请求，从自己的数据库里查询最新的新闻，返回给app。app收到服务器返回的数据，经过一系列的解析处理操作，最终把最新的新闻呈现给用户。一次通信就完成了。然而如果此时服务器上又有了新的新闻，无论多么重要，在用户没有主动刷新的情况下，是没有办法让用户看到的。推送就是为了解决这样的困境的，它给了服务器一个展示自我的机会，主动连接上所有的app，告诉他们我有新的新闻了，你们再来请求一次吧，于是收到推送的app（即时此时已经被用户关闭了）又去服务器请求最新的新闻，这样用户就能看到最新的新闻了。

![](http://img.smyhvae.com/2016052205.png)

从技术上来讲，实现一个推送系统需要服务器端和终端的配合。一种方法是轮询，也就是不停的向服务器发起请求。这其实很好理解，作为app，我既然不知道什么时候会发生新的新闻，那我一遍一遍的问好了，而且我知道这样一定会成功的。显而易见，**这种方法app端费时费力不说，电量流量也扛不住啊**，服务器要处理如此量大的请求，必然也是非常头疼的。另一种方法是服务器和app建立一个长时间连接的通道，通过这个通道，不仅app可以向服务器请求数据，服务器也可以向app发送数据，看起来非常完美，但是如果app被用户关闭的话，通道就断掉了。好在android系统给app提供了一个这样的环境，app可以启动一个后台服务来维持这个通道，即使app被关掉了，服务依然可以运行，通道依然还在工作（ios后面会讲）。回到前面的例子，你在睡觉前关掉了淘宝，但是并没有关闭淘宝的后台服务，淘宝依然可以接收服务器推送来的指令，把自己的唤醒。

那么如何维持这样的一条长时间连接的通道呢？就好比两个人打电话，一开始聊的热情有来有往，后来慢慢沉默下来了，几分钟之后，电话的另一头没有任何动静，如何知道那边的人还在呢？很简单，只需要另一头的人每隔几分钟说一个字就行。同样的道理，app会每隔一段时间向服务器报告自己还活着，就像心跳一样，服务器收到后，就知道这个通道是可以继续使用的了。然而天下没有免费的午餐，发送心跳是有代价的，一般手机锁屏之后，为了省电CPU是出于休眠状态的，然而发送心跳就会唤醒CPU，必然会增加电量的消耗。这还只是一个长连接通道的情况，如果手机里装了2、30个带有推送的app呢？先别急着抱怨，聪明的android工程师和ios工程师早就想到了这一点，他们分别设计了**GCM**和**apns**来解决多个app有多个长连接通道的问题。以apns为例，ios开通了一条系统级别的长连接通道，通道的一端是手机的所有app，另一端是苹果的服务器。app的服务器如果有新的消息需要推送的话，先把消息发送到苹果的服务器上，再利用苹果的服务器通过长连接通道发送到用户手机，然后通知具体的app。这样就做到了即使手机安装了100个app，也只需要向一条通道里发送心跳。

![](http://img.smyhvae.com/2016052206.jpg)

回到Android，系统提供的GCM只能在Android2.2以上才能使用，3.0以下必须要安装Googleplay并登陆了Google账号才能支持。而国内发行的手机大多是阉割掉了google 服务的。因此，对于Android系统来说，各家app只能各显神通，开发自己的专用长连接通道了。然而这时候他们遇到了app的天敌：管家和卫士们。前文说了，app想要及时收到服务器推送的消息，关键在于自己与服务器的长连接通道不被关闭，也就是自己的后台服务可以一直在后台运行，而管家和卫士们的一键清理功能就是专治这种“毒瘤”的。道高一尺魔高一丈，app在与管家和斗士们的长期斗争中，总结了一系列躲避被清理掉的方法，什么定时自启能力、什么相互唤醒、什么前台进程等等，当然这就是另一个话题了,我们后面会讲到。

总结起来，app和后台的连接方式有两种。**一种叫pull**，也叫轮询，就是定期的不断向后台请求，缺点是耗电，费流量，不环保。对于一名有追求的程序员，他应该会比较恶心这种方式的，你千万不要对他说，我不管你怎么实现，我就要这种效果这种傻逼话了，凡事应该找到最优路径。**另一种叫push**，app和后台一直维持了一条通信通道，两端不定期的就会偷摸的约会，告诉对方“I‘m Here”，也能顺带把信息互相携带了。缺点是要维持一条长连接通道，这条通道容易被其他程序杀死，要多想复活办法。

ps：最后赠送一个昨天看到的好文案：

![](http://img.smyhvae.com/2016052207.jpg)


## 2015-12-10-谁把苹果6代换成了6袋苹果？——说说下载劫持那些事儿

今年的双十一，想必广大千手观音们又狠狠的剁了几只手。然而，剁手换来的宝贝在漫漫快递路上也是命途多舛，轻者磕磕碰碰包装损毁，重者与快递货车一起被付之一炬。这些“不可抗力”造成的问题屡见不鲜，碰到了也只能自认倒霉。不过，有的网友看着苹果6代的订单，却啃着寄过来的6袋苹果，个中滋味大家就自行脑补吧...。其实，在安卓应用分发领域，这种“苹果6代”变“6袋苹果”的情况也屡见不鲜：

![](http://img.smyhvae.com/2016052208.jpg)

为什么会出现这种情况呢？其实一次网络下载的过程，就像一次“网购”，当我们点击下载按钮时，就跟下载服务器下了一份“订单”，“订购”了一个文件（当然大部分是免费的），服务器确认“订单”后，就会将文件在网络中“快递”（传输）到用户的终端（手机、PC等）。下载劫持一般出现在“下订单”的过程中。

举个栗子，假设我们通过微信官网的链接http://dldir1.qq.com/weixin/android/weixin637android660.apk下载微信安卓版本的客户端，整个流程大概是这个样子：

![](http://img.smyhvae.com/2016052209.jpg)

当点击了下载按钮后，客户端会通过url中的“域名”“dldir1.qq.com”来向DNS服务器获取确认“订单（下载）服务器”的IP地址，IP地址在互联网中相当于日常生活中“电话号码”，有了它，就可以连接到这台“订单（下载）服务器”，而DNS服务器就像一个存贮着大量“姓名”（域名）和“电话号码”（IP地址）的黄页。

当客户端获得了“订单（下载）服务器”的“电话号码”（ip地址）后，就会连接“订单（下载）服务器”，并告知“订单（下载）服务器”客户端需要获取服务器上的“微信安卓版”apk文件，一般情况下，服务器在这个阶段确认了“订单”后，就会向客户端“快递”（传输）对应的apk文件，当客户端将文件下载完毕后，这次“网购”也就完成了。

下面，我们引入运营商（电信、联通等）**网关**的概念。运营商网关可以类比成日常生活中的“**总机**”，接入运营商的互联网设备想要能够“上网”，都需要经过“总机”（运营商网关）的转接。也就是说，在上图中的第二步，我们并不能直接通过“订单（下载）服务器”的“电话号码”（IP地址）联系到“订单（下载）服务器”，而是需要先连接到“总机”（网关），并且告诉它，我们要向某某某服务器下“订单”，经过“总机”的转接，我们才能真正连接到“订单（下载）服务器”。整个过程如下图：

![](http://img.smyhvae.com/2016052210.jpg)


可以发现，DNS服务器和网关的决策，确定了客户端“订单”（下载请求）的走向。而“下载劫持”也就发生在这两个关键节点上。
假设客户端获取下载服务器“电话号码”的DNS服务器被篡改，那么客户端可能会通过“dldir1.qq.com”查询到一个“骗子服务器”的“电话号码”（IP地址），当我们联系到这个“骗子服务器”时，我们的“订单”（下载请求）可能会换来一些奇奇怪怪的“商品”。

![](http://img.smyhvae.com/2016052211.jpg)

当我们遇到这种情况时，可以手动修改DNS服务器IP（具体方法请问度娘）来解决。然而当运营商的“总机”（网关）“出了问题”（这些“问题”一般是运营商主动造成的）时，就没那么容易解决了。

假设当客户端拿着“订单（下载）服务器”的电话号码要求“总机”（网关）转接到我们指定的“订单（下载）服务器”时，“总机”（网关）对客户端说“哎呀，不要去A家下载微信了，你去我给你介绍的B家下载“XX助手”吧，比微信好用”（这个过程在技术上是被一个叫做302跳转的机制完成的，如果你不知道什么是302，出门左转，查询我们星期一的文章）。客户端是个实在人，就这样被“引诱”到B家的服务器上下载了。

![](http://img.smyhvae.com/2016052212.jpg)


“总机”（网关）和服务器B就这样沆瀣一气，来骗客户端的下载量。

刚刚给大家从技术层面简单介绍了下“下载劫持”的“饭醉手段”，至于为什么有人要做“下载劫持”，想必产品同学们应该比我更能知晓其中的奥妙，我就不班门弄斧了。就写到这里吧，我去洗水果了，双十一寄来的六袋苹果，再不吃就烂了....

（文中“XX助手”和服务器IP地址均属臆造，如有雷同，我也不知道是咋回事儿）

## 2015-12-11-聊聊Android的系统权限

![](http://img.smyhvae.com/2016052213.jpg)

最近很多尝上Android 6.0系统的用户在吐槽，更新某宝应用后要求授予一些系统权限，如果不给权限就不能使用任何功能，真是太傲娇了。不给权限就不让使用，可见某宝对这些权限是多么的饥渴，它拿到这些权限能干些什么呢，今天就来聊聊Android的系统权限。

到目前为止，Android系统提供了135种奇奇怪怪的权限，一个应用想要获得一些敏感信息或者特殊操作，就需要向系统申请对应的权限，这些权限在安装应用的时候会显示在系统的安装向导界面上。在Android 6.0以前，系统有一个特别奇葩的机制，就是你要么接受某个应用申请的全部权限，要么你就不能安装这个应用，大多数用户为了用上这个应用，只有接受它申请的全部权限。Android 6.0版本推出了权限管理，允许用户在安装程序后选择是否授予某些权限，给了用户一个选择的机会，但是像某宝这类应用，还是试图开历史的倒车，不给权限就不给用。

小弟抓取了目前国内top100的热门应用，来看看它们最喜欢的申请的权限是什么，以及拿到这些权限后可用做些什么事情。

- 网络访问权限 100/100

互联网产品，当然要联网才行啦，所以每个应用都申请了这个权限

- 修改或删除外置存储中的内容 100/100

往用户的SDCard上随意读写文件的权限。当你的手机用了一段时间后，发现SDCard上面乱糟糟的，什么奇怪的文件名都有，就是因为这个权限，每个应用都想着你手机里留下一些痕迹。其实为了存储数据，系统给了特定的存储空间，这并不是应用必须要用的权限

- 读取手机状态和身份 98/100

有了这个权限，可以获取到手机的唯一识别码IMEI，很多应用用它来做为单一用户的标识，没什么可怕的。

- 查看WLAN连接 98/100

可以查看用户当前的WiFi接入点信息

- 控制振动 95/100

这个没什么好说，就是要让你手机有动次达次的效果

- 检索正在运行的应用 95/100

可以查看用户当前运行了哪些应用，瞅瞅你平时喜欢用些什么应用，也可以看看竞品的活跃程度:)

- 防止手机休眠 94/100

在锁屏后为了降低功耗系统会进入休眠状态，但是很多应用为了维持后台运行，就会申请这个权限，这也是Android系统比较耗电的原因之一，都是应用不自觉

- 大致位置（基于网络）83/100

O2O这么火的年代，为了提供更个人化的服务，各路应用都希望知道用户的当前位置

- 开机启动 82/100

要想日日夜夜的陪伴，那就得一开机就启动，也是耗电的罪魁

- 相机 80/100

帮你打开相机，扫一扫二维码，拍一拍片片

- 在其他应用之上显示内容 76/100

桌面上那些飘来飘去的东西，或者你正用着一个应用，其它某个APP又突然蹦了出来盖在上面，都是用的这个权限

- 精确位置（基于GPS和网络）76/100

三胖想定点轰炸你，就得用这个权限，获取精确的GPS位置

- 安装快捷方式 73/100

很多应用希望用户更方便的启动自己，都喜欢往桌面上发送一个快捷图标，更有丧心病狂的应用，会发送多个图标到桌面。往往新买一个手机，安装10个应用，桌面上会出现20个以上图标的，就是因为它

- 录音 61/100

每个应用都有一个成为微信的梦想

- 卸载快捷方式 54/100

悄悄的将自(友)己(商)的图标删掉:)

- 读取联系人信息 52/100

大家都对这个权限很敏感，应用有了这个权限，就可以读取你的通讯录，不怀好意的应用还会偷偷上传，哪天你收到垃圾短信也不必奇怪，也许是你的某个好基友“出卖”了你

- 停用屏幕锁定 50/100

你得一直看着我，不要让屏幕锁定了

- 发送短信 44/100

有了这个权限，就可以花用户的钱，给自己发条短信。感觉应用都没有什么正当理由来获取这个权限

- 读取短信 43/100

查看用户的短信，感觉这是老大哥干的事，普通应用拿来是够恶心的

现在大部分Android手机系统都没有升级到6.0的系统，对于权限管理，只有通过一些国产ROM（如小米、华为）内置的工具，可以限制一些应用的权限，或者安装XPrivacy这种root权限下运行的软件来控制，但是终究都不是最好的解决方案。所以说，还是换用iOS吧:)

## 2015-12-12-React Native-目前最火的前端技术

做为一名产品经理，你是否遇到过这样的窘境，“帮我把字体调成16号呗，颜色变成#FFFF00FF，老大说这里最好改一下”，作为一名app的开发只能无奈但心里窃喜的告诉你，“只能等下个版本了，必须要重新发布才能改”，如果你问为什么不能改了就生效啊，那说明你对技术的理解要么真的很差，要么你就是知道这项React-Native新技术所爆发出来的力量。

React Native是Facebook推出的一个用JavaScript语言就能同时编写ios，android，以及后台的一项技术，今年9月发布了android版本，又在程序员里面掀起了一波小高潮，不断有喜欢尝鲜的程序员投入到这个领域。

用大白话说，就是从此一名程序员自己就可以创业了，他只用这一门技术，就可以同时写出androidapp，ios app，以及后台应用程序，并且，请注意这里，它可以做到实时热更新（就像网页一样，改了一个字体，随时可上线），app也能做到随时都能更新了，第一段讲的那个需求可以分分钟秒杀解决，不用新发版本，只需在服务器改动一下代码即可，是不是很牛逼，是不是很牛逼，是不是很牛逼，真的很牛逼。

**到这里，你只需要理解一句话，就是Facebook提供了一套解决方案，它利用JavaScript作为开发语言，可以同时来编写前端，移动终端，后台应用程序。**

我们再来讲讲，为什么React Native受到了如此大的关注，以及它的优越性到底在什么地方。

目前，一个成熟的互联网产品基本囊括了：移动终端和网页两种主要形态。在移动终端app和网页的开发历程中，涉及了很多技术角色：前端开发（俗名叫做网站的），移动终端开发（android和ios开发，现在满大街都是），后台开发（他们的程序大多没有界面，主要是为网页和app提供数据和保障服务的稳定性），每个角色各司其职，分别需要不同的技能，比如前端开发需要精通html，css，javascript这些基本的web语言知识。Android开发用Java（这个词读“扎瓦”，别读成了“加瓦”，读成这样很Low B的）语言编写，ios开发用Objective-c（把他想象成当年过计算机二级的那个C语言就可以了）编写。后台开发，有的公司用Java，有的公司用C++，用啥的都有，能满足性能需要就可以了。

已经看崩溃了吧，对于一个非计算机专业的人，根本不会理解他妈的为什么要存在这么多语言，为什么这里要用C语言，那里要用C++，有的地方要用Python，而又有很大的一个人群对你高呼：“PHP才是世界最好的语言”。其实他们每种语言都有不同的使用场景，有的语言效率高，有的语言语法更简洁漂亮，有的是专为后台而生，有的是特定场景下的唯一选择。**如果你还听不懂，我们就用大白话做个比喻，为什么避孕套有的是螺纹的，有的是颗粒的，有的是延时的，有的是超薄的，还有一个品牌号称一只手就可以打开的，它们也都是依据个人身体状态，以及不同场景分别发挥各自的强项**。你随便类比，任何一个领域，都有很多不同的工具来满足不同的场景，是需求决定了当前状态。

现在好了，React整套解决方案完成了江湖统一，FaceBook也号称这们技术是“Learn Once，Write AnyWhere”，学习成本只有一次，却完成了所有开发角色的统一。

这意味着：

1. app将来都是可像网页一样热更新，随时发布。

2. 对于一名开发人员，将再也没有前端，终端，后台的区分，他所关注的就是做一整套应用程序，人力将得到最大幅度的整合与释放。

3. 代码复用将会是主旋律，因为是一种语言，大家重复造轮子的成本会越来越节省。

目前，React Native也还是有一些缺点的，比如他的sdk组件包size还比较大，crash还比较多，在ios上支持的内容已经相当不错，android还属于初级阶段，但是目前最新的版本也才是0.16，相信再过一年， 一定会牛逼闪闪。


## 2015-12-13-前端和后台的数据交互与协议

目前，除了一些特别简单非联网类应用（比如计算器、闹钟等），几乎所有的应用均是联网应用（比如新闻客户端，微信等等），这些app客户端基本都只是负责用户的交互与数据收集与展示，真正的数据和服务均存储在云端。

那移动端究竟如何和后台来交换数据并展示呢？我们打个比喻，其实整个过程跟去烧烤店儿撸串一样一样的。

拿任意一个新闻客户端举例，当用户刷新的那一刻（你萌生了吃烧烤的想法），客户端开始组织数据请求（你开始穿衣洗脸打扮，并思考该去哪一家吃呢），当用户界面开始展示loading的时候（这个时候你正走在“马大姐烧烤店”的路上），经过几百毫秒的时间，这个时候请求数据已经到了服务器（你已经坐在了马大姐烧烤店的桌子上），服务器开始查看客户端想要请求哪方面的数据，是请求财经频道的，还是请求汽车频道的数据（服务员递来了菜单，问你想吃啥），服务器看懂了客户端的想法开始准备数据（你点了20个肉串，10个大腰子），服务器看到你请求的是汽车频道和财经频道的数据（光着膀子的烤串师傅开始烤这20个串和10个大腰子），并给回到服务员，服务员一路小跑，将你要的串和腰子递到你的面前，这个时候相当于数据已经传回到了客户端，客户端loading消失，你看到了最新的两个频道的数据。

那客户端和服务器之间传输数据的格式是怎么样的呢？

现在流行的做法通常有两种，**一种是类似于PB**（Protocol Buffer，Google定义的一个数据传输协议，以简洁，省流，易用出名）的二进制数据（二进制数据的意思就是你打开这个文件你只能看到0和1组成的数字串，是没办法和你生活中任何认识的字母联系在一起的）传输，这种格式的好处是包小，重复的字段会被节省。**另一种是JSON**（JavaScriptObject Notation），这也是一种轻量级的数据传输格式，就是用一堆中括号把数据组织起来，不像二进制，这种格式是人可读的，并且比较轻巧，所以也有大量的应用场景。下面这段数据就是JSON格式，简单解读一下，就是people对应了三个人，三个人分别是中括号间的三个花括号中的人。

![](http://img.smyhvae.com/2016052214.jpg)

总结起来，十分简单，移动端提出需求，服务器按要求组织好数据发给你，针对不同的格式，移动端自己解析，展示，完活儿。其实，不止移动端，前端网页和后台，后台和后台之间也是这个道理。至于在传输的过程中都经历了什么，我们找机会再细聊。

声明：本公众号所写的全部原创文章，均授权给公众号iamkentzhu自由转载和发布，kentzhu是业界优秀的产品经理，也感谢kent对我们的建议。

## 2015-12-14-大伙常见的存储设备简介

内存、硬盘、U盘这些稍微接触点电脑的的人都会接触到的名词，你能“详细”的说出他们的特性，用途和差异吗？可能我们大多数人说不明白，没关系，相信你读完这篇文章就会发现，TMD我也说不明白。。。


虽然我不能“详细”的给大家介绍，但跟大家做个简介还是可以的，废话少说，下面咱们分门别类来看看各种“存储器”。

![](http://img.smyhvae.com/2016052215.jpg)

**硬盘：**

硬盘是用来存储数据的仓库。看到“硬盘”这个名字，有的同学可能会问，硬盘外面看起明明是个盒子为什么叫个“盘”呢？这是因为传统的机械硬盘（HDD）盒子般的外表下藏着一张（或者几张）盘子的“心”。我们存在电脑上的数据都在这些盘子里，这些盘子的学名叫“**磁盘**”。磁盘上方有一个名叫“磁头”的部件，当电脑从磁盘上存读数据的时候，“**磁头**”就会与“磁盘”摩擦摩擦，魔鬼般的步伐...当然不是真的“摩擦”，它们之间是通过“心灵（电磁）感应”实现交流的。传统的机械硬盘容量已经从G时代步入了T时代，**它的量价比（存储容量/价格）是最大的**（嗯，给日本大姐姐们安家很合适）。

固态硬盘（SSD）是近几年渐渐被普及的新产品，相比HDD来说，固态硬盘的这个“盘”字就有点名不副实了。**SSD用闪存替代了HDD的“磁碟”来作为存储介质**，直接通过电流来写入、读取数据，摒弃了HDD中的机械操作过程，并且SSD的读和写可以将一个完整数据拆成多份，在主控的控制下并行操作，这样就大大提高了读写的吞吐量。一般来说**固态硬盘的随机存取速度（读取大量小文件）比HDD快几十倍甚至上百倍，持续存取速度（一次读取一个大文件）也比HDD快一倍以上**。不过相对HDD来说，SSD还是硬盘界的高富帅，相同容量的SSD的售价可以买十几块同容量的HDD。（所以除非你是“豪”，还是用HDD给大姐姐们安家吧，不过话说回来，“豪”需要硬盘里的大姐姐吗？）

![](http://img.smyhvae.com/2016052216.jpg)

**U盘、SD卡、MiniSD卡和各种卡：**

这几类产品都是用闪存作为存储介质的常用存储设备，不过相比SSD而言，存储容量较小（人家身材好嘛），也**没有复杂的主控电路实现数据的并行写入，所以存取速度上比SSD慢不少**。
U盘的英文名是“USB flash disk”，名字中有个“USB”，顾名思义，这种“盘”经常与电脑上的USB接口插来插去，一般用来做数据中转站。SD卡、miniSD卡和其他卡大多都是换汤不换药，技术类似，但支持的接口不同，这里就不冗述了。
顺便说下，手机中的“内置SD卡”也是用闪存作为存储介质的，只不过它被焊在了手机的主板上。

![](http://img.smyhvae.com/2016052217.jpg)

**内存：**

内存即内部存储器，这类存储器与HDD、SSD和U盘的最大不同点是它们**存储的数据不是直接给人类使用的，而是为CPU的运算提供服务**。

**内存又分“只读存储器”、“随机存储器”和“高速缓冲存储器”**。

只读存储器（ROM）虽说名叫“只读”，但并不是真的只能“读”，当开启“写”模式后，还是可以向ROM数写入数据的。**ROM的特点是读取速度快、写入速度慢并且数据可持久存储**，主要用户保存一些固化（不会被修改）的数据，比如一些智能设备的固件、手机的系统和电脑的BIOS等，咱们常说的给手机刷“ROM”，就是将手机的系统写入到手机内置的只读存储器中。

随机存储器（RAM）的特点是**读写速度非常快，但是断电后数据会全部丢失**，主要用来存取CPU最近一段时间将要用到的数据。因为CPU的数据吞吐量非常大，所以需要用RAM这种高速存储设备来为其提供数据。

高速缓冲存储器（Cache）与RAM类似，不过**它的存取速度比RAM还要快很多，一般会内置在CPU中**，用来储存CPU刚刚用过和马上要用的数据。

嗯，关于存储器就介绍这么多吧，去找大姐姐们约会了~


## 2015-12-15-分辨率越高就越清晰吗？

随着技术的发展，电视，电脑，手机的屏幕越来越大，呈现在我们眼前的画面也越来越清晰，如果要问为什么，一个普遍的回答会是屏幕的分辨率越来越高了，所以我们看到的就更清晰了。那么分辨率高=清晰，这个解释到底正确吗？

在回答这个问题之前，我们先来了解一个必要的概念-“像素”。说到这个词，我不由想到了一个80后共同的回忆。

![](http://img.smyhvae.com/2016052218.jpg)

那些组成各种形状的小方块可以算是明显分辨的“像素点”了，我们在屏幕上看到的所有形状都是由许多的像素点组合而成的。在我们看到的屏幕上，如果这些像素点很明显，我们就会很笼统的说这个屏幕的分辨率很低。那么，分辨率是什么呢？分辨率就是屏幕上像素点的个数，平时我们在描述分辨率时则是用横向的像素点个数*纵向的像素点个数。如果我们越无法分辨单个的像素点，那么屏幕显示的内容对我们来说就越清晰。简单说，如果一个屏幕上的像素点越小，那么它能容纳的像素点的个数就越多，分辨率就越高，就是我们通常会认为的“清晰度越高”。这里引入一个术语DPI(dot per inch)，即每英寸像素数，计量单位 是PPI，我们通常将此作为衡量屏幕是否细腻的一个标准。

再回来想想这个问题，分辨率越高就越清晰吗？之前的分析可以得出一个结论：分辨率是由屏幕决定的，清晰度是由肉眼决定的。那么，影响肉眼识别清晰度的除了屏幕本身的分辨率之外，还有一个非常重要的因素-距离。

乔布斯利用距离这个因素抛出了一个新概念-视网膜（Retina）屏幕。乔布斯是这样阐述的：

**“当你所拿的东西距离你10-12英寸（约25-30厘米）时，它的分辨率只要达到300ppi这个‘神奇数字’（每英寸300个像素点）以上，你的视网膜就无法分辨出像素点了。”**

我们不讨论这些具体的数字是否绝对准确，但我们此时应该明白距离对肉眼识别的清晰度的影响。正因为有了距离的影响，手机，电脑，电视在确定分辨率时就有了不同的考虑。1080P（1920x1080）屏幕在5英寸的手机上达到441像素/英寸（ppi），显示是非常清楚的，即使在28英寸的电视屏幕上也是比较清楚的，只是我们要在更远的距离来观看（源足够清晰的前提下）。

再来说说一些相关的有趣的技术。

**马赛克**：我们在电视上经常看到一些不想上镜的人的面部会打上马赛克，有马赛克的区域初看起来是一堆色块，但是又隐约能看到那里是个人脸。实现的方式很简单，就是将一个像素点的颜色扩大到附近许多的像素点上，达到模糊但又不完全失真的，人为降低“分辨率”的目的。有趣的是，当我们在更远的距离去看有马赛克的图片时，反而会感觉更清楚了。越远越清楚，这似乎是一个哲学结论：不识庐山真面目，只缘身在此山中。看（这）看（是）这（什）张（么）图（鬼）。

![](http://img.smyhvae.com/2016052219.jpg)

**像素游戏**：也是利用这种原理，把本来可以很清楚的画面整得像马赛克般，满足很多人对开篇提到的俄罗斯方块掌机画质的怀念之情。

![](http://img.smyhvae.com/2016052220.jpg)


## 2015-12-16-讲讲代理服务器

代理就是代为处理的意思，现实生活中有很多事情我们不想自己亲自动手，就花点钱找个代理摆平，说的就是这个意思。这年头，各种各样的代理都有。你看到别人名片上写着阿迪王北京总代理，就应该知道他是替阿迪王公司卖鞋的；看到有人喜当爹了，就应该知道他是在替别人的孩子当爸爸。他们有个共同特点，就是**代理和本人干的是一样的事情，外人很难分辨出来**。

切入正题，今天我们要讲的代理服务器，是指在我们上网的过程中访问某个服务器的时候，并不是亲自访问真正的服务器，而是先找了一个代理，由它向真正的服务器发出请求。我们还是拿之前文章《前台和后台的数据交互与协议》里举的烤串的例子形象的描述一下：当你兴致勃勃的出门准备去马大姐烧烤店吃烤串的时候（请求准备发往服务器），忽然发现楼下开了一家张大姐烤串代理店（代理服务器）。这家代理店里和马大姐烧烤店挂着一样的牌子，但是店里却既没有食材，也没有光着膀子的烤串师傅。无论你点什么菜（请求什么样的数据），张大姐烧烤店都会去马大姐烧烤店里现买来给你上菜。所以对你而言，这里是张大姐烧烤店还是马大姐烧烤店并没有区别，甚至有些人稀里糊涂的知道吃完都不知道自己来的是张大姐烧烤代理店。到这里各位看官应该明白了，**代理服务器架在客户端和真正服务器中间，干的是替客户端访问真正服务器的工作**。

那么这里有人要说了，不对啊，小学语文老师教过我们两点之间线段最短，为什么你们不直接去真正服务器拿数据，还要到代理服务器里绕个路呢？这里可能有几种情况：一是真正的服务器藏于千里之外，我们连接不上。马大姐烧烤店因为卫生审查不过关，被城管赶到城乡结合部了。我们找不到马大姐烧烤店的真正地址，但是代理张大姐知道。所以我们以后就只能去张大姐那里吃烤串儿了。二是我们访问真正的服务器的速度太慢，比不上我们访问代理服务器+代理服务器访问真正服务器的速度。也就是说，假如我们走路去马大姐烧烤店要一个小时，去楼下张大姐烧烤店只需要10分钟，而张大姐去马大姐那里开着火三轮，只需要20分钟就到了。况且张大姐还有可能把一些菜储备下来，就没有必要每次都去马大姐那里现取了。还有一种情况，就是通过代理服务器访问真正服务器可以隐藏访问者的身份，保护访问者。就好比你因为多次在马大姐那里吃饭不给钱，上了马大姐的黑名单，这时候就可以让张大姐去马大姐那里点菜了，马大姐只能看到她所信任的张大姐。同理，我们在网络世界中一定要懂得保护自己，一次看似不经意的浏览，背后可能有好多双眼睛在盯着你。他们可以通过各种途径查到你的IP地址，然后上门找到你。所以请记住一句话，代理用的好，不怕查水表。

光说理论太枯燥，我们看几个例子。下面的截图是我们通过百度搜索点开了一个网站，上面提示“原网页已由百度转码，已方便在移动设备上查看”。也就是说，这时候我们访问的并不是这个网站真正的服务器，而是百度提供的代理服务器。这个代理服务器把真正服务器的内容返回给我们的时候，把原网页的内容改成了现在这个样子，“顺便”还插入了自己的广告（下方红框）。张大姐啊张大姐，我就点了盘猪腰子，可你给我推荐你的小女儿是什么个情况？

![](http://img.smyhvae.com/2016052221.jpg)


现在很多手机浏览器都有省流加速功能，其实就是通过代理服务器来达到节省流量的目的。假如我要访问的原网页A需要800K的流量，但是我开启了省流加速功能后，浏览器会帮我自动连接上A的代理服务器B，B从A拿到真正的数据后，进行一些数据的压缩操作，那么我再访问代理服务器B的时候，可能只需要100K就可以浏览网页A的内容了。其实说白了就是代理张大妈烧烤店的菜跟马大妈的菜是一样的，但是张大妈比马大妈的价格便宜一半，顾客当然跟愿意走一遍代理了。

![](http://img.smyhvae.com/2016052222.jpg)

最后回到开篇引言，三胖看到的是一台代理服务器，即使他炸了这台服务器，也找不到躲在代理后面的1000万个网络斗士们。今天各位了解了代理服务器的原理和用途，维护世界和平的任务就交给你们了。


## 2015-12-17-GitHub是什么?

大家应该多多少少都听说过GitHub这个网站，有的人认为它是一个代码托管网站，有的人认为它是一个博客网站，还有的人知道**它是世界上最大的程序员（同性）交友网站**。

![](http://img.smyhvae.com/2016052223.jpg)

在聊GitHub之前我们先来说说Git，这是Linux的创始人Linus Torvalds创作的一种版本控制软件。与平时大家听说的SVN这种集中式版本库不同，**Git是一种分布式版本库，它在离线时也能正常使用**，这样使得开发人员可以随时提交代码，在联网时同步一次即可。同时，Git有着速度快、出色的合并追踪能力等特点，加上开源社区对它的不断完善，使得Git越发的流行。

随着Git的流行，**GitHub也就应运而生了，它为使用Git做为版本控制的软件项目提供代码托管服务，同时注入了社交网络的属性**。简单的说，在GitHub上面，你可以提交你自己写的代码（发微博）、关注（粉）某人、关注（赞）某个项目、添加评论、Fork（转发）一个项目来自己修改，这些功能和微博都是一样的，只是将我们的吐槽换成了由各种编程语言写的代码。GitHub还提供了一个榜单，也就是热门微博的功能，在上面可以查看最近一段时间最火的项目是什么，下面的截图是最近一个月的热门关注榜单，其中不乏一些知名公司的开源代码。

![](http://img.smyhvae.com/2016052224.png)

**GitHub中最核心的功能就是Fork&Pull Request**，用户可以简单的复制一个项目，然后增加自己的修改，并将修改贡献回原项目。让我们想象一下，一个用户在GitHub上闲逛，发现了一个项目叫youtube-dl，这是一个下载YouTube视频的工具，觉得挺有意思的，不过这哥们是个宅男，觉得只能下载YouTube的视频多没意思啊，还要能下载AB站的视频也能满足自己的需求嘛，于是乎，Fork了这个项目，啪啪啪闷头苦干三天，把下载AB站视频的功能也加上了，然后向原作者发送一个Pull Request，请求将这个功能合并回项目，原作者只需要简单处理一下，所有使用youtube－dl工具的人便也可以下载AB站的视频了，这样宅男同学也获得了一次开源贡献的成就。当一个用户贡献了越多的代码，他也能收获更多的粉丝与关注，当然也能交到更多的好朋（基）友了，这些都能使他内心的成就感爆棚。

那为什么说GitHub是一个博客网站呢？当GitHub上的用户越来越多的时候，总会出现那么几个脑洞大开的人，他们觉得GitHub既然可以托管代码，那么也可以托管普通的文本文件啦。于是，一开始他们上传文本文件，后来上传网页文件，最后他们干脆开发了一套自动化的博客工具，将GitHub变成了一个博客网站。在上面，你可以创建一个项目专门用来存放你的个人站点，只需要一套博客框架，然后将自己的文章简单处理一下，就可以通过xxx.github.io来访问你的站点了。

其实GitHub还是一个招聘网站。经常看到很多互联网公司的HR都在抱怨，现在招人难，招个靠谱的人更难，于是HR里面也会出现那么几个脑洞大的人，他们就去GitHub上逛逛，找到那些符合自己招聘方向的程序员，点开他们的个人页面逐个查看，他们平时的编程水平、代码质量、协作能力都一览无余的展现在面前，这比起成天面对一堆打嘴炮的简历不知高到哪儿去了。

一个单纯的代码托管网站被玩出这么多花样，在下也是服了。


## 2015-12-18-Web语言的浅显理解-HTML、CSS、JavaScript

HTML、CSS、JavaScript共同构建了你看到的任何一个网页展示和交互。

- HTML(HyperTextMarkup Language) 超文本标记语言

- CSS（Cascading Style Sheets）级联样式表

- JavaScript 一种脚本语言，主要用于前端页面的DOM处理

看见这几个词，你大概不知所云，这些命名其实都是屁话，总要对一个标准起一个显得牛逼哄哄的名字，其实一点都不难，我们先来类比，再动手自己写一段最简单的网页，带你看看他们的真面目。

文本的意思，应该大家都明白，就是你随手在桌面上建立一个txt，这就是一个文本文件。

那什么是HTML超文本标记语言呢？超文本就是超越文本的意思呗，超越文本的意思就是它已经不仅仅是简单的文本，比普通的txt要高级一些，那到底高级在哪里呢，是第二个词Markup（标记的意思），就是对一个普通的txt里面的文字进行标记，标记其中的一段为title，标记另一段应该另起一行，标记任意一段为某个意思。最后超越了普通文本的标记，这些记号对普通文本的修饰，就构成了一套规则，这套规则就是html，我们来看一段html，打开taobao页面，然后查看他的源代码：

![](http://img.smyhvae.com/2016052225.jpg)

“亲，请登录”，“免费注册”原先都是普通的文本，但是他外面套了很多的`<a>`, `<li>`,`<div>`，从而在网页上有不同的摆放方式，以及定义了点击之后跳到哪个网页去。

**简单理解起来，就是你要盖一个房子，你必须定义这个房子有多长多宽，每一块面积都用来做什么，比如，哪里是卫生间，哪里是饭厅，哪里是啪啪啪的地方，这些定义好，这个网页也就有了最基本的样子，上面截图里面“亲，请登录”，“免费注册”是排在页面左上角的位置。HTML就是用来布局网页中的每一个元素的，理解到这个程度，就够了。**

CSS中文名叫级联样式表，也是一个超别扭的名字，但是样式大家都应该懂，就是长什么样子，类比到生活中，就是HTML只是你的肉体，你总要穿上衣服，戴上牙套，穿双鞋再出门吧。再举刚才盖房子的例子，你定义好了各个空间，并且房子也盖起来了，你要装修，比如客厅用什么壁纸，卧室的地板用什么样子，**CSS就是起装修作用的**，必须要和HTML一起配合使用。

JavaScript是一种脚本语言，他在网页中使用的主要场景是控制HTML中的每一个元素，有时候可以把有些元素删除，有时候要添加新元素，你常常遇到过这样的场景，点了一个按钮，这个时候会有一个网页上从没有过的元素出来，其实就是利用JavaScript实现的。你的房子已经装修好，贴上了墙纸，铺上了地板，桌子，板凳，沙发都已经摆好了，一切都完美了，可是一切都是静态的，作为一个有生活情趣的人，你总是要买些新家具，或者想把茶几换个位置，这个时候这种在这个屋子里的所有移动，添加，减少物件就只能靠JavaScript实现。

我们来看一段最简单的HTML、CSS、JavaScript实现：

![](http://img.smyhvae.com/2016052226.jpg)


你打开任意一个文本编辑器编辑一个txt，输入上面的代码之后，然后更改这个文件的扩展名为html，在浏览器打开，就是展示成这个样子，虽然有点丑，但是应该基本的原理还是讲清楚了的。

![](http://img.smyhvae.com/2016052227.png)

当前互联网上的任何一个网页，都是由他们三个构建起来的，虽然简单，但你不可不知。

## 2015-12-19-平民化跨屏互联解决方案——DLNA简介

![](http://img.smyhvae.com/2016052228.jpg)

随着时代的发展（小学作文经典开场），曾经的客厅霸主（电视）也已经走下了神坛，取而代之的是广大低头族手中各式各样的手机，大伙儿的日常生活也从单屏(电视)时代步入了多屏（电视、电脑、智能手机、pad）时代。

多屏共存，必然会带来数据共享的问题，比如当你正在书房电脑上看电影，却突然想去洗手间的时候；当你正在客厅看电视，却突然想去洗手间的时候；当你....想去洗手间的时候，手纸可以带在身上，但是视频却带不走，这时候，你就需要多屏互联的技术帮你解决“洗手间问题”。

当前主流的多屏互联的解决方案主要有DLNA、Airplay、Miracast和Chromecast，这里主要介绍下DLNA。

DLNA是数字生活网络联盟的简称，同时也代指该联盟提出的多媒体共享方案。DLNA定义了一些逻辑上的功能模块如DMS（数字媒体服务器）、DMR（数字媒体渲染器）、DMC（数字媒体控制器）和DMP（数字媒体播放器），同时也定义了这些模块之间的交流方式。

一台DLNA设备（至少支持DMS、DMR、DMC和DMP）功能被开启时，它会按照DLNA的制定的标准用UPnP向网络中的其他设备询问是否有其他DLNA设备，并对其他设备介绍自己具有的能力。当两个相互发现后的设备能力匹配时，就可以进行交互了。

假设我有一台支持DMC功能的手机和一台支持DMR功能的电视，并且都已经连接了家中的路由器。我用手机在网络上搜索到了一部在线电影，但是觉得手机的屏幕太小了，想用屏幕更大的智能电视播放这个视频，这时，我就会打开手机的DLNA功能，手机就会在WIFI网络中发送一条广播：“hi，网络中的伙计们，有没有谁可以支持流媒体在线播放？是MP4格式的。”当智能电视收到这条广播后，发现自己可以完全满足播放需求，就会对手机说“hi，哥们，我这里可以播放你说的这段视频。”这时交互界面上就会显示“发现一台DMR（智能电视），是否在此设备上播放？”当我点击“确定”后，手机就告诉智能电视“喏，这里是流媒体的播放地址，等下听我号令~”，同时，在手机的交互界面上，就会出现控制视频播放的控制面板，点击播放按钮后，视频就在智能电视上开始播放了。播放过程中我还可以通过手机上的控制面板控制播放的暂停，快进快退等。

如果是下载到本地的视频资源，我们只需通过DMS功能将视频资源共享到局域网中，然后DMC就会发现DMS中的视频，并通过前述步骤将其投放到DMR上。

DLNA是一套开放的标准，任何符合该标准的设备都可以随时随地的加入DLNA大家庭，不像Airplay一样局限于“苹果系”的设备，也不像Miracast和Chromecast一样需要系统和硬件级的支持，所以它是名副其实的平民化的跨屏互联解决方案。并且在互联网上也可以随处找到DLNA的开源项目，所以广大产品同学们如果对这个功能感兴趣的话，马上拿起你手中的皮鞭，走到程序猿面前狠狠地说："快！一天之内把demo做出来！"。哦，不，半天吧。。。。

## 2015-12-20-讲讲应用程序、进程和线程

相信看到这篇文章的每一位同学都下载、安装、使用过应用程序（比如微信），所以应用程序的概念大家肯定或多或少的接触过，最直观的概念就是应用程序是一个具有特定后缀的文件，比如在ios上是ipa文件，在安卓平台上是apk文件，在windows平台上是exe文件，也是广大程序猿同胞们在产品经理的鞭策下加班加点，废寝忘食的工作后，最终输出的“产品”。它包含“数据”（默认的用户信息、图片等）和“逻辑”（做什么事，完成什么任务等）。

应用程序都是用来“应用”的，也就是我们平时所说的“打开”、“运行”某个应用程序。在每个平台上，**应用程序都会有一个供操作系统使用的“入口”**，这个“入口”就是让系统通知应用程序“运行”的关键所在，也就是系统启动应用程序的门户。当我们点击桌面上应用的图标，系统就会收到一条指令：“启动XX应用”，这时系统的应用加载器就会找到应用程序的安装目录，并为应用程序创建一个“进程”，进程创建后，系统就会利用“入口”把应用程序的“逻辑”和“数据”加载起来，并**根据应用程序的需要为进程分配资源**，如内存、cpu等，这样，应用程序“运行”的条件就满足了。**进程中会包含若干“线程”，这些“线程”共享进程的资源**，并且按照应用程序中指定的“逻辑”完成既定的任务，如启动闪屏，播放视频，响应用户的交互操作等。

相信经过上面的介绍，相信大家对应用程序、进程和线程的概念已经被我带到云里雾里了。没关系，下一段已经准备好了一个栗子。

2015年12月某日，XX公司的文宣部的同学们冥思苦想，制定了一份“2016年XX公司元旦晚会计划书”，详细叙述了2016年公司元旦晚会从筹备到晚会结束的每一步细节，并将计划书上报给了主管，说如果公司今年按这个计划书中的描述准备元旦晚会，广大员工会在晚会现场受到鼓舞，明年大家的业绩肯定会翻番！主管经不住文宣部同学的忽悠，就将这份计划书提上了日程，并建立了“2016年元旦晚会筹备组织委员会”，分配了演出场地和活动资金。“委员会”拿到资金和场地后，内部创建了“场地布景组”、“服装道具组”和各“节目组”。“场地布景组”负责对主管分配的场地进行设计、布景，“服装道具组”负责采购道具和演出服装，各“节目组”负责组织人员排练节目。各小组的经费都从委员会活动经费内支出。就这样，各小组各司其职，紧锣密鼓的进行着自己的工作，并在2016年元旦当天为大家奉献了一场精彩的晚会。

在上面这则真实而感人的故事中，“计划书”就是“应用程序”，详细描述了晚会筹备工作的过程、步骤（应用程序的逻辑）和所需的场地和资金（数据）；“委员会”是“主管”（操作系统）创建的“进程”，它拥有“计划书”（程序）执行过程中所需的场地和资金（cpu、内存等）并代表了“计划书”（应用程序）的一次执行（委员会解散，整个执行过程也将终止）；“委员会”（进程）内部又创建了各个工作组（线程），来执行具体的任务（响应用户交互等），并共享“委员会”（进程）的所有资源。

现在，你明白应用程序、进程和线程之间的关系了吗？


## 2015-12-21-聊聊同步、异步和回调

有一天，你找到公司刚来的程序员小T，跟他说：“我们要加个需求，你放下手里的事情优先支持，我会一直等你做完再离开”。小T微笑着答应了，眼角却滑过一丝不易觉察的杀意。

切入正题。世界上的所有事情大致可以分为同步去做和异步去做两种。你打电话去订酒店，电话另一边的工作人员需要查下他们的管理系统才能告诉你有没有房间。这时候你有两种选择，一种是不挂电话一直等待，直到工作人员查到为止（可能几分钟也可能几个小时，取决于他们的办事效率），这就是同步的。另一种是工作人员问了你的联系方式就挂断了电话，等他们查到之后再通知你，这就是异步的，这时候你就可以干点其他事情，比如把机票也定了之类的。**同步和异步的区别就在于，在下达了执行任务的命令后，是等到执行完成之后才能得到结果呢，还是马上就知道了结果（尽管是不确定的答案）**。

计算机世界也是如此。我们写的代码是交给CPU去执行的，在这个过程中经常面临是让CPU同步执行还是异步执行的选择。比如我写了一个APP，它可以帮你下载网络上的一个文件。当你输入一个文件的网址，按下下载按钮的一瞬间，CPU就收到了一个下载文件的任务。我们先想象一下同步执行时什么情况。CPU立刻停掉了手头的事情，包括绘制界面、对用户的点击做出响应等等，倾尽全力去帮你下载文件。但是，这时候你会发现，你的屏幕再也没有响应了，整个系统就像死了一样（废话，CPU都被你的下载任务抢走了）。过几秒钟，如果是Android系统则会弹出一个下面图1的提示，用户非常感动，然后无情的卸载了这个APP（尼玛裤子都脱了，你让我看这个）。同样的情况异步执行要好很多。CPU马上告诉你任务已经被受理了，等下载完成我会通知你的。于是呢，屏幕照样刷新，用户点击都能做出处理，就好像没有下载过一样。然而CPU并没有闲着，它开启了一个线程，专门处理这个下载任务（还记得之前讲过的线程的概念吗？不用担心我们下面会详细讲）。过了几个小时下载完了，你会收到一个通知，告诉你任务执行的结果（图2）。

![](http://img.smyhvae.com/2016052229.png)

图1

![](http://img.smyhvae.com/2016052230.png)

图2

一般情况下计算机通过多线程来实现同步，你可以把线程看做是富土康生产iPhone的一条生产线。它给生产一台完整的iPhone提供了所有必须的资源：包括人力，原料，设计图纸等等。生产任务来的时候，如果是同步的，那一条生产线就够了，所有的小伙伴们蜂拥而上，不一会儿就搞定了。如果是异步的，那就必须新建一条生产线（好在CPU创建线程的成本并不高），分一部分资源到新的生产线上，这样可以同时生产两台手机。那么生产线可以无限制增加吗？答案是不行的。**一是异步会面临资源竞争的问题**。比如说8条生产线都要组装电池，但是电池原料只有4份，那么必然会存在其他4条生产线等待的其情况，如果资源竞争比较频繁，甚至异步的执行效率要低于同步。**二是异步会导致状态难以管理**。比如车间主任想要统计一共生产了多少iPhone，就必须要询问完所有生产线才能得出结论，而且这个询问过程必须要停掉所有的生产线，同步来做。

讲到这里，回调的概念呼之欲出。上面异步任务的整个过程是首先你要把自己的信息给异步任务执行者，等执行完成的时候，执行者可以通过这些信息找到你，并给你一个通知。把自己信息给别人的过程叫做注册，别人找到你给你通知的过程就叫做回调。上面的例子，你把自己的联系方式给了酒店工作人员叫做注册，工作人员完成任务后联系你叫做回调。**但是回调的概念其实非常广，这里可以抽象成先把要做的事情注册给别人，等条件满足的时候别人再回过头来调用你的模型**。程序上响应一个按钮点击之后要做的事情也是用回调来做的。程序员先把用户点了按钮要做的事情先写好（比如要下载文件），注册给系统。等用户点击到按钮的时候，系统就会回调你下载文件的代码。

回到开篇，了解了同步、异步以及回调之后，你会这样跟小T说：”我们要加个需求，你抽时间支持下，等你做完了记得通知我。“小T欣然理接受，眼角闪过理解万岁的泪光，回头就把这事儿忘了。


## 2015-12-22-机器配置很好，为什么还是卡？

在讨论这个问题之前，我们先来了解一个概念I/O。简单来说I/O就是输入/输出(Input/Output)，小至我们的手机，电脑，大至整个互联网，所有的设计都离不开I/O。I/O在电子信息的世界里负责信息的传递，就如同我们的吸气、呼气一般平常而又不可或缺。广义上来讲，它并不仅限于在计算机世界使用，形象点说，如果大脑是CPU，I/O设备在人与人之间的交流中扮演着类似嘴巴和耳朵的作用：嘴巴是输出设备，负责输出经过大脑思考后的各种信息，耳朵则是输入设备，用于接收各种各样的信息，传递给大脑。

作为一个APP来讲，如果抛开里面的逻辑部分，**APP所做的事情就是将用户的输入内容写入内存，从内存写入硬盘，或是将硬盘的内容读入内存，再通过输出设备展现给用户**。一个APP能否将这整个过程流畅的完成是衡量这个APP质量好坏的重要标准。

就目前的技术发展而言，CPU的处理能力已经非常强大，我们日常使用的APP所需要处理的逻辑部分对CPU来说完全算不上负担，但是我们的硬盘，网络的读取速度却远远跟不上CPU（网络也是一个巨大的I/O系统，你可以想象成你的个人设备通过有线或者无线的信号连接到了因特网的巨大硬盘上，只是你不知道硬盘放在哪里）。

I/O速度上，内存>硬盘>网络。为了减小这种速度上的差异，在APP设计乃至硬件设计时都会设置缓存。我们在说到缓存时，并不是指设备上的某个具体硬件，它是硬件和软件设计的一种策略。

缓存对我们来讲比较熟悉的就是在线视频了，爱看的电视剧缓存个几集，便于随时拿出来看。这里的缓存实际就是指下载下来存到本地。

那是否我没有存下来的需求就不需要缓存呢？不是的。因为网络环境差异大，且不是足够稳定，所以一般的视频APP在设计时，会在用户播放的同时也预先下载一部分到本地作为缓存的文件，这样在网络发生波动时（如短暂的网络连接异常），可以通过读取缓存文件保持播放的连续性，用户则不会感觉到视频的卡顿。这是一个解决网络I/O和本地I/O速度差距例子。**不仅网络和本地设备存在I/O速度差，设备内部组件之间也是如此，虽然内存已经足够快了，但是内存跟CPU之间还是需要高速缓存来弥补二者速度上的差距。**

一个程序在运行时，会进行各种I/O操作，可能要从网络中获取一些数据，可能要对数据库进行读写，可能需要加载用户硬盘上的图片，虽然I/O操作看起来比较简单，但程序在实际处理时还是会遇到很多问题。I/O设备存在独占和共享的问题，例如正在播放音乐的时候来电话了怎么办？I/O操作也存在各种各样的顺序问题，例如在一个文件既要被读取，也要被写入怎么办？如果不对各种I/O操作做优化处理，即使CPU很空闲，内存也很充足，也会引起各种卡顿问题（当然不仅仅只是卡顿）。


## 2015-12-23-什么是渲染？

渲染这个词，在计算机世界里可以说无处不在，这个词的理解对于理解一切电脑或手机上的展示与呈现至关重要，渲染的意思是呈现，也就是显示出来的意思，浏览器呈现的是html，游戏里面呈现的是3D人物或地图，手机App里面呈现的是各种界面。

一个画家要画一副油画，我们看看整个过程是什么样的，他首先在脑中构思，在油画的三分之一处画一个房子，门前有一条小溪，房子后面有一座小山，然后他用铅笔将每一个物体的轮廓勾勒出来，并对每个物体的摆放位置不断调整，直到符合他的构思，这副画的骨架已经搭建完成，下一步才是用不同的色彩将每一个部分细致的按照自己的逼格不断完善。

计算机、浏览器、手机app的渲染道理一模一样，你在显示器上看到的一切也都经历了类似的过程，大致分为三步：测量、排版、绘制。拿支付宝手机App举例，我们进入界面之后看到了那么多按钮或TAB，计算机是如何知道哪个按钮该摆在何处，应该多宽多高，以及程序启动的时候应该是呈现出什么样子呢？

计算机里面存储的全部是01组成的串（这些串既有程序代码也有相应的数据），他们静静的躺在你的硬盘或sd卡中，当你点击手机app上的支付宝图标的时候，这个时候存储设备中的代码和数据迅速被载入内存，并加载执行。

当程序运行到构造界面的时候，这个时候计算机像画家一样开始测量，每一个按钮的宽高（其中是有一大堆算法或者说规则在默默的计算，比如一个按钮在另一个上方，如何不和其他的按钮重叠等等）。知道了多宽多高之后，计算机开始计算每一个按钮应该摆在屏幕上的什么位置。大小、位置都明确之后，计算机开始绘制，也就是把相应的颜色或者图片资源从CPU输送到显卡，显卡把这些数据发送给显示器的缓冲区，屏幕的下一次刷新将这些新数据更新到显示器上，整个渲染(呈现)过程结束。

说了很多废话，**想说清楚的是，渲染是通过一些列计算并呈现的过程，其中包括测量、排版、绘制。你在任何屏幕上看到的任何一个图形，无一例外，都经过了这三个过程。**

下次和程序界的朋友沟通展示慢，顿问题的时候，你可以很随意的说句，感觉整个渲染过程不是很流畅，保证你们的交流会很得心应手。

明天见，我不会告诉你明天我要讲什么的:)。


## 2015-12-24-Docker 简介

最近听了一期罗辑思维，聊的是《改变世界的箱子》，这个箱子就是集装箱，它将物流运输过程标准化为以一个箱子为单元，简化了运输流程，同时也降低了物流成本，因而造就了一个高度自动化、标准化和低成本的物流体系，极大的促进了经济全球化。这让我想到，最近在程序界也出现了同样的一个箱子，那就是今天要聊的Docker容器。

软件开发中需要面对的一个挑战就是环境管理问题，因为软件并不是独立运行的，它依赖了很多其它的软件，包括操作系统、运行时、依赖库等等，而且对每个依赖软件还有版本要求，有一个依赖关系稍微不对，那就可能造成软件的运行异常。产品同学应该有过这种经历，从开发哥那里要一个最新版的软件来体验功能，结果装在自己的电脑上打开就挂掉，这个时候找开发哥来解决，开发哥一看就会说“哦，你这环境不对，换个Win8吧，这软件只能在Win8以上运行”，或者说“这个软件需要.Net框架，你装个.Net就好了”。

![](http://img.smyhvae.com/2016052231.jpg)


其实解决依赖环境的办法很简单，那就是所有机器都用同一套环境。但是对于一些web服务，它所依赖的软件及关联软件可能有上百个，让你去配一台机器已经要吐血了，如果让你把这个服务发布到100台不同的机器上，那么你就应该会阵亡了。同时，很有可能因为不同的机器已有的环境不同，你安装这些依赖的同时还要保证不能影响其它已有应用。

说了这么多，其实就是三个大问题，如何解决环境依赖？如何解决大规模部署？如何解决应用与应用的互相影响？Docker就是这些问题的一种解决方案，它是一个容器，也可以说是一个软件集装箱，这个箱子里面可以塞入特定版本的操作系统、数据库、服务器程序和web应用，这样一套完整的web服务就集成在这个箱子里面了，当要发布服务的时候，直接将这个集装箱放在我们的服务器船上。如果你想发布到100台机器上，没问题，只需要ctrl-c ctrl-v，将这些集装箱复制到100台机器上，它不会在乎船的配置高低，只要能放得下就行。如果你想发布10个不同的服务，还是没问题，你只需将这10个不同的集装箱依次排列在服务器船上，它们之间完全不会互相影响，因为各自被锁在不同的箱子里。

![](http://img.smyhvae.com/2016052232.jpg)

有的同学可能会说了，这不就是虚拟机嘛...是的，Docker算是一种轻量级的虚拟机，它比起传统的虚拟机更快，更节省资源。打个比方，虚拟机就是轮船上的豪华包间，即使它用不了这么多资源，它也霸占着不让别人使用，而Docker容器就是一个简单的集装箱，它只占据它需要的资源。

Docker技术目前才刚刚开始流行，它能不能改变程序世界，让我们拭目以待吧~


## 2015-12-25-手机app开发中，关于图片资源不得不知的秘密

相信广大的产品经理同学肯定希望自己的产品UI能够美美的，让用户们赏心悦目。要做到这一点，主要就靠咱们伟大的视觉设计师出的各种图片资源。小到应用程序的图标或者按钮，大到启动时的闪屏，无不是出自设计师之手。当图片被打包到程序中后，他们就被正式的赋予了为广大用户谋眼福的使命。

然而，**图片的大小是固定的，而使用图片的设备分辨率却千变万化**。比如一张1280×720分辨率的全屏闪屏图片，可能会被加载到1080P、720P、480P甚至320P的设备上，除了720P的设备外，在其他三款设备上1280×720的图片都会产生“缩放”。我们都知道，图片的内容都是由像素组成的，比如1280×720的图片由921,600个像素构成，720P的显示设备屏幕上也正好是921,600个像素，这样图片的**每一个点都可以与屏幕上的点一一对应，进而完美的呈现图片的细节**。

480P乃至320P的设备，他们屏幕上的像素点个数远远小于921,600(480P设备38万个像素点，320P设备15万个像素点)，屏幕上的像素无法做到与1280×720图片像素的一一对应，这种情况下，**为了让低像素数的屏幕能够完全呈现高像素数图片的内容，图片的一些细节（像素）就会被丢弃**，以480P的设备为例，1280×720的图片就会被显示成800×480个像素，图片看起来被“缩小”了，也就是系统对图片进行了“缩放”。这种“尺寸”（分辨率）从大到小的缩放会丢失一些细节。

当1280×720的图片被加载到1080P（207万像素）时，情况就更糟了。我们期望自己的图片可以占满用户的屏幕，但是**即便把图片中的每一个像素都一一对应的填充到屏幕上，还是会有一半的像素没有内容**，这种效果大家可以想象。

不过好在聪明的软件工程师们早就实现了一系列的方法来让大家避免陷入这种图片被“放大”或“缩小”后图片质量变差的窘境，这些方法被叫做“插值算法”。顾名思义，**“插值算法”就是在原有的像素值基础上，插入或修改一些像素值，并尽最大可能保证原图的特征**。当前比较流行的插值算法主要有“邻近插值”和“双线性插值”，具体的算法这里不再冗述，感兴趣的同学可以在网上随处搜到。下图为大家举个栗子，给大家直观的感受下效果。

![](http://img.smyhvae.com/2016052233.jpg)

通过上面两段的描述，我们可以看到，当图片的内容无法与屏幕上的像素点进行一一对应的时候，就会产生“缩放”，虽然当前有一些手段可以尽量的避免缩放对图片质量造成的影响，但显示效果或多或少都会收到影响，并且缩放的程度越大，效果损失的越严重。所以有的系统会提供另外的机制尽量避免“缩放”的产生，或者把“缩放”带来的副作用降低到最小。比如**安卓系统就为应用程序的图片资源定义了一组文件夹，每个文件夹对应一种屏幕的像素密度/分辨率，在不同像素密度/分辨率的设备上从对应的文件夹中取图片资源，尽量的减少或避免“缩放”，进而最大化的还原设计师们的原始设计。**

## 2015-12-26-程序员冒死揭露黑产系列之：Cookie和广告联盟

小弟这几天犯病了，听朋友说百度上推荐的医院非常靠谱（交友不慎TT），就去搜索了一下。但是，后来有一天在浏览一些技术博客的时候，在一个不起眼的角落发现了和之前搜索内容相关的广告。

相信大家都有相同的经历，在浏览网页的时候，有的广告竟然知道我近期搜索过的关键词，也有一些广告竟然知道我近期要买的东西。那到底是什么东西悄悄的把我们的信息出卖了呢？答案就是本文的主角：Cookie。

之前的文章讲过我们浏览一个网页的时候，浏览器在做什么事情。它不断的向服务器请求数据，服务器不断的回答数据。但是这个过程有个缺点，就是每次请求都是独立的，服务器并不会记下客户端的信息。打个比方说，你每天都去楼下马大姐那里吃烤串儿，但是马大姐记性不好，你一走她就不认识你了。这时候你就想，如果我每次去吃烤串的时候，主动给马大姐提供一些自己的身份信息，说不定还能打个折呢。这个身份信息，在技术上就叫做Cookie。

**Cookie是浏览器每次向网站服务器请求数据的时候，携带的一些额外信息，这些信息一般非常少（最多4KB），主要就是为了解决服务器记性不好的问题**。当然Cookie究竟需要携带什么信息，其实是由服务器决定的，比如你登录了新浪微博之后，服务器就会要求浏览器把你的账号写到Cookie里，下次你请求你的关注列表，浏览器就会带上这个Cookie，一起发送到服务器，这样服务器就会知道你是谁了。

![](http://img.smyhvae.com/2016052234.jpg)


下图是小弟访问了百度之后产生的Cookie。看不懂是吧？没关系，我也看不懂，这种经过加密的信息估计只有他们的程序员和产品经理才知道是什么意思。但里面肯定有我们搜索过的关键词的信息。**这样的Cookie，每个网站都会有很多，但它们是隔离开的**。也就是说，百度只能访问到百度存在浏览器的Cookie，微博只能访问到微博存在浏览器的Cookie，百度是拿不到微博的Cookie的，这一点由浏览器保证。

![](http://img.smyhvae.com/2016052235.png)


现在我们来看下开头广告的事情。我们的搜索关键词被百度保存在了浏览器的Cookie里，但是这个广告是出现在一个博客网站上的，按上文的理论，这个博客网站只能访问到它自己存在我们浏览器的Cookie，为什么能访问到百度的Cookie呢？这时我不禁想起程序界有一位祖师爷的教训：**你所有的痛苦和困惑，都可以从源代码里找到答案（read the fucking source code）**。小弟看了下这个页面源码后，发现广告其实是博客网站的程序员从百度那里拿了一段代码放到自己的页面上，用户在请求广告图片的时候，还是去百度请求的，自然百度也就能拿到带着搜索关键词的Cookie了。拿到Cookie的百度就可以根据关键词匹配他们的广告推荐给你，这种广告因为推送的都是用户感兴趣的内容，杀伤力特别大，被称为精准广告。

成千上万的网站加入了搜索引擎的广告联盟，这样你在浏览其他网站的时候，都会看到带有自己关键词的广告，哪天你搜索了一些不想让人知道的东西，嘿嘿，这些广告就会跳出来出卖你。
那么问题来了，如何删除Cookie呢？各位先自己研究，门口有个顺丰快递，我出去拿一下。


## 2015-12-27-当我们谈论动画的时候，我们在谈论什么

小弟一直以来都有个习惯，就是在用APP的时候，发现一个酷炫拉风的动画效果，都忍不住多点两下欣赏一番。不知道各位有没有同样的感受，一个恰到好处、华丽而又舒服的动画，可以给一个APP加分不少。今天我们就来谈谈这些动画背后的技术。

说到动画我想起了小时候玩过的手翻书，把一幅一幅动作连贯的小人画在一张张纸上，然后迅速翻页，就会看到小人仿佛真的动了起来。其实屏幕上的动画也是一样的道理，只不过我们手绘的小人变成了程序绘制的画面，快速翻页的纸张变成了不断刷新的屏幕。动画就是这么个原理，它把一些静止的画面快速的一张张的展示出来，当速度超过人眼可以识别的极限之后，人就会觉得它本来就是连续的。


我们先来说几个简单的概念。动画过程中的某一张静止画面叫做一帧(Frame)，一个动画每秒钟播放的帧数叫做帧率(单位是FPS)，一般来说当帧率达到30帧每秒的时候，人们就会觉得这个动画很连贯了，当帧率达到60帧每秒的时候，这个动画就会非常流畅了。像下面这个点击按钮弹出菜单的动画，要达到每秒钟60帧的帧率流畅运行，每一帧要花多久来展示呢？如果我没算错的话，应该是16毫秒左右。


16毫秒，也就是留给是你的手机渲染一帧的时间。还记得我们之前讲过的渲染的概念吗？在这16毫秒期间，你需要为屏幕上的所有图片、按钮、文字测量好大小，排布好位置，然后交给显卡绘制出来。现在手机配置越来越强大，但是屏幕分辨率也越来越大。分辨率越大意味着每一帧要画的像素越多，CPU和显卡的负担也越重。这时候万一哪个2B程序员插了一段从网络上同步下载苍老师.avi的代码进去，导致每一帧绘制都需要100多毫秒，这时候用户就会看到动画一卡一卡的，这个用户多半是要流失了。

那么从技术上来讲如何实现一个动画呢？这里需要操作系统提供三个东西，一个是刷新屏幕的命令，我们假设叫refresh，我们的程序发出了这个命令后，手机就会刷新一次屏幕。另一个是绘制图形的命令，假设叫drawFrame，这个是一个代表，具体可以是drawCircle(在屏幕上画个圆圈)、drawRect(画个长方形)、drawText(画一段文字)等等。最后一个是定时器，假设叫scheduleNextFrame，它的作用是告诉操作系统下一帧的时间。

假设我们要绘制一个500毫秒的动画，它展示一个圆放大30倍的动画过程。程序员会这样写程序：

动画开始：

- 第一帧:drawCircle(1倍)--->refresh--->scheduleNextFrame
- 第二帧: drawCircle(2倍)--->refresh--->scheduleNextFrame
- 第三帧: drawCircle(3倍)--->refresh--->scheduleNextFrame
- ...
- 第30帧: drawCircle(30倍)--->refresh

动画结束。

这种动画实现起来非常简单，iOS和Android都内置了几种常见动画类型，如缩放、平移、渐变、旋转等等。程序员只需要设置好动画时长(前面的500毫秒),动画中要变化的东西(前面放大多少倍)，然后发出start的命令就可以了。

还有一种动画叫有交互的动画。它由用户手指的操作触发刷新屏幕，一个典型的场景是我们滑动朋友圈列表的时候，列表之所以跟着手指动，就是因为手指的移动触发了屏幕的刷新。这个场景延伸出去就是游戏了，游戏的界面刷新也是由用户控制的。从实现成本上来说，程序要要实现一个没有交互的动画很简单的，如果动画不是特别复杂，基本上从设计师那里拿到资源和设计稿，就可以大概做出个雏形。有交互的动画因为要处理用户手指的触摸事件，会稍微麻烦一点，但基本原理都是相通的。

了解了这些动画的知识，现在你就可以愉快的和程序员们沟(si)通(bi)了。

## 2015-12-28-互联网上一切皆下载

互联网上主流的应用，包括浏览网页，在线视频，在线音频，社交，游戏，看似毫无关联的若干种类型，其实本质上都是下载。

下载的意思再通俗不过，你可能在电脑上已经下载过无数的软件，AV，文档。一个软件、一个视频、一个文档、一个网页，在互联网上统统称为资源，他们静静的躺在服务器（服务器的意思简单理解就跟你桌面上的电脑一样，只不过它的带宽更足，CPU更多，内存更大）上随时等候被临幸。更贴近生活化理解，下载就是获取的意思，你去粮店买一袋米，去超市买根火腿肠，滴滴打个车，其实都是获取实物或者服务，只不过生活中的“下载”绝大多数都是付费的，而在互联网上绝大多数服务是免费的。

重点来了，在你的印象中，下载基本就是下载一个ppt，doc或者一个应用程序，为什么说一切皆下载呢？

秉承了一名程序员优秀的抽象思维，才敢吹这句牛逼。简单介绍下“流”的概念，在刚才所叙述的所有产品类型里面，当你开始请求网络数据，就相当于将一根水管插到了一个水桶里面，然后水开始往出流(应用程序所需要用的数据)，流出来的水，你可以选择做饭，选择洗手，选择喝掉（对应于视频，音频，还是网页）。有了这个例子，简单脑补一下，你应该可以理解“流”的概念。在C++,Java等等大量的编程语言里面，流叫做Stream，就是用来从另一个地方不间断的获取数据。

![](http://img.smyhvae.com/2016052236.jpg)

那我们举几个栗子，来描述下不同类型的产品抽象出来本质上都是下载。

当我们打开淘宝网站，这个请求链接到了网站服务器，这个连通的流就建立起来了，网页的数据通过这个建立起来的管道不断的流向用户的浏览器，浏览器看到这些数据，解析，排版，绘制，整个渲染过程，你就看到了网页的呈现。

当我们打开1024这个网站，打开了一个视频，同上例，这根管道建立起来之后，视频的数据不断的流量播放器，播放器解码视频数据，将数据播放出来。

当我们下载一个微信App，同上例，管道建立之后，微信app的数据不断传输过来，应用程序将其保存在硬盘上。

你会发现，所有的应用类型都离不开这个管道来获取服务器上的数据，也就是全部需要通过下载数据的方式来完成，只不过数据到达之后，各种不同的产品使用这些数据的方式不一样，或播放，或展示，或存储。

**希望你能清楚的意识到，视频文件，文档文件，网页文件对于服务器来说，都一样的，都是资源，任何一个应用都是来获取不同类型的资源来提供服务。所以，互联网的任何一个服务本质上都是下载。**


## 2015-12-29-妈妈再也不用担心我的需求赶不上版本发布了

作为产品经理，是非常不希望产品需求是以下载安装的方式进行迭代的，即使是一个很小的需求如果没有赶上版本发布，就不得不放入下个迭代周期中。然而，即使赶上了版本发布，如果特性被用户排斥，甚至需要紧急发布新版本。新特性的验证也是需要一个一个版本周期去试错。总之，应用下载更新安装的方式不仅慢，动静也大，如果能动态更新就好了。

动态更新是指在用户没有感知的情况下对用户消费的内容进行更新，用户消费的内容可以以APP形式存在，也可以以网页的形式存在。如果以网页为内容的承载体，要做到动态更新是十分容易的，更新时，只需要将新的网页重新部署到后台就可以让用户看到最新的内容了。但是以APP形式为内容承载体时，就不免涉及到下载安装的问题了，如果程序也能和网页一样动态更新不触发安装就太棒了。

程序的动态更新其实就是动态的替换其中的部分代码。程序员写的终端代码最终会以某种实体形式静静的躺在宿主平台的某个角落等待被唤醒。宿主平台并不知道这个程序有多庞大，多复杂，它只认识这个程序的入口，通过这个入口，它可以唤起程序的主体部分。在一些高耦合度的APP中，程序主体部分就是程序的全部，这也是很多APP的初始形态。这种形态的APP无法动态更新，因为所有的代码都在程序的主体中，如果要替换其中的代码，则必须更新程序的主体，而替换程序主体则免不了更新安装的流程。

如果将程序按照模块拆散，代码分散到各个模块当中，那么，只需要保证程序的主体是一个足够健壮的模块加载器（负责加载各个模块），当需要更新时，只需要找到需要更新的的模块，下载并替换掉，下次程序主体启动后就可以直接加载更新后的模块。只要主体程序不用更新，就可以避免平台限制的安装的过程，而且这种做法是一劳永逸的。

这种程序拆分组合的思想跟组合大屏幕很相似，一个程序承载的需求越来越多，就跟屏幕越做越大一样。

![](http://img.smyhvae.com/2016052237.jpg)

看看上面的组合大屏幕，如果其中某处被熊孩子给砸了呢，我们只需要找到被砸坏的那块屏幕，换掉那一块就够了。如果这是一块完整的大屏幕呢，恐怕不得不头痛了。

程序是可以拆散再拼接起来的，如果一个功能的有着频繁迭代的可能，那么在提需求的初期加上动态更新的要求，那么能够很大程度上缓解版本迭代周期的烦恼。如果你在后期提出动态更新要求，恐怕程序员会皱起眉头了（如何在一块完整显示的屏幕中挖出一块可以独立显示小屏幕还能正常显示呢）。


## 2015-12-30-如何成功地访问一个网站

作为一个互联网从业者，或多或少地收到过这样的求助“我电脑上不了网了，什么网站都打不开，怎么回事啊？快帮我解决一下”。据不靠谱统计，这些求助中有87.5%的是因为宽带欠费了导致断网，让他把网费续上就ok了。那么剩下的12.5%是怎么回事呢？我们来看看从你敲下回车那刻起，能遇到些什么状况。

比如我们要访问百度，输入百度的域名www.baidu.com，但是只有通过IP地址14.215.177.37才能够找到网站的服务器，因此首先发生的就是DNS解析，也就是将域名转换成为IP地址。提供这个服务的一般都是宽带运营商，如果运营商的DNS服务器挂掉了，那么我们的这次访问连门都出不了。一般来说，遇到这种域名解析失败时的表现就是网页一个都打不开，QQ却可以正常使用，这是因为QQ内置了一些自己的IP地址。其实运营商的域名解析服务器挂掉了还不算什么严重问题，更恶心的是DNS劫持，也就是说故意告诉你一个错误的地址，比如你想访问百度，结果给你一个千度的IP地址，把你忽悠到千度网去。在这种情况下，可以尝试切换一个DNS服务器来解决。

假设我们没有那么差的运气，得到了一个正确的IP地址，这个时候开始连接百度的服务器，但是，并不一定连接的上😓。因为从我们的电脑到百度的服务器之间还隔了多个路由节点，其中任意一个路由不帮助我们转发消息，都有可能连接不上。比如说，公司网络一般都会部署一些防火墙在路由节点上，如果你访问了一个不被允许访问的网站，那么你的请求就会在中途被掐掉。如果想冒着被开除的风险，一定要打开这个网站，那就尝试一下走一下代理服务器吧。

假设我们仍然没有那么差的运气，成功地连上了百度的服务器，这个时候百度开始处理我们的请求，有可能我们请求的网址是个错误页面，或者是我们的请求导致了服务器处理异常，都有可能导致我们看不到正确的网址，而是一堆错误页面。一般来说，如果收到了一些4xx的错误信息，那很有可能是你请求的网址并不存在，如果收到一些5xx的错误信息，那么就是服务器出问题了，可以尝试稍后再试试。

![](http://img.smyhvae.com/2016052238.jpg)

假设我们的运气还是那么好，百度的服务器也成功处理了我们的请求，将正常页面返回给我们了，但是仍然有可能出岔子。因为回程还是有一大段路要走，如果遇上了拦路的山贼，对返回给我们的页面里面加塞一些奇奇怪怪的东西，那么我们看到的页面也就不是我们想要的了。下面这个图就是被运营商强制插入广告的情况。遇到这种情况，最好试试将你的链接的前面的http://换成**https://**

![](http://img.smyhvae.com/2016052239.jpg)

所以，想要正常的打开一个页面，需要一个靠谱的自己＋一家靠谱的运营商＋一个靠谱的网站。我们能看到的每个正常的网页，都是经历过这些风风雨雨后才来到我们的面前，请善待这些我们打开的网页，不要轻易点击右上角的叉😄


## 2015-12-31-想让app市场为你的app提示更新，你就要这么干！

前言：前几天有位产品同学留言说想了解下安卓和ios应用市场的更新检查的原理流程，这篇文章就是回应这位上帝的声音。

一早醒来，尼玛通知栏里的软件市场又提示有20个软件需要更新了，身患强迫症的我必须把这20个软件都更新了才能安心起床！

这种情况想必大家经常遇到，你有没有想过这些市场软件是如何得知手机上的软件需要更新的呢？

在安卓平台上，每一款应用对应的apk，都会对应一个版本号，这个版本号定义在源码的AndroidManifest.xml文件中，文件的位置和部分内容如下：

![](http://img.smyhvae.com/2016052240.png)

![](http://img.smyhvae.com/2016052241.png)

可以看到这个文件是用超文本标记语言（XML）格式书写的，比较易读。“package”这个属性定义了apk的包名，比如微信的包名为com.tencent.mm，那么微信的源码里，这个属性就会被这样定义“package=com.tencent.mm”。“android:versionName”属性定义了apk的版本名称，版本名称一般会直接显示给用户，所以可读性比较强，比如最新的微信6.3版本（2015年12月28日发布），这个属性为“android:versionName=6.3.8.56_re6b2553”，这个名字可以在一些市场的应用简介内看到。如图：

![](http://img.smyhvae.com/2016052242.jpg)

“android:versionCode”字段是我们今天的主角，它的值是一个整数，表示当前工程源码生成的apk的版本号。**在安卓的世界中，有这么一个“潜规则”，包名（packageName）相同的两个安装包，版本号（versionCode）的值大的那个apk就是新版本**。微信6.3版本的版本号（versionCode）对应的值为680。

好了，现在我们知道了判断两个包名相同的apk哪个是新版本的“潜规则”，当前的市场软件检查更新的流程就可以分析出来了：

第一步，市场软件会提取出用户手机上所有已安装文件的包名和对应的版本号。

第二步，通过网络协议（http等）将第一步取得的数据上报到市场软件的后台服务器。

第三步，后台服务器通过客户端上报的信息，在当前在市场上架的apk中，查找出比用户手机上已安装的apk的版本号高的相同包名apk。

第四步，服务器将第三步中查找到的apk数据通过网络协议（http等）返回给手机。

第五步，市场软件获取到服务器返回的数据后，更新提示出现了。

在IOS平台上，每个app也有一个对应的版本名，但是没有版本号的概念，不过好在IOS app的分发市场只有App Store一家（越狱的请无视），所以只要版本名与市场上对应app的版本名不同，就可以判断手机上的版本可以更新了。

现在，你知道如何让市场为你的软件提示更新了吧？

PS：我这里有一个可以获取任意apk的包名、版本号和版本名的小工具，有需要的同学可以留言索取。


## 2016-01-01-超级APP诞生记(一)：登陆

从今天开始，我们会开始一个系列，介绍一个超级APP是如何诞生的，前端后台的技术都有。请各位小伙伴准备好小板凳，在火炉旁找个位子坐下，我们这就开始了。

千里之行始于足下，我们先从登录账号这里说起吧。

![](http://img.smyhvae.com/2016052243.jpg)

账号登录几乎是每个APP必备的一个功能。我们在开发一个APP的时候，第一件事情几乎就是建立一个账号系统。不光是社交APP、游戏APP、视频APP需要账号，一些工具应用像管家们、大师们、卫士们甚至一个手电筒指南针也有非常完备的账号系统，你清理一次垃圾，浏览一次网页，下载一部小电影，都可以涨积分换奖品。这里不吐槽产品策略，我们来看下技术上是如何实现的，主要会涉及到一些安全上的问题。

一个最简单的想法就是在你注册的时候把账号密码提交到后台服务器，然后登陆的时候输入密码，拿到服务器一比对，对了就通过，错了就打回。整体思路就是这样，但是如果这道题100分的话，你这样回答我会给你59分。我觉得带着问题找答案是学习的一个好方法，等问题想明白了，知识也就get到了。所以我们先来探讨这几个问题。

- 注册和登录的时候，你的密码会直接发送到服务器吗?

不会。客户端和服务器之间是一条充满妖魔鬼怪的荆棘之路，我们前面也讲过，有搞劫持的，有搞DNS欺骗的，还有挂着羊头卖狗肉李鬼变李逵的。所以客户端拿到你输入的密码之后，第一件事就是：变身！先来一个哈希大保健。哈希的意思是，把你的密码(比如1234567)变成另一段谁也不认识的文字(比如2345121)，并且这个过程是不可逆推的。也就是说，别人偷到了哈希之后的密码，也不会推导出你真正的密码。这样你的密码就可以上路了。

- 服务器验证成功之后，服务器会记住我吗？

不会。我们之前讲过服务器是记性不好的，你一走，他就忘了你是谁了。但是服务器不会让你白登录，这时候服务器会返回给你一个票据，下次请求数据的时候，把这个票据带上，服务器就知道你登录过了。打个比方，你要去坐飞机，在网上买了机票，付了钱，提交了身份证号码。这就相当于注册成功了，我们假设身份证就是你的密码，能证明你的身份。你去机场值机的时候，人家让你出示身份证，输入电脑一查，验证成功，会给你一张机票。这张机票的意义是，你现在可以把身份证收起来了，机票就相当于你的身份证。你要去坐飞机？出示机票就行了。你要去头等舱做一个安静的美男子？出示机票就行了。那为什么不每次都出示身份证，要这个机票干嘛呢？很简单，你的身份证多宝贵啊，天天拿在手里，丢了怎么办？所以这里有一个原则，尽量不要让密码在网络上传来传去(包括哈希之后的)。另一方面，票据是有过期时间的，飞机飞走了，你的机票就成了一张废纸。别人偷了你的机票，等飞机飞走了，还是一张废纸。

- 记住密码和自动登录是怎么回事儿？

假如你勾选了记住密码，客户端就真的记住你的密码吗？不用。客户端只是我们的一个代理，是替我们去APP后台拉取数据的，你会把你的身份证交给一个代理保管吗？只需要把票据给他就行了。它会把票据存期来，下次登陆的时候拿去服务器做验证。那么这个票据，藏在哪里好呢？在计算机里面，理论上内存是最安全的，进程是个隔离的，没人能轻易的读到别人进程里的东西。不过也有个例外，如果你的Android手机root了，各种管家和卫士就会在你的进程里扎根，监视你的一举一动。内存断电会丢失，所以我们一般存在SD卡上。这里你会与盗号者们正面交锋，所以要用上各种变态的加密算法。哦，对了，浏览器的话还可以存在Cookie里，虽然不怎么安全，但是很方便。

账号登陆讲完了，整个过程其实很简单，主要是一些安全上的概念。安全问题真的很重要，希望大家引起重视。不信？我给你们讲个笑话。从前，有个哥们儿叫陈冠希...


## 2016-01-02-明修栈道，暗渡陈仓

相信很多产品经理玩过用声音传文件的APP。一个手机选好要发送的文件，滴滴滴的响了一小会，另外一台手机就收到了文件。这是个有趣的技术，但是它来的很快，走的也很快，我们很多人还没来得及去了解它，它便几乎消失在了我们的视野里。那么它到底是怎么做到的呢？

一切皆信息，声音作为信息的载体能够发送文件，这看起来没有什么可以值得深究的：只需要将要传的文件转换成数据流，再编码成声音，接收方再将声音解码成数据流不就可以了吗？理论上来说，这样没什么问题。是的，没什么问题，1M的文件用声音估计得传一天吧，要真这样做，这技术估计锈成渣了都没人用吧。

然而我们在使用类似的APP时，发现并不是这样的，这些APP无论传多大的文件，声音的时长基本都一样（大概3，4s），可这么短的声音，哪有那么大的容量呢？没事，搞不定的事找干爹。干爹是谁？Internet，这可是世界上最大的资源主，几乎是所有APP的干爹。只要干爹分点羹（URL），everything is possible。

说到这里，大家就豁然开朗了，只需要将文件传到服务器，再把文件的url编码成声音传过去不就可以了嘛。方案说破了，真的很简单了。残酷的事实是，一般的url长度对声音编码来说还是太长了，互联网上大部分url的长度也有30+的字符，发个url也要放个半分钟一分钟的声音，是可忍孰不可忍。

幸而，还有一种叫短地址的东西，再长的url也能转成一个实际信息长度只有6位的短url（微博中很常见）。这些技术都有了，那么事情就好办了。6位的字符通过声音传递大概也就需要要3，4s的时间，这个一般人都是可以接受的。

最后，完整的描述一下整个过程：当一个手机确认要发送文件时，它首先会将这个文件上传到服务器，并接收服务器返回的短地址，再将这个短地址编码成声音；接收的手机将声音解码成短地址后，再从这个地址去下载文件。只是整个APP从形式上让你感觉到好像是直接通过声音作为载体将文件传过去了而已。

这个不就是赤裸裸的明修栈道，暗渡陈仓吗？一些看似笨重的技术，在巧妙借力，并作适当包装以后，确有化腐朽为神奇的能力。虽然用声音传文件的APP在逐渐淡出我们的视线，但是如果哪天它明修“隧道”，你还能看得出来吗？


## 2016-01-03-为啥我的Android手机抢不到红包

“唉，又没抢到”，“水果机抢红包就是快啊，每次点开看都有你”...

年关将至，微信群里面大大小小的红包到处飞，每个红包都能引起不小的骚动。大家也经常将抢不到红包的责任推给Android手机，似乎大家普遍的印象就是Android手机慢，就是没有IPhone抢红包那么快，准，狠。

Android手机的发展大家有目共睹，在极短的时间内干掉了曾经手机界的巨头诺基亚，如今和IPhone二分天下，现在Android的旗舰机置配个8核CPU+4G内存都不算什么事，IPhone6s不过就双核+2G内存。但是实际上手的操作感觉上来讲，IPhone还是比Android流畅。

无风不起浪，既然很多人都有类似的感觉，那说明这里肯定有什么问题。

先从Android应用运行的环境说起。Android应用是用Java代码编写的，Java是解释性语言，编译生成的文件是字节码文件，最终是运行在Java虚拟机上的，Java虚拟机是干啥的呢？它就是个翻译，负责将字节码文件解释成对应平台能够读懂的语言。Java应用走到哪，都得带上这个翻译，这沟通效率就可想而知了。相比之下IOS的应用则没有这种困扰，它们可以直接和机器沟通。从这个层面上讲，Android应用有先天劣势，始终会慢一拍。

再从系统设计上看看。我们平时感受到的手机快，大部分情况下是觉得手机对我们操作的响应速度快。

**IOS系统的响应顺序依次为Touch–Media–Service–Core架构，换句话说当用户只要触摸接触了屏幕之后，系统就会最优先去处理屏幕显示也就是Touch这个层级，然后才是媒体(Media)，服务(Service)以及Core架构。而Android系统的优先级响应层级则是Application–Framework–Library–Kernal架构，当你触摸屏幕之后Android系统首先会激活应用，框架然后才是屏幕最后是核心架构。**

简单点说，你到IOS家开的馆子吃饭，你喊点菜时，店家遵循客户是上帝的原则，他会放下手头的一切事情，来给你提供服务，但是你到Android家开的馆子吃饭，你喊了点菜，店家可能不会搭理你，他还在处理他认为对它来说更重要的事情，等处理完了，才有时间为你提供服务。

再者，IOS是皇室出生，血统纯正，从IPhone诞生到现在的机型掰着手指都能数过来。反观Android的机型，那就是成千上万的兄弟姐妹齐聚一堂啊，想做针对性的机型优化？开发者表示能力有限，只能尽力而为了。


## 2016-01-04-朋友圈中的图片缓存系统

每天早上8点，用5，6分钟的时间给你讲一个白话版技术分析，洗涤心灵，帮你摆脱工作不适症状。

每天坚持很苦的，但是我乐意。

每天我都要刷十几乃至几十遍朋友圈，来获取最新的资讯、八卦、行业大事儿，也顺便看看周围同事都在哪些国家玩耍，哪些同事又后半夜下班打不到车，还有最近周围同事的孩子都成长的怎么样，哈哈。八卦、装逼、卖萌、邀功，每天在朋友圈里悉数上演。

扯远了，我今天主要分析一下朋友圈的图片缓存系统以及介绍一个缓存系统的设计要素。

缓存是什么？

**缓是临时的意思，存是存储的意思，所以缓存就是临时存储的意思。什么东西适合临时存储呢？文字、网页、图片、数据？一切都适合临时存储，并且也都适合永久存储，要看业务类型。**

以朋友圈为例，你一定离不开这几种场景：

刷了几页之后，然后回到头部，你会发现看过的图片依旧在显示，并没有重新出现占位符，然后再显示出图片，表明这张图片一直在内存中，随时可被使用。
点击一条新内容的图片时，会展示一张小的缩略图，然后loading一直在转，过了一会儿一张清晰无码大图展现出来，表明这张图片是从网络拉取回来的，随后再被使用。loading的过程中，只存在一张小的缩略图。
当你翻到几天前的内容，打开图片的时候，有的时候跟2一样，从网络拉取，有的时候，瞬间打开，这是为啥呢？因为有可能还在缓存系统中，瞬间被使用。也有可能被淘汰删除掉了，所以从网络重新拉取。
这几种情况基本涵盖了一个App或者其他应用程序所使用缓存系统的所有场景，只不过这个举例以图片为主，其他原理类似。

**缓存系统经常分为两级，称为一级缓存，二级缓存。一级缓存也叫内存缓存，二级缓存也叫硬盘缓存(手机App中，在Sd卡上)**。很显然，一级缓存存取速度更快，程序退出数据就消失，不可一直保留，且多占了一些内存，容易被人叨逼叨的说程序占内存大，把系统拖慢了，其实这是非常合理的一种以空间换取时间的程序设计。二级缓存容量可以更大，速度要慢一些，程序下次启动时候，依然可以使用。如果你不知道内存为什么比硬盘快，请出门左转看看以前的文章，哈。

所以缓存系统设计就是分配两块存储空间，一块在内存，一块在硬盘，假设内存分配5Mb，硬盘分配100Mb，前者叫一级缓存，后者叫二级缓存（硬盘相对比较便宜，所以一般分配要大些）。

现在来模拟下整个朋友圈的流程。

进入朋友圈开刷，这些图片就不断的占用5Mb的内存空间，这时你往回滑动，你会发现刚才的图片还都在，因为这个时候一级缓存还没满，还可以继续吃，所有的图片也都能正常满足业务需求。

假设这个时候已经滚动到了第三屏，一级缓存5Mb空间已被占满，达到上限，所以必然要进行淘汰，目前业界一般会采用LRU（Least Recently Used）算法进行淘汰，也就是最近最少被使用的图片被淘汰（想想还是很贴心的，最近最少被使用，对一个功利的程序来说，你是最佳人选，如果你在工作中最近最少被使用，要注意安全了哦，哈哈），所以按照朋友圈时间线的性质，第一张图片被淘汰出了一级缓存，它会被安放到二级缓存，也即存储到了硬盘上，注意虽然叫“淘汰”，但也没有那么惨，没有被完全丢弃打入冷宫，也算有了个不错的归宿，假设这个时候滑动回第一张图片所在的位置，这个时候内存没有这张图片，一级缓存中没有，一级缓存作为一个老好人，会问二级缓存，“第一张图片”在你哪里吗？这个时候回答是肯定的，所以一级缓存又按照刚才的算法，淘汰一些其他最近最少被使用的图片出去，保证第一张图片能够在内存中，然后我们有又看到了第一张图片。

继续刷下去，我们会发现一级缓存5Mb满了，一直在进行换出换入操作，也就是淘汰一些，选进来一些。硬盘100Mb的空间也有可能被撑满，所以二级缓存也会进行淘汰工作，因为它是最下面的一层，所以只被动的接收一级缓存塞入图片，以及自身的淘汰。

扩展到一个新闻客户端乃至任何一个应用程序，整个流程都可按朋友圈自行脑补，原理都是一样的，只不过对参数的配置略有不同，比如有的想提供更好的看图体验，一级缓存设计的比较大，能够同时浏览更多的图片，不用经常的换入换出，但是同时也耗用更多内存，程序的稳定性也带来挑战。二级缓存占用也可以设计的比较大，这样一些被经常使用的场景的图片，就可以不用再从网络上拉取，但是占用大了，一些管家、卫士就要出现了，说某程序占用了多少多少空间，是否要现在清理，除非你是像微信这种全国人民不得不用的App，他们会相应的提高阈值，清理也会更慎重。在计算机程序中，时刻充满博弈，你想占用更多的资源，就面临更多的风险，用户体验和程序性能之间永远要做衡量，虽然有矛盾，但一定有一个最适合你自己所做业务的方案，虽然有可能也是要经过取舍的。

再举个例子，微信的第二个tab是通讯录，当列表快速滑动的时候，滑动过程中，很多头像都是默认的灰头像，为什么是默认头像呢，因为滑动的时候再去读相应的头像，并且对图片解码，会使整个列表的滑动掉帧卡顿。一些新闻客户端的做法又恰恰不同，比如滑动的过程中，图片就一张接着一张出来，明显感觉是有些卡顿的，但是慢慢滑动是不会的。所以对于关键路径的理解是选择技术方案的最重要的要素。

**我来谈谈自己的理解，为什么列表有可能会卡顿，但是大家选择了不同的做法？微信通讯录的主场景是查找，按字母排序，很可能是快速的滑动，所以卡顿体验相当不好，所以舍弃了一点点的滑动过程中的效果。一个新闻客户端的主场景是浏览新闻，应该是慢慢滑动，这个时候快速滑动的卡顿感会被削弱，也即大多数用户是不会用力滑动的，而大多数慢慢搓动刷新闻。所以对于关键路径的理解不同，所产生的技术方案也不相同。**

《芈月传》中，大王娶了很多老婆，这些老婆在被开苞之后，全部被扔到了一级缓存中，随时等待大王临幸，但因为大王年龄越来越大，体力越来越差，并且伴随着芈月和大王越来越match，芈姝，魏琰随即被淘汰到了二级缓存中，这些心机较重的女人，如果能适时收手，也许还会被重新换入到一级缓存中，和大王有更多的机会见面，但多行不义必自毙，今天晚上的故事剧情应该就是他们被从二级缓存中彻底删除......


## 2016-01-05-不砸钱，如何让你的网站快如闪电

昨天跟家里的老姨吐槽2015诸事不顺，老姨安慰说：“前天庙会上给你求过签了，今年肯定要撞大'运'”。老姨一语成谶，“春运”算是结结实实的撞了我一下：返程的火车票眼瞅着就被抢光了。

究其原因，还不是突发的“客流量”冲垮了有限的“客运资源”。乘客和座位是一个萝卜一个坑，乘客多座位少，自然有人买不到票。其实，类比互联网上的网页，又何尝不是一样？正如前面文章所讲，互联网一切皆下载，用户用浏览器每次打开一个网页的url，都相当与发生了若干次的下载，如果服务器顶不住了，导致一些访问失败，用户就只能看到404页面。

这种用户体验实在是太糟糕了！

遇到这种情况，我们或许会考虑对我们的服务器扩容。扩容说起来简单，操作起来可都是真金白银啊，但现在你只需要了解一个新的技术，就可以达到“扩容”的目的，代价只是多加了几句代码。这个新技术就是“Application Cache”。

“Application Cache”是HTML5中定义的标准，是一种离线存储技术。这种技术可以让我们明确的指定页面中的哪些静态资源可以在第一次访问网页的同时缓存到本地，并且在下次访问该网页时向服务器询问本地缓存的资源是否需要更新。流程如下：

![](http://img.smyhvae.com/2016052244.png)


从上图中我们可以看到，**浏览器打开使用了“Application Cache”技术的网页时，会先尝试从cache中加载数据，并同时向服务器询问本地资源是否已经过期，如果本地资源过期，浏览器会自动从服务器上更新最新的资源到cache中。**

需要说明的是，图中的①和②是并行执行的，也就是说，如果cache中的数据可用，浏览器加载的都是cache中的数据，即便是cache中的数据已经过期。②过程更新到cache中的数据，**需要用户下次再打开这个页面的时候才会加载**。不过页面可以通过注册监听器的方式获得cache更新成功的事件，来主动的刷新页面，让最新的内容及时展示给用户。

“Application Cache”技术通过缓存资源到本地，避免了每次打开网页都会从服务器拉取一大坨数据过程，取而代之的只是一个轻量级的更新检查请求，这样，你的服务器的带宽就被大大的释放了出来。另外，由于网页的资源都是通过本地资源读取，用户非首次打开同一页面，内容展示速度会被最大化的缩短，甚至达到native应用的水平，从而进一步优化用户体验。另外，如果页面所有的资源都被缓存到了本地，那么你的页面可以在离线的情况下被完整的加载出来！

总而言之，**如果“Application Cache”用的好，你的web应用可以获得媲美native应用的启动速度和离线使用的能力，并同时释放了服务器的带宽**，还不赶快让你们的程序猿去搞一哈？

艾玛，不说了，要去抢下一趟火车票去了，“春运”伤不起啊。


## 2016-01-06-你脱掉了我华丽的外衣－广告过滤机制科普

做为一个资深网民，最讨厌互联网上的东西不是五毛党也不是美分党，而是那些各种乱入的广告了。虽说投放广告是大部分网站的主要收入来源，但是经常遇到的广告都十分恶心，总是将我们要获取的信息给挡住。今天就来聊聊如何屏蔽广告。

屏蔽广告的主要手段就两招，第一招是不让广告被下载下来，第二招就是即便广告被下载下来了，也不能让丫的展示出来。

如果广告是图片或者视频形式，这些资源都有一个url，只要找到网页上广告资源对应的url，在浏览器拉取网页资源的过程中，直接不拉取则可。如果广告是文字形式，或者拦截资源失败，对于这些漏网之鱼，就该使出第二招：不让广告展示出来。网页的广告一般都是放在一个网页标签中展示，找到这个标签，将其隐藏掉，这样就可以眼不见心不烦了。

![](http://img.smyhvae.com/2016052245.jpg)

看到这里大家肯定就觉得，原来这么简单，找到广告对应的url或者找到广告展示标签就OK了。但是这里还有一个问题，互联网上这么多网站都是由不同人开发的，他们的url规则和广告标签的排布均不相同，要搞定这么多网站的广告规则一定有很深奥的技术才行吧？其实并没有，能搞定这么多网站的广告规则全靠人肉。

要人肉这些广告规则方法也是分两招：一招适用于那些大家都经常访问的网站，因为它们网站比较大，广告的规则不会变化得十分频繁，因此单个击破即可；另一招适用于一些中小网站，它们不会自建广告系统，而是使用诸如谷歌、百度、阿里妈妈这种大公司的广告系统，不过这些广告系统的规则也是相对固定的，只要将这几大公司的广告系统规则摸透，顺带就可以将大部分中小网站的广告屏蔽搞定了。

最后大家肯定会疑问，这些事情都是谁在做呢？答案就是无私的互联网志愿者们。可以访问https://easylist.adblockplus.org/en/这个网站，这上面有由互联网志愿者维护的一些广告屏蔽规则，上面提到的人肉工作，就是他们来完成的，并且还是不断的添加更多规则，以补充不足。

说了这么多，大家都可能也会吐槽了，能不能来点实在的？好吧，去下载AdBlock Plus这个浏览器插件吧，上面说的它都帮你做了，这绝对不是广告:)


## 2016-01-07-超级APP诞生记(二)：定位

让大家久等了。上期的超级APP诞生记我们讲了账号登录的技术实现，现在我们终于可以识别用户身份了。但是作为一个超级APP，光有登陆功能远远不够。人们都说社交应用始于约炮，为了让小伙伴们能愉快的约起来，我们还需要另外一个核心功能：**定位**。

用到定位的APP几乎随处可见。还记得我们之前讲过的Android的系统权限吗，当时我们抽取了国内Top100的APP，其中有83个请求了大致位置的权限，有76个请求了精确位置的权限。这些APP请求了定位权限之后，就会通过系统接口获取当前手机的经纬度，上传给服务器。有的服务器拿到位置之后，查询了一些附近的商家给你，这就是你们常用的团购APP。有的检索了一些附近的人给你，这就是你们常用的约炮APP。还有的，查了一些附近的私家车给你，这就是Uber。看，做一个APP好简单。

如何获取经纬度？首先想到的就是GPS了。GPS的原理是，天上飘着几颗卫星，不断的广播自己的位置。定位时，打开你的手机里的GPS信号接收器，收集至少4颗卫星发出的信号，用收到信号的时间乘以光速可以算出你和每颗卫星之间的距离，再加上每个卫星的位置已知，就可以确定你的位置了。我们简化了每个细节，但是你要知道，定位其实只要能找到一个参照物，并且知道这个参照物的位置的话，就成功了。古人说，众里寻他千百度，蓦然回首，那人却在，灯火阑珊处。意思是，找了他好久哇，也没有一个靠谱的参照物，最后只能靠蒙一把了。嘿，竟然成功了。所以说定位，关键是参照物。

![](http://img.smyhvae.com/2016052246.png)

然而在天朝，事情总是没你想的那么简单。你手机里的GPS，在出厂前都要添加一个加偏芯片，作用是把定位到的原始经纬度，人为的造成一点偏移，生成所谓的火星坐标。你要问我为什么这样搞，我也不知道，大概是测绘局的那帮人，想跟三胖玩捉迷藏吧。解决办法是把国内所有地图也用同样的算法做偏移，做成火星地图。火星坐标配上火星地图，妈妈就再也不用担心我约到的都是国际友人炮了。

GPS到了室内没了卫星信号就不行了，这时候就轮到定位两兄弟：基站定位和WIFI定位出场了。为什么说他们是两兄弟呢？因为他们的原理很相似。前面说定位的关键是参照物，基站定位的参照物是就是基站。运营商通过查询你手机连接的基站的位置，就能找到你。WIFI定位的参照物是无线路由器。是你连接到无线路由器的时候，上传了该路由器的MAC地址，服务器通过查询公开的MAC地址对应的经纬度来找到你。等等，基站作为参照物有理有据，令人信服，因为它不动啊，但是路由器的话，说不准哪天我就送给隔壁老王了呢。我承认，路由器是可以移动的，但是，你看到路上的街景采集车了吗？如果你以为它们只是采集路边的花花草草，那你就错了。它们路过你家的时候，就把你的无线路由器的MAC地址和GPS记下来了。日复一日年复一年，一个庞大的WIFI定位数据库就这样建立起来了。

定位是操作系统的一个基础功能，iOS和android都有现成的实现。上面说了这么多废话，其实程序员几行代码就搞定了。所以你去找程序员提需求预估工作量时候，先问有没有系统接口，有没有现成实现。如果他一上来就跟你讲一段大道理，顾左右而言它，那一定是在耍流氓。


## 2016-01-08-“熔断”

不得不说这词儿表现欲望真的很强烈，刚刚开始在中国股市实施，便忍不住要秀存在感了。股民对它是又爱又恨，爱它因为今天不再亏了，恨他因为不在今天亏了...

不是说技术吗，怎么扯到股市上了？不，我要说的是一个类型的东西--垃圾。

“熔断”不是一个新词，但它2016年在中国以迅雷不及掩耳盗铃之势普及到文盲都知晓的程度，那借此东风，我也来普及下一个技术上和垃圾有关的名词GC（Garbage Collection ，垃圾回收）。

GC一个和内存相关的术语，存在于jvm（java虚拟机）中，jvm是啥这里不细说，一个简单的例子就是每个Android应用都是运行在一个独立的jvm上的。

如果说中国的股票是垃圾，那“熔断”机制就是在跌到5%这个阈值的时候，暂停交易，给这些个垃圾再一次申诉的机会，如果这些个垃圾死活赖着，又没啥起色，那到7%的时候，就集体歇菜呗。什么？你说我说的不全面，还有涨呢？呵呵，你在说笑呢。内存好比中国股市，里面也有很多的垃圾（app运行中曾经用过，现在没啥用的东西），它们死皮赖脸的占据的宝贵的内存空间。为了避免内存爆掉，jvm也有“熔断”的机制，当内存不足时，通过GC来达到释放部分内存的目的，让app能够继续运行下去。GC也有阈值，当到达这个阈值的时候就会被触发，但是即使是GC，也是要分个三六九等的。

有些垃圾的号称是强引用，树大根深，就如那股市那xx双雄，GC机构也动不得它。

**如果一个对象具有强引用，垃圾回收器绝不会回收它。当内存空间不足，Java虚拟机宁愿抛出OutOfMemoryError错误，使程序异常终止，也不会靠随意回收具有强引用的对象来解决内存不足问题。**

有些垃圾则声明是软引用，弱引用，虚引用。这些垃圾的地位从高到底，不过听名字就知道它们的靠山不牢，一旦触发GC了，就会被按照地位高低被先后清理，这时你会感觉应用非常卡，卡得你无法“交易”，不过放心，这是暂时的，还没挂，只是CPU忙着呢。运气好呢，GC结束后还能再挺挺，运气不好呢，对不起，OutOfMemoryError！啥意思？挂了呗，该下班的下班。

不过呢，中国股市就像一个写很挫的app，到处产生垃圾。而负责GC的机构呢，策略也是捉襟见肘。所以中国股市这个app号称启动就挂，再启再挂，不不，还是操作了两下才挂的，毕竟负责GC的也不是吃闲饭的嘛！

好了，我们讲个笑话放松一下：中国股市...

顺便问一下，你们还看啥公共帐号？回复下呗


## 2016-01-09-快播已倒下，P2P不死

快播案开庭，公堂之上，掷地有声，“技术本身并不可耻”，中国网民这次几乎清一色的站到一边齐呼，“做菜刀的又没有杀人”，更多的是遗憾。

遗憾的是，当年的神器和你的右手再不能好好的配合。

遗憾的是，”正在缓冲中“的字样，再也无法激起你的荷尔蒙旺盛分泌。

遗憾的是，一家非常有创造力的公司竟这样收场。

### 快播产品篇

快播能够在中国当时5.4亿网民的情况下，有3亿的客户端安装量，足够证明了他解决了当时用户的极大痛点，可在我看来是解决了两大痛点。

**1. 解决了用户对于免费视频消费的需求。**

**2. 提供了一整套视频网站技术解决方案。**

一方面提供了中小站长迅速建站的一整套工具，有效避免了在视频领域只能靠烧钱烧带宽的局面，使得一些中小站长能够入局，能够快速获取视频内容，并发布。另一方面，通过QVOD播放器来满足用户对内容的获取。

一前一后，一上一下，完成了后端-客户端-用户的整个全方位闭环，中小站长以更积极的心态、更快的速度上传更新的视频来提升流量，投放广告牟利。客户端同时售卖广告赚取利润。后端内容有流量变现压力，有明显的激励体系，保证内容又快又好。客户需求就会被更好满足，对客户端粘性产生。细细分析下来，整个产品模式真的相当清晰，最后真的达到了“失控”的状态（用户不止用它来获取电影电视剧了，一些岛国爱情动作片更加强了用户粘性），就像“摇一摇”的设计不是用来约炮的好吗。

快播做了前端后端一整套解决方案，前后端相互促进，不断媾合，这是一套乘法系统（乘法系统的意思是消费者和生产者是能够相互促进，共同成长的意思），就像滴滴一样，更多的司机提供更好的服务，就会来更多的乘客，更多的乘客就会引入更多的司机。一个平台系统，就是起这种桥梁作用，不断的扩大两端的用户群，并使其健康生长。快播其实是开创了一个生态，开启了一种新的商业模式。

**一个好的产品能够自我野蛮生长。**

快播的产品经理，真是”既能抬头看，又能低头干“。

巨人虽倒下，但。依。然。十。分。佩。服。

### 快播技术篇

快播面向用户的主要产品是QVOD视频播放器。

QVOD播放器的核心技术主要是P2P（Peer to Peer），是一种去中心化的技术，诞生于2001年。

前面讲过”互联网上一切皆下载“，没看过的话，找下历史文章哦，视频的所有解决方案也不外乎“先下载内容，然后解码数据播放”。

原理是一样的，但是这里产生了分支。

**第一种是中心化服务**，比如从某一个网站上下载一部电影，然后播放，这部电影的所有数据均在这个网站的服务器上，如果下载的人非常多，带宽又十分有限的话，那就经常卡住了，速度为0kb/s，相信这种情况你肯定见过，没卡住的情况，下载速度也经常不是很理想（大部分是服务器带宽的影响）。这种中心化的下载通常是Http或Ftp协议（近几年我的生活中已经很少遇到FTP，不出意外的话，这项技术可能也要登上神坛，供人瞻仰了，如果你不知道是FTP是什么，建议你还是找度娘问问，再过五年之后，你就可以对刚毕业的孩纸高高兴兴的吹上一场牛逼了，哈哈）。

**第二种是去中心化服务**，就是P2P这种模式，这种下载模式中没有中心的主机服务器，每片数据都可能来自不同的用户，这是一种共享的思维模式，它打破了下载服务提供者与用户的边界，每一个用户既是下载者，又是下载服务提供者，看下面这张gif图，每一个计算机都可以向周围不同的计算机获取不同片的数据，1号计算机可能缺1-10Mb，这10Mb可能从2-11号计算机上获取。因为不会有统一的分发者和服务提供者，都是用户和用户之间在共享传输数据，所以前面提到的中小站长更愿意用这种方式提供视频服务，因为只要提供极少的带宽成本就好了，因为大部分用户看视频的带宽是有其他用户分摊的。这种分布式、去中心化的拓扑结构被成为P2P，也叫对等网络。在这个基础上诞生了很多下载协议，比如BT，eMule，xunlei，你一定都听说过的。因为用户量足够大，所以用户之间互相共享的数据非常丰富，缓冲速度快，可以边下边播，这就是快播的主要技术原理。

![](http://img.smyhvae.com/2016052247.gif)

P2P目前已经应用于很多领域，比如比特币，莱特币，协同计算软件，及时通讯软件等等，应用范围非常广阔，说了很多废话，用一句话总结下，就是P2P是一种思想，在这种对等网络中，每一个节点既享受服务，又提供服务。

想象下，这种模式是不是跟现在的共享经济非常的像涅？

Uber司机既提供服务，又自己开车，出行市场已经逐渐在排斥原先处于宇宙中心的出租车公司，而基于每个个体的这种网络，其实就可以看作是P2P思想在共享经济领域的一种升级（说完这句话，我觉得十分装逼，但是因为是星期六，装逼留个好心情，请多包涵，引起任何不适，请自行处理~~~）。

今天主要为您介绍的就是P2P技术，目前应用最广泛的领域就是BT下载，绝大多数的岛国爱情动作片都在以种子的形式在互联网上免费流传和发行，我真的不知道波多野结衣、泽井芽衣是谁。

### 快播设计篇

说实话，快播的UI设计和交互设计，真是太Low了，但仍然阻挡不住它解决了用户的巨大痛点而野蛮生长。

希望王欣能有一个好结果，技术本身并不可耻。


## 2016-01-10-程序员冒死揭露黑产系列之：小心！下个“陈老师”可能是你！

360“又”被小米下架了，孰是孰非这里暂且不表，不过在看到小米的声明中指控360“在用户并不知情的情况下静默执行Root刷机行为，篡改MIUI系统签名，植入非官方的系统应用”后，不禁感慨，终于还是有人突破了底线。

说到Root，使用过安卓手机的朋友们一定是耳熟能详，肯定也有不少应用程序在大家的手中被赋予了Root权限。虽然我们使用Root权限的目的可能只是为了卸载内置应用、apk自动安装、管理后台进程或者限制后台流量，然而你不知道的是，在你点击“授权”的一瞬间，你可能已经开启了“裸奔”模式，下面请同学们继续拿出小板凳坐好，听我来简单介绍下这个“裸奔”模式的开启原理。

一个App，**无论复杂如微信还是简单如图片查看器，他们都需要遵循系统对应的“开发框架”，获取系统提供的能力，来完成自己产品对应的功能**，如启动，获取用户的操作，发送网络数据等。“开发框架”定义了一些app获取系统能力的“通道”，app通过这些“通道”就可以很方便的使用系统对应的能力。在这里，应用程序和操作系统之间的关系可以抽象成下图：

![](http://img.smyhvae.com/2016052248.png)

我们发送的每一条信息，输入的每一个密码，分享的每一条说说，拍摄的每一张照片都需要经过这个“通道”，由操作系统处理后才能完成。

很明显，“通道”是实现功能的“必经之路”，如果“通道”被劫持、篡改，我们的敏感信息就很有可能被暴露。然而很不幸的是，这种劫持、篡改通道的技术已经很成熟了，一般我们都称它为“动态注入”。在被注入后，应用程序与操作系统间的“通道”就会变成下图：

![](http://img.smyhvae.com/2016052249.jpg)

也就是说**所有的数据都会被某个“其他应用”“窥视”一遍，然后才会到达系统**。

如果你的手机可以获得Root权限，并且手机上安装了某个具有“动态注入”能力的“其他应用”A，那么，当你使用应用程序时，应用程序的启动和运行可能会经历下面的过程：

1、应用程序启动后，A会使用“动态注入”技术，将自己的“窥视”代码注入到应用程序的进程中。

2、“窥视”代码被注入后，会针对性的拦截应用程序到系统的“通道”。

3、当应用程序使用“通道”时，数据会先被A应用“窥视”后，才会交给操作系统。

监控应用程序的行为，只需如此“简单”的三步，并不比“把大象放冰箱里”复杂。

最后，引用一下“技术本身并不可耻”的名言，“动态注入”如果能够合理利用，可以通过获取用户的使用习惯来做一些针对性的体验优化，还可以控制一些软件的自启动和流量使用。然而，相信在这个浮躁的社会里，并不是每个人都像我一样单纯、善良。

对了，再补充一句，该技术不仅仅适用于安卓系统。


## 2016-01-11-你敢使用公共WiFi吗？

很多时候，我们去到一个餐馆吃饭，第一件事情就是问老板WiFi密码是多少，但是面对这个陌生的公共WiFi热点，你真的敢连吗？

先来看一下你可能会遇到的各种公共WiFi的安全状况。

- 无密码的WiFi    

这种WiFi最是方便，连上便可以直接使用，当然它也是最不安全的。当你连接上这个无密码的WiFi的时候，你和WiFi热点之间的通信是没有任何加密保护的。这就相当于隔壁老王把耳朵贴在墙边，可以把你和你老婆的情话听得一清二楚。

- 带WEP加密的WiFi    

如果你连上的WiFi是带有WEP加密的，这种情况下你和WiFi热点之间的通信是有一层加密保护的，但是在公共场所，老王也可以向店家打听到这个密码，他再以逆向的方式，同样可以把你们加密的对话解密开来。
- 带WPA加密的WiFi

使用WPA加密的WiFI，每次都会和WiFi热点协商一个不同的密钥来加密，老王想听你和你老婆的情话，必须在每次你们交谈前，打听到你和你老婆约定到密码，这样加大了他偷听的困难程度，但是也不能确保他一句话也听不到喔。
- 钓鱼WiFi    

在公共场合，有的WiFi是可以随便连接上的，同时也可以正常的上网。但是它的后面却坐着一个老王，这就是钓鱼WiFi。在这种情况下，每次你对你老婆说的话，都是先经过老王的耳朵，然后再由老王告诉你老婆，你心里会踏实吗？
- 蜜罐WiFi

我们的移动设备通常有这样一种功能，就是如果成功的连上过某个WiFi，在下次遇到这个WiFi时就会自动连接上。有这样一种WiFi热点，它就是我们曾经连接过的一个正常WiFi的克隆，名称和密码与正常WiFi一模一样，唯一不同的就是，它后面坐着的还是老王。

在这些公共WiFi下，我们可能遇到的安全问题主要有两类，一类就是窃听重要信息，你发出的所有的数据，包括小金库的账号密码都有可能被老王窃听；另一类就是篡改信息，本来你是要帮你老婆清理购物车，结果却是帮助老王清理了他的购物车。

![](http://img.smyhvae.com/2016052250.jpg)

面对这么多不靠谱的公共WiFi，该如何下手才能避免被老王盯着呢？小弟在这里给各位提供几个使用公共WiFi的正确姿势：

1. 能不用公共WiFi就不要用，出门在外尽量使用3G/4G上网
2. 使用公共WiFi尽量使用WPA加密的热点，而不是WEP或者没有密码的热点
3. 使用公共WiFi时，尽量少进行帐号登录等操作，尽可能访问https加密的网站
4. 为了保证传输过程中的数据安全，尽可能在连接上免费WiFi后，再连接一个可信任的VPN连接，加密所有流量
5. 当你不使用WiFi时，记得把设备上WiFi的开关关闭，避免自动连接上蜜罐WiFi


## 2016-01-12-懂你的推荐算法，你懂的

作为一个喜欢思考人生的美男子，我时常感慨，现在这个年代，人们上网获取信息的成本真的好低。智能手机，人手一台，打开3G就能上网，百度一搜，什么都有。当然百度上搜出来的大多数可能并不是你想要的，但这并不妨碍上面的论点成立。也正是因为成本太低，人们反而不愿意主动取获取信息，于是各种各样的推荐系统有了大展身手的机会。

推荐在生活中是一个再平常不过的事情，你失业了，有人会给你推荐工作，你失恋了，有人会给你推荐姑娘。但是在我们这个机器远没有人类聪明的时代，这些事情要是交给机器去做，你就得设计出一套机器能理解的算法出来，这就是所谓的推荐算法。大家看到算法两个字不要慌，以为我又要搬一个大东西出来吓唬人。你可以把算法看做现实生活中的办事流程，它规定了你第一步干什么，第二步干什么，只要你按它说的做，就可以把事情办好。举个例子，你现在要做一个电影推荐APP，我们来看下整个过程是怎样的。

在推荐算法中，我们第一步要有一大堆要推荐的东西。也就是说，你的电影首先要足够多，才能满足不同用户的需求。算法再精准，最后发现推导出来的结果，在你的数据库中并没有，就悲剧了。第二步是要有用户的行为数据。这个也是越多越详细越好。这时候你要把看了哪部电影，看完没有，评价怎么样悄悄的记下来，上传到后台服务器。经过长期的积累，这些数据将为你以后的精准推荐奠定基础。

有了上面的数据基础，我们就可以进入正题了。推荐算法有不少，我们今天介绍一种最基本的叫做协同过滤算法。它的核心思想是物以类聚，人以群分。具体可以分为基于用户的协同过滤算法和基于物品的协同过滤算法。我一直觉得专业领域起这种高大上的名字，是用来过滤智商的，因为很多人看到这里就不打算往下看了，哈哈。

先看第一种基于用户的协同过滤。可以简单理解为我虽然不认识你，但是我通过查看你的朋友圈都是些什么人，根据人以群分的道理，他们喜欢的很可能就是你喜欢的。假设从历史数据上来看，用户A喜欢《捉妖记》、《大圣归来》，用户B喜欢《栀子花开》、《小时代》，用户C喜欢《捉妖记》。那我们就可以简单认为AC二人口味相似，可以归到一个朋友圈里，C极有可能也喜欢A所喜欢的《大圣归来》。这是最简单的情况，实际上仅仅用喜不喜欢来评价感兴趣程度是远远不够的，用户不可能看完还填个调查表选择yes or no，但是会通过一些其他行为比如影评、是否收藏来反应他们的喜欢程度。机器只能理解量化的东西，所以在算法中，这些行为会转化成相应的分数，比如完整看完的，给3分，看完还给了正面评价的，给5分，看到一半就怒删的，给负10分。这样每个用户都会有一个电影评分表，在计算两个用户相似度的时候，把这些数据代入下面这种专门计算相似度的公式，就能得到二人口味的相似程度。现在我们要给用户D推荐电影，分别计算AD、BD、CD的相似度，找到跟D最相似的用户，然后把他喜欢的，都推荐给D，就行了。(下面的公式叫做余弦相似度公式，通过计算n维空间中两个向量的夹角余弦，来表示相似度，大家感受一下就好，感兴趣的可以去问google。)

![](http://img.smyhvae.com/2016052251.jpg)

第二种是基于物品的协同过滤。基本思想是假设甲乙是相似的物品，那么喜欢甲的人，很可能也喜欢乙。还是上面的例子，现在假设用户E喜欢《栀子花开》和《小时代》，那我们可以推导出，喜欢《栀子花开》的用户(B和E)都喜欢《小时代》，那基本可以确定两部电影是相似的，下回来个用户F，他喜欢《栀子花开》，那我顺便就把《小时代》推荐给他，他可能比较容易接受。

大家可能要问，我的APP第一天上线，没有这些所谓的用户行为数据怎么推荐啊。这就是推荐算法面临的冷启动问题。这时候可以用基于内容的算法了。你可以事先把所有电影归个类，战争片归到一起，喜剧片归到一起，动画片归到一起。用户H看了一部喜剧片，你就把所有喜剧片推荐给他。显而易见，这种算法简单粗暴，当然命中率也最低。

真正的推荐系统会综合运用各种算法，加之机器学习和人工调优的不断改进，所以是非常复杂的。基础知识先讲到这里，最后给大家留一个课后作业，请尝试使用基于用户的协同过滤算法向你朋友圈里的产品经理推荐本公众号，么么哒。

## 2016-01-13-应用号，传统APP的革命？

微信要做应用号了，无需下载安装就可以使用的APP，一时间做传统APP的产品都是闻之色变。

可这应用号到底是什么鬼，居然能悬起如此大波澜？虽然应用号的很多细节没有透露，不过我们可以借此畅想一下它的实现以及可能用到的技术。

我们知道传统APP发展到今天已经过于笨重，作为一个独立的APP产品来说或许感受不到这点，而作为用户来说，APP之间的重叠区域越来越重。不同的APP除了能够提供自己独有的特色服务外，基本的能力都差不多，支付功能，消息推送，语音，扫码...

从理论上来讲，如果有一个APP拥有足够多的能力，且用户量足够大的话，其他APP只需要使用它的能力，然后提供自己特色的服务就足够了。微信做这个载体是很合适的。那么如何能在微信里面做应用呢，微信又可能用到哪些技术呢？

Js2Java。网页通过js接口调用微信的native能力。微信本身的基础能力已经很完善了，它只需要将自己的能力封装成js调用的接口，那么应用开发者们只需要做一些前端页面的开发，并在服务器上部署好自己的服务就好了。这种方式在微信里面本身也运作的比较好了，例如微信里的滴滴出行，它使用了微信的帐号，push，定位，支付等能力，完成近乎native的体验（我也因此删掉了滴滴出行的客户端）。（详见历史文章“网页和原生App如何交互”）

插件模式。这种方式允许开发者有更强的native界面控制能力，可以避免前端页面开发的界面手感不好的问题。同样，要做成插件模式也需要微信将它的能力封装成原生接口，开发者这针对这些接口进行应用开发，完成后的APP通过微信的插件框架加载起来。整个APP的下载，安装，更新通过插件体系可以做到无感知。不过这样开发者难免需要在不同的平台上编码了（Android，ios，wp）。（详见历史文章“妈妈再也不用担心我的需求赶不上版本发布了”）

React Native。这个是脸书搞出来的一套开发原生APP的框架，这套框架本身的核心就是Js2Java，它屏蔽了开发平台的差异，开发者只要会前端开发，就可以只写一套代码，通过这套框架构建不同平台的native界面。微信只需要把自己的能力封装到这套框架中供开发者调用，有趣的是整个APP的运作形式更接近与插件模式。简单说就是开发者用React Native的框架编使用前端语言编写代码，最后打包成不同平台的插件在微信发布即可。（详见历史文章“React Native-目前最火的前端技术”）

这三种方式都可以在微信里做一个免安装，随时可更新的APP。这对APP开发来说是好事（不需要自己再搞一套帐号体系，push系统，支付体系），一切能力由微信提供，APP只需要专注于提供特色的服务就足够了。

当然，或许微信这些已经都做好了，创建一个应用号对微信来说只需要在桌面创建一个快捷方式而已...


## 2016-01-14-学好技术干百度，今天讲讲多线程

你一定听说过多线程吧？它有什么好处？主要用于什么场景？

如果你的程序**响应迟钝**，请考虑多线程。

如果你的程序**效率不高**，请考虑多线程。

如果你的程序**吞吐不高**，请考虑多线程。

多线程是有效提升程序运行效率的方式之一（还有可能是优化算法，提高硬件配置，分布式计算，网格计算等等等等）。

什么是多线程？还是从简单的例子入手

在中国，你一定见过这道题：“一个水箱有5个排水孔，打开一个排水孔，水箱清空需要一小时，请问怎样才能使水箱迅速清空，并计算清空的时间？”

这个耳熟能详的应用题就蕴含了多线程的原理，以前我们讲过，线程是程序执行的最小单位，也就是只有当你是一个线程的时候，你才有机会获得CPU的临幸，给你一个小段的时间，让你来执行。一个排水孔就是一个线程，当打开一个排水孔的时候，称为单线程程序。当打开多个排水孔的时候，称为多线程程序。因为一个程序有更多的线程，那么这个程序中的多个线程获得CPU的几率就更高，获得的时间就更多，所以执行速度也会更快。

获得CPU的专业术语叫获得**时间片**，也就是CPU把所有的时间分成若干个小片，把每一个小片不断的分给不同的线程来执行，保证每个程序都有机会执行，不会有程序一直霸占CPU。

你手机上的微信虽然一直在前台运行，但是没有霸占CPU好吗。其实整个操作系统是相当三心二意的，不会一直对一个程序情有独钟。看起来一直霸占，其实还是有很多时间片被分配给了其他的应用程序，只不过这个轮询的过程非常快，你根本感觉不到而已。你一边打开Word编辑文档，一边打开了QQ音乐听着歌，其实是CPU的时间片不断的在两个程序之间分配，中间可能也有一个时间片其实word或QQ音乐程序是停止的，只不过人类无法感知而已。

所以多线程程序的核心是开启更多的线程，获得更多的CPU时间片，让程序更快完成而已。

在一个GUI（也就是有界面，有用户交互）的系统中，比如Android、iOS、Windows等等，其实操作系统本身的设计就是多线程的。其中至少有两个线程，一个叫主线程，另一个叫工作者线程。

**主线程**一般是用来绘制界面，响应用户操作的（比如触摸、滑动、点击），这个线程最好不被应用程序所打扰，因为它最好保持很高的实时性，要不用户就会骂卡。。。顿。。。慢。。。（所以如果你的App一直感觉卡卡的，要细致检查下了哦，是不是在主线程里面干了什么小羞羞的事情）。

**工作者线程**，顾名思义，是用来运算或者完成逻辑的，它对用户界面和操作不负责响应，它就一个字“干”，默默的做计算，做逻辑，并将一些结果反馈给主线程，从而展示不同的用户界面和逻辑。

多线程系统无处不在，下面说几个小例子。

1. 你现在所看到的所有的下载器（迅雷、旋风、浏览器自带的下载），都是多线程实现的，如果单线程的话，下载速度最多是别人的一半（哎呦~，人家三个以上的线程在同时下载数据并写到磁盘哦，当然干不过人家）

2. 后台的服务器系统都是多线程的，如果是单线程的，我在访问的时候，占用了CPU，别人就访问不了了哦，这个就是并发的意思，以后有机会，给大家讲讲并发和均衡负载，oh yeah~

3. 你所见到的任何一个app，其实启动的时候都做了大量的事情，都是多线程的，有的线程可能在加载新模块，有的线程在做上报，有的线程在收集lbs信息

**总结，多线程有两层含义，第一层是开启多个线程做不同的事情，这种主要是为了并发同时做很多事情。第二层是开启多个线程做同一个事情（比如开始举的放水的例子），这种是为了效率更高。**

多线程也有弊端，就是多个线程的时序不好控制，多个线程之间的共享变量控制难度比较大，多线程通知机制复杂，且调试困难，多线程编程，是一名优秀程序员的自我修养，也是提高程序运行效率的利器之一。

如果一个牛逼哄哄的程序员说，这里无法再优化了，你不妨轻轻的问下：“如果多线程的话，能提高这里的效率嘛”，很可能还有意外收获哦。


## 2016-01-15-如何获取安卓用户的app使用频率

9点，准时赶到办公室，保洁的阿姨刚刚收拾完工具。与往常一样，径直走到自己工位，手机在机箱上轻轻一按，伴随着主板风扇的转动声，电脑系统和一个苦逼程序猿的日常一齐被START。

然而，一个程序猿的日常总是充满诱惑和挑战的！

显示器上的四个色块还没有散去，便听见一个清脆甜美却又略带忧郁的声音说：“如果我能知道每个安卓用户手机中app每天的使用频率，就可以向用户精准的投放一些运营push，不知道哪位开发GG可以帮下忙获取下这个数据嘛~”，不用问，肯定是我们的产品女神Miss L给大伙儿提需求来了。“下班之前我来实现这个功能！”，还没等其他同事从睡意朦胧中反应过来，Miss L已经对我微微一笑，满意的转身离开了，留下的只有空气中令人清新愉悦的迪奥甜心精灵的淡淡清香。

深呼吸过后，猛然醒悟，android系统好好像并没有向开发者提供获取app使用频率或者使用次数的能力，查阅各种典籍之后确认，原来系统中虽然已经记录app的使用数据，但由于涉及用户隐私，这些数据只有系统的开发者（拥有系统签名）才能获取，然而作为应用开发者，即便你有上天入地的本领，也是取之不得。

“山穷水尽疑无路，柳暗花明又一村”，却又恰恰应了此时此景。虽然作为应用开发者，无法获取现成的系统数据，但却可以通过“ActivityManager”活动管理器提供的接口获取其他的辅助信息来完成需求：

- “getRecentTasks”接口：获取用户最近使用过的应用程序列表，这个列表的中先后顺序按照应用使用的先后顺序逆序排列，当前正在使用的应用程序排在列表的第一位，应用在该列表中的位置越靠后，则该应用的最后一次使用距当前时间越长。可以参考安卓手机长按home页或者点击“最近使用”按钮呼出的“最近使用软件列表”，这个列表的排序与“getRecentTasks”接口获取的列表排序一致。应用程序退出后，“最近使用”列表中还会保留该应用程序的信息。

- “getRunningTasks”接口：获取当前正在运行的应用列表。这个列表的排序规则与“最近使用”列表的排序规则一致，但是该列表中只包含正在运行的应用程序，应用程序退出后，该应用程序会从当前正在运行的应用列表中删除。

对这两个接口推敲过后，可以得到下面两种算法：

- 每经过一个较长的时间间隔，获取一次“最近使用列表”，并对比相邻两次获取的列表中各个应用之间的相对位置，如果有某两个应用的相对位置发生了改变，或者新获取的列表中出现了一个新的应用，则标记新列表中位置前移或新出现的应用和比该应用排序更靠前的应用各使用过一次。例如第一次获取的应用排序为“A,B,C,D”，相隔一个小时后获取的应用排序为“E,A,C,B,D”，则记E,A,C各使用了一次。

- 每经过一个很短的时间间隔，获取一次“当前正在运行的应用列表”，对比相邻两次获取的列表中第一个应用是否有变化，如果发生变化，则标记新获取的应用列表中第一个应用使用过一次。例如第一次获取的应用列表中排序第一的应用为“A”，相隔一秒钟后获取的应用列表中排序第一的应用变为“B”，则标记“B使用过一次。

很明显，第二个算法的实现相比第一个算法简单很多，但是需要频繁重复的执行（每秒一次），有可能会对功耗造成一定的影响，第一个算法流程复杂但是执行频率低（一个小时一次），不必担心功耗问题，但是可能会产生较大误差。

权衡利弊，决定先快速实现第二个算法。算法实现后，发现并没有带来严重的功耗问题，经过反复测试确认后，这个需求也就顺理成章的Close了。


## 2016-01-16-扒一扒Android应用的续命大法

如果你是一名Android用户，请掏出你的手机，进入应用程序管理，杀掉所有应用，然后去泡杯茶，回来再看看你的手机。如果你是一名iOS用户，请你直接去泡茶，然后回来围观前面那位Android用户。你会神奇地发现，刚刚杀掉的应用很多都自己复活了，一个个的还活蹦乱跳的，时不时给你推送几条消息。

那么，问题就来了，这些应用使了什么手段学会了续命大法，能让自己死而复生呢？今天就扒一扒Android应用自己复活的几种手段。

续命大法第一式：**监听系统事件**

Android系统有一套广播机制，当系统发生了某件事的时候，它会通知给需要知道这件事情的所有应用。比如说，用户切换了网络，系统就拿出一个高音喇叭吼到：“各单位注意了，系统网络切换了，现在是3G网络了”，这个时候，一个正在做下载任务的应用收到了这个通知，它就会考虑一下，为了给用户省流，那就暂停下载吧。这套机制对于良心应用来说，就是可以根据系统当前的状态，给用户带来更好体验。但是，对于某些别有用心的应用，它就利用这套机制，钻个小空子了，明明用户已经退出它了，它仍旧把自己唤醒，静静地躺在后台。

续命大法第二式：**守护进程唤醒**

大部分复活的应用都只学会了第一式，通过系统广播来唤醒自己，不过有的ROM会对这些广播进行限制，于是就有了进阶版，守护进程方案。很多应用在启动后，还会创建一个守护进程，守护进程就是一个小的魔法师，跑在后台不断的检查大哥进程还在不在，一旦大哥进程被杀死了，它就默默地施法，把大哥复活。

续命大法第三式：**全家桶系列**

守护进程也有一个局限，那就是你首先得通过其它方式启动一次。这时就该放出终极大招了，全家桶系列。目前江湖上掌握只有少数的几个大佬才掌握这一招。它的原理很简单，就是不同应用之间相互唤醒，当应用A被杀死后，同门兄弟B就会将它唤醒复活，还有的情况是只要你启动了A，它就会把它的同门兄弟ABCD都唤醒了。这招之所以只有少数大佬拥有，就是因为它的前提条件是，用户会使用同一公司的多个应用，这在国内也只有少数几家公司拥有这个资源。我们一起来围观一下我在点击手机淘宝App后，它家的兄弟是什么个情况。

![](http://img.smyhvae.com/2016052252.jpg)

这些应用无节制的自我复活，给应用带来的好处就是可以始终与后台保持联络，随时激活自己展示在用户面前，这对提高应用活跃度带来了很大的优势。同时造成的结果就是，大量不用的应用一直常驻后台，占用了设备的CPU和内存等资源，给用户带来的就是卡、慢、耗电、费流量这些糟糕的体验。做为一个Android用户，对这种损人不利己的复活应用真是深恶痛绝啊！

最后一个小tips，快过年了，大家都在抢红包，为了提高你Android手机的反应速度，在过年期间最好卸载掉那些不常用又喜欢自动启动的应用吧。


## 2016-01-17-想念Google？先来学学VPN吧

这几天在看美剧《国土安全》，有个镜头印象特别深刻。剧中美国情报员Carrie必须独自穿过某个伊斯兰国家的城市街头，周围来来往往的市民，个个都是能把人活活打死的暴徒，所以她要十分小心的隐藏自己的身份。现实中的我们当然体会不到这种紧张的气氛，但是在网络上，我们的每一次请求，每一个响应数据，其实就像剧中的Carrie，穿梭在交错的电缆中，如履薄冰。就在前几天，大家还在恐慌朋友圈里"我和微信的故事"会不会盗走支付宝密码，可见人们对网络通信的不信任感。

这种不信任感是有原因的，我们与服务器的通信数据跑在一条公共的互联网大马路上，这条路上有你的支付宝密码，有你的朋友圈晒娃图，也有不小心点开的百度医疗小广告，虽然大家都加了密，但是没准哪个不务正业的数据包，专门干些劫财劫色的勾当。所以一些安全级别较高的单位，都是把服务器圈起来做一个局域网(架一个防火墙或者G*W)，只要足够封闭，就可以不被外界感染，大不了就拔电源嘛。但是，有的员工勤劳刻苦，在家也要访问单内网，怎么办呢？这时候，有钱的单位会给你单独扯一条网线，没钱的嘛...大家还是来学一下VPN吧。

VPN(Virtual Private Network)就是虚拟专用网络的意思。专用网络很好理解，就像上面的一根网线，只属于你，直达服务器。虚拟的意思是，嘿嘿，想得美，那都是假的。其实你还是用的互联网大马路，只不过通过一些技术手段，让别人看起来是一条私人的马路而已。这条私人马路的专业术语叫隧道。为什么叫隧道呢？举个例子，我们上高中那会儿，学校寄宿制，晚上关门，所有人必须回宿舍睡觉。但是有些同学想出去上网吧通宵，怎么办呢？大门不能走，学校墙又高，挖隧道呗。开个玩笑，其实是爬墙。这里用隧道来形容是指这条路具有隐蔽性（一般是加了密的)，同时又可以穿透防火墙。现在隧道有很多，常用的PPTP、L2PT、IPSec隧道协议都各有各的特点，有的加密能力好，有的穿透能力强。

看起来不错，但是还有一个重要的细节。现在我们的数据在一条黑漆漆的隧道里走啊走，总算穿透了防火墙进入了内网，却忽然发现来到了一个世外桃源。这里几百年来与世隔绝，"问今是何世，乃不知有汉，无论魏晋"。这时候你多么需要有个人，来告诉你真正的目标在哪里。这个人就是VPN服务器。VPN服务器一般有两块网卡，就是有两个地址，一个对应外网，一个对应内网。我们建立隧道的时候，就是跟VPN服务器的外网地址连接上。外网的网卡收到隧道来的数据，转发给内网的网卡，然后内网的网卡负责找到内网里真正的服务器。当然别人不可能白帮你干活，所以你看到现在很多VPN都是收费的。

看到这里你可能会说，这不就是代理吗？确实，我们之前讲过的代理服务器，是一台专门帮人浏览网页的服务器，如果你的VPN用来浏览内网的网页的话，VPN服务器就可以看做是一台代理服务器。但是，VPN的意义远大于此。VPN隧道建立之后，内网和外面的人就可以互相通信了，双方都有专用的IP地址，在一条专用的隧道里，想说什么就说什么，这个过程是双向的，谁都可以主动向对方问好。而且，对上层使用网络的APP来说，它只知道自己处在网络畅通的环境中，并不知道操作系统用的是VPN还是ADSL宽带。但是如果使用代理的话，APP还要在HTTP协议里捎一个代理服务器的地址，每次通信都省不了。就是说，VPN比代理更接近系统底层。

总结一下，VPN就是一条在公共网络上虚拟出来的专用通道，来满足我们自由交流不被窃听的需求。至于VPN可以拿来干什么，我不说，你自己把握。


## 2016-01-18-百度野史之白富美与矮矬穷

搜索引擎对大部分人来说，无论从产品角度还是商业角度，那都是让人感觉无比高大上的东西。百度作为体制内的搜索引擎霸主，无疑是各种和互联网搭上边的产品心目中的白富美。竞价排名，商业广告，渠道推广就像是一束束捧向百度的鲜花，百度在公主般的待遇中不可自（一）拔（世）。

最近此公司因为卖贴吧的事情被推上了风口浪尖，所谓墙倒也需众人推，娱乐圈有条定律，就是对出现丑闻的明星准时开八她的前世今生。今天我来八的是百度这个白富美背后的“矮矬穷”。

百度的立业之本是搜索引擎，而对于搜索引擎来说一个非常关键的构件就是网络爬虫，不错，爬虫，这个粗俗又鄙陋的东西。搜索引擎这么高大上的东西是怎么和爬虫这么个“矮矬穷”的东西扯上关系的呢？

**网络爬虫是一个自动提取网页的程序，它为搜索引擎从万维网上下载网页，是搜索引擎的重要组成。**

这个虫子属于给跟杆子就往上爬的那种，它从几个初始的网页开始，为搜索引擎四处奔走，不断的从当前爬取的网页中抽取新的地址，然后爬向下一个网页，建立新的关系。而且建立关系的时候相当功利，只保留对自己有用的（根据一定的网页分析算法过滤与主题无关的链接）。这些被爬虫爬过的网页，会被系统存贮分析建档，以便日后可用。听起来有点边偷边抢的意思啊。

然而互联网上的信息量如此庞大，更新频率也快，为了更有效的爬取信息，爬虫需要选择一定的策略：

- 选择策略，决定所要下载的页面；
- 重新访问策略，决定什么时候检查页面的更新变化；
- 平衡礼貌策略，指出怎样避免站点超载；
- 并行策略，指出怎么协同达到分布式抓取的效果

简单点说就是要搞清楚哪些的关系是有用的，并且要时不时的去拜访一下，但是这个频率也要适度，不能让人家觉得你很烦。

有了这么个兢兢业业的虫子，为自己建立如此广的关系网，百度还愁没人给自己送钱求自己办事？从此眼里只有money，money，money！

百度仗着自己白富美的身份，有了为自己保家任劳任怨的“矮矬穷”，还有为自己吸金纳银的小白（贴）脸（吧），真是家里白旗不倒，外面彩旗飘飘，可谓人（无）生（耻）赢（之）家（徒）啊！

可是你的初心呢？

“善良比聪明更重要。”


## 2016-01-19-天天鼓捣数据，你知道数据库长啥样吗？

在家里，找一个东西，经常找了几个小时找不到，最终放弃。

在宜家，找任何东西，基本都可以靠编号自助搞定。

是什么导致了这种区别？

很好理解，宜家的所有东西都在一张表上登记过，然后在这张表里面填上了物品即将被放置的地址编号，最终这件物品才被工作人员最终放置到那个地址编号所对应的货架上，便于寻址（计算机中的寻址就是“找”的意思，不装逼一下，半夜写文章还真有点儿困）。在表上填写若干件物品的名称和相应的地址，有需要的时候再把它找出来，有的时候要进行统计每种物品的库存数量，其实就是一个典型的数据库的应用场景，只不过我举的例子好像是一个纯人工手工的操作，用脚后跟想想，21世纪的今天，肯定也是由电脑完成的哦。

数据库的英文叫做DB（DataBase），数据仓库的意思，就是存储数据的仓库呗，跟宜家存储是真正的物品没有什么不同，一个是在硬盘上，一个是在真正的三维空间中而已。

数据库中有多个表（最少要有一张表，空的数据库什么也表示不了哦，表的英文叫table），表中真正存储的才是数据记录，一张表简单理解成excel的一张二维表格，你就真正理解数据库了，哈哈，如下表所示，表仍然以行列描述其结构，列id，name，address分别描述了物品的编号，名称以及地址，明眼人应该看清楚了，每一列就是一个物品的一个属性，也就是这个物品的一个特点。每一行代表了一条记录（record），这条记录有三个列（特点）。

![](http://img.smyhvae.com/2016052253.jpg)

这张表格如此清晰，我上面这张图也是从excel截取出来的，那为啥不用excel直接管理数据啊？主要是因为数据库的存取效率较excel更高，好多系统是没有用户界面的，你也用不了excel，最重要的是全世界的数据库都支持一种叫做SQL语言的东西来进行“增删改查”操作，数据库是有事务系统的（一系列步骤的一步出错了，全部回滚到最初状态），数据库是支持命令操作的，而不是简简单单的鼠标操作，这就更减少了人为出错，数据库是支持索引的，数据库的查询效率更高等等等等，后面省略一万条原因。

**作为一名产品或设计人员，你只需要把数据库简单理解为，数据库是一个大文件，这个大文件当中有若干个excel表格，每张表格里面存储了若干条记录就。**

以宜家举例，宜家的后台一定是个大数据库，这个数据库里面至少有两张表，第一张表记录了所有的员工信息，包括姓名，年龄，手机，家庭住址，银行卡帐号等等。第二张表记录了所有商品的信息，包括商品编号，价格，库存，货架位置等等。

你的新浪微博的用户名和密码，是存储在新浪的后台数据库中的一个表当中的。

你的QQ号码，也是存储在腾讯的服务器中的某一个数据库里面的。

你的京东购物车的物品列表，也是存储在京东的一个数据库当中的。

数据库的操作一般有“增”“删”“改”“查”四种操作，都是借助于SQL语句完成的，SQL读作【se一声】【kou一声】，我们写程序的时候，一般用C语言，C++或者Java等，但是操作数据库的话，全世界的程序员都是统一的，都是用SQL语句来操作数据库，我交你写一句最简单的SQL语句，剩下的就靠自学了，哈哈。Select * From table1 where name=“桌子”，这个SQL语句的意思是，查询出table1这张表中所有名字为“桌子”的记录。其实一个牛逼的程序员可以用一条非常漂亮的SQL语句来解决许多复杂问题。

数据库的知识概念很多，我挑几个重要的简单介绍下：

1. 索引，数据库经常有上亿条记录，查询会很慢很慢的，数据库会提供一个功能，像字典一样编制一个”索引“，就是新华字典的前几页一样，靠拼音或偏旁来查询的功能，这个就是索引，这个经常能大幅度提高查询速度。

2. 事务，数据库提供了一种机制，就是一件事，必须做完，如果中间出了差错，他会清理掉一切痕迹，回到最初状态，这对于保持数据的一致性和完整性有功不可没的作用。

3. 联合查询，经常一张表格解决不了你的问题，比如有两张表，一张表是员工基本信息，另一张表是工资表，这个时候，要查询某某员工的工资，就要两张表一起来“联合查询”

最后简单介绍下，一个应用程序怎么使用数据库呢？第一步，首先建立和数据库的连接，第二步，利用这个连接，来进行数据库的建表，删表，以及对表的增删改查操作，第三部，关闭数据库连接。最后一步是最容易犯错误的，不关闭数据库连接，经常会产生内存泄漏，以及各种异常。

说了很多废话，其实数据库的直观表现就可以看成一个excel表格。


## 2016-01-20-万万没想到，未来我们这样看片

有句俗话说的好，懒人推动科技进步，仔细想想确实此言非虚。人不想走路，于是发明了自行车。后来干脆连自行车也懒得蹬了，接着就出现了摩托、小汽车。

懒惰，说到底还是人类的一种欲望，所以，“懒人推动科技进步”也可以说是“欲望推动科技进步”。

懒惰一招手，就让我们有了自行车；如果人类最原始的欲望发了威，会是怎样一番作为？如今，VR领域的发展已经被注入了这种“核燃料”。

VR（虚拟现实）的概念提出至今已经有了几十个年头，但是老百姓对VR产品的认知和普及，可能与上个世纪差不太多。

那么，VR（虚拟现实）的关键技术有哪些呢？

- **3D环境动态建模**

3D环境动态建模技术是搭建虚拟现实世界的关键。我们的真实世界由原子构成，虚拟现实的世界则是由数据构成。如何快速的实现虚拟虚拟世界并能与体验者产生与真实世界接近的交互反馈，决定了虚拟现实系统最基础的体验。在这项技术中，真实性和性能是两个相互矛盾的指标。可以想象如果我们在真实生活中“卡”了一下。。。。

- **立体显示和传感器技术**

与传统的2D显示不同，虚拟显示需要让用户在视觉上“身临其境”，这就要求虚拟显示系统的显示设备具有3D显示能力。传感器是系统的输入设备，根据传感器传入的数据，虚拟世界会做出对应的反馈，比如前进、后退，拿起一只杯子等。当前主流的立体显示技术解决方案是“头戴显示器”，这种设备不仅集成了两块用于3D显示的显示器，还集成了一系列的传感器，定位体验者头部的行为。

来看下06年东芝的黑科技：

![](http://img.smyhvae.com/2016052254.jpg)

- 系统开发工具应用技术

虚拟现实系统必须提供一套合适的开发工具和接入标准，否则，就会想一个没有任何三方应用软件的操作系统一样，即便系统的性能如何强大，也无法被市场接受（怎么感觉在说Windows Phone）。

- **系统集成**

虚拟现实世界由海量数据组成，系统需要有一套完善的数据模型的同步、转换和管理技术才能保证虚拟世界的正常运转。

游戏行业按理应该是VR（虚拟现实）技术的最大受益者，但是近几年，真正能够普及的VR游戏却寥寥无几，原因之一是制作成本问题：开发VR游戏比开发一款普通游戏的成本高出一倍，而且VR游戏的前景并不十分明朗。

![](http://img.smyhvae.com/2016052255.jpg)

传统行业在VR技术上止步不前，成人内容却异军突起。根据一些VR设备提供商统计到的流量数据，移动VR设备有一半的流量来自于色情网站，其中的需求量可见一斑。

文章最后，跟大家推荐一款谷歌出品的虚拟现实电影app:“google spotlight stories” ，具体介绍这里就不做冗述了，大家可以自行百度。对了，使用此app请自备梯子。


## 2016-01-21-要想推广好，首先要有码

二维码现在已经无处不在了，微信登录要扫二维码，支付宝付款也要扫二维码，各种推广活动还是要扫二维码，但是你知道如何才能做出一个好的二维码吗？

先来看下二维码的原理，它是由**固定信息＋自定义信息**两个部分组成，固定信息包括了四个角上的定位标志、格式信息、版本信息，这些信息的作用是辅助扫码软件确定二维码的位置和规格，其余的就是我们需要传达的自定义信息了。当我们要传递的信息量越大时，二维码的尺寸也会随之变大，标准的二维码是有40种尺寸的，官方以Version开头，最小的Version1是一个21x21大小的矩行，最大的Version40是177x177大小的矩形。这里有个小技巧，如果你想推广的URL特别长，会导致二维码比较大，这时可以使用一个短网址服务(如t.cn)，将URL缩短一些，这样基本上Version1大小的二维码就可以搞定，用户扫描起来也会更快更准～

![](http://img.smyhvae.com/2016052256.jpg)

数据是怎样存在二维码上的呢？当我们要制作一个URL的二维码时，首先要将它编码转换成为类似0101的二进制码，然后还要补上一些纠错码，最后根据一定的顺序，将这些0101的二进制码，变成黑白两种颜色块画出来。

![](http://img.smyhvae.com/2016052257.jpg)

这里要细说一下纠错码。在识别二维码时会出一些小错，有的点块会判断出错，比如把黑色认成了白色，也有的点会被挡住，比如大家经常在二维码中间放一个Logo，这样信息就出现了缺失。这部分缺失的信息，我们可以从纠错码中还原回来，纠错码有LMQH四种级别，分别表示有7%、15%、25％和30%的信息即便是丢失了，也可以从纠错码中还原回来。所有如果你想让二维码信息准确识别成功，最好在生成二维码时，将纠错级别设为H。

你可能注意到了，**信息到二维码之间的转换，就是01和黑白的色块之间的转换**，通常使用黑白色，是因为它们的区分度最大，识别率更高。当然，并不是一定要用黑白二色，只要将二维码中对应的区块做的有一定区分度，扫码软件仍然可以将信息完整的解析出来。这样就给了我们一个机会，可以做出更漂亮、更个性化的二维码。下面这张图片就是将本公众号的Logo直接画在了二维码的背景上，同样也能扫描成功，你可以试试～

![](http://img.smyhvae.com/2016052258.jpg)

总结起来，要想推广效果好，你做出的二维码一定要是好看的、扫描起来又快又准的。


## 2016-01-22-天天鼓捣数据，你知道数据库长啥样吗？（续）

是的，你没有看错，不是发重了，本文就是大前天的文章《天天捣鼓数据，你知道数据库长啥样？》的续篇。这几天有些同学在后台留言表示想进一步了解数据库的相关技术，确实之前的文章限于篇幅，只介绍了一些基本的概念，今天我们来把剩下的东西补一补。

现在，我假设你已经被我成功灌输了 「数据库就是一个大文件，里面有很多表，每个表就像Excel一样，存储了若干条记录」这样的概念。但是，过年回家长辈问你什么是数据库，光这样回答是拿不到红包的，所以我们继续来深入探讨一下下面几个问题。

- 什么样的数据适合用数据库来存？

结构化的数据。有的数据，天生就有很好的结构，比如要记录一个人，我们会这样描述：罗玉凤，女，1985年9月生，重庆市綦江区人。要记录一部电影，这样描述：《星球大战》，导演乔治卢卡斯，科幻片。这样记录数据最大的好处是方便查询，你要查凤姐的身高，输入「凤姐，身高」两个关键字就可以了。非结构化的数据，比如苍老师.avi、小苹果.mp3这些，就不适合用数据库来存。你拍了一张凤姐的照片准备存起来，先不说能不能放到数据库里，你要让计算机根据一张图片来得出凤姐身高这样的查询结果，目前的科技水平还是很难做到。那非结构化的数据怎么存呢？我上传了一张个人头像到微信上，微信的服务器就会把这个头像的图片文件存到服务器的硬盘上，然后把文件路径存在数据库里。这时候你再去请求这张头像，输入微信id，头像这样的关键词，微信就会先去数据库查你的头像文件对应的路径，然后根据路径在硬盘上找到文件回给你。

- 如何来设计一个数据库？

什么？数据库还需要设计？别慌，先来看个例子。你公司的程序员终于忍受不了产品经理无节制的加需求，愤而离职，留下一个朋友圈消息后台需要你亲自上阵。用户编辑完要发的消息之后，会发送到你这里，你需要把这些消息完整的存到数据库。每一条消息是这样的：

![](http://img.smyhvae.com/2016052259.png)

到这样的数据之后，你应该如何设计一张数据表的结构呢？前面讲过，表是由行和列组成的，每一列表示一个属性，每一行表示一条信息。这个跟Excel对比起来很容易理解，每一列的属性确定了之后就不变了，以后每来一条数据，就添加一行。

![](http://img.smyhvae.com/2016052260.png)

这样就可以满足我们的需求了。但是，等数据量大了之后，我们就会发现这个表是有缺陷的。首先是数据冗余，每次李小花同学发表一条消息，就会把他的昵称、性别、姓名重复插入到我们的表中。其次，如果在未来的某一天，李小花改了她的昵称，那么我们要遍历整张表去更新她的昵称(可能现在已经有上亿条消息了），这也是不现实的。所以这里需要把表拆成user表和message表。拆表之后，通过姓名李小花既可以查到她的个人信息，又可以查到她发的所有消息。

![](http://img.smyhvae.com/2016052261.jpg)

![](http://img.smyhvae.com/2016052262.png)

这样就可以完美解决上面的两个问题了。这个过程叫规范化，就是说数据库的设计是有一些规范的，这些规范经过了严格的数学证明，你一定要遵守。

- 就差一个码代码的了。

之前的文章介绍了SQL语言，它是专门用来操作数据库的。编程语言你可以理解为是一些命令串起来，每一条命令都可以让系统实现一种功能。上面的两张表，我们这样来创建：

```
create_table user(姓名 varchar(20),昵称 varchar(20),性别 varchar(10));
create_table message(姓名 varchar(20),时间 datetime,message text);
```

对表本身的操作除了创建，还有drop(删除)、alter(更改属性)等等。

当有用户新发表了一条消息，我们可以这样插入到表中：

```
insert into message values('李小花'，now(),'I am very OK!');
```

当客户端来了请求，要查询王小龙同学的所有消息的时候，可以这样:

```
select * from message where 姓名='王小龙';
```

对表内数据的操作还有delete(删除)、update(更改)等，当然最精髓的还是查询select了。我们浏览贴吧看帖子，上微薄看热门都是执行的select命令，这个命令的执行速度直接影响到用户的体验，所以程序员必须优化好。

数据库这块儿的东西先讲到这里，一些代码大家看不懂没关系，如果以后用的上，知道是怎么回事儿再去查就能学的很快。但是，即使知识get到了也千万不要去程序员那儿秀技术，程序员都觉得自己技术最牛b，你就让他继续牛b下去，对产品经理也没啥坏处，哈哈。

PS：这年头大家都在搞开源，连特斯拉的汽车也开源了，本公众号也响应号召，所有文章在不乱改内容的前提下可以随意转载，不需要授权。讲究点儿的，可以把下面的二维码带上，不讲究的，我也不准备去告你，哈哈。

## 2016-01-23-Toilet Administrator 升职记

我是一名Toilet Administrator（为什么我要用这个称呼？因为显得高端大气上档次），这是我的自白：

我本是一个没有什么追求的人，在这个岗位上卖了那么多年的纸，也结识了附近的一些同行，大家也算投缘，说好了互相帮忙，要是谁Toilet的坑位不够了，就把人推荐到对方那里，有钱大家一起赚，对不对？

平时，人还挺少，我这还应付的来，可是一到节假日，我这儿的人就排起了长队，我还得不停的推荐他们到其他的 同行那里去。可是有一次，一个人也不知是不是因为内急到脑袋不清醒了，他来过我这里好几次了，每次都说是别的地方没位子了，然后被推荐来我这里的，可当他最后一次来到我这里时，我被震撼—-他在我面前急崩了。

这件事改变了我的人生观，我觉得我的职业太重要了，我需要不断的学习，提升自己，来为大家提供更好的服务，以免这样的事情再次发生。于是，我开始拜读我们这个行业的秘籍—负载均衡。读完第一章，我才知道我和那位同行处于这个行业管理水平的最底层—-软件负载。

**一旦Web服务器认为自己的负载较大，它就让浏览器去服务器集群中的其他服务器上获得所需要的网页。**

虽然这种互相推荐的方式能够一定程度上缓解大家如厕拥挤的问题，不过也难免造成在如厕高峰期互相推来推去，久不得的惨象（死循环）。

当我读完秘籍第二章—-DNS负载时。我的管理思想被拉到一个新的高度。

**在DNS服务器中，可以为多个不同的地址配置同一个名字，对于同一个名字，不同的客户就访问不同地址上的Web服务器。**

当我向管理委员会说了我的想法时，他们都觉得我是可造之才，把我提上了主管的位子，让我干着试试看。于是我开始了全新的工作方式，每个有到我管理的这个片区如厕的人都会在我这里得到指引，为了让我原来的那些同行不会觉得我偏心，我非常平均的给他们做推荐。

可当我自以为自己做的很好的时候，我收到了一大波投诉，有来自同行的：“我搞这么大的Toilet，才来这么几个人”，有来自客户反馈的“给我介绍的什么啊，坑位那么少，害我排那么长的队”。

高层看到这些反馈，对我很不满意，警告我如果不解决，就把我给撤了。这吓得我赶紧拿起秘籍继续拜读起来。

当我读完秘籍的第三章—-交换负载，我才觉得我傻的可笑。

**客户端的Http请求会先被交换机接收到，它将基于第四层交换技术实时检测后台Web服务器的负载，根据设定的算法进行快速交换。**

我很快根据这个思想实践起来。我给这个片区所有的Toilet Administrator配了一部对讲机，随时向他们了解哪里坑位紧张，哪里坑位还比较充裕，同时也能通过他们回应我的态度了解到他们忙的程度。要知道信息时代，掌握一手资料的重要性不言而喻。

自从这么搞了以后，我就能准确的向每个客户推荐最合适的Toilet，以便他们能够最快的释放自己。很快，给我好评的人渐渐超过了给差评的人，高层对我的管理成效也颇为满意，提拔我为Toilet总监。

当然，我现在是一个追求卓越的人，秘籍的第四章最终帮我坐上了Toilet经理的位置。想知道第四章讲的啥，你也去读读这边秘籍呗！


## 2016-01-24-五分钟理解什么是接口

后台留言中，好多朋友问我能不能讲讲接口，我只想告诉你，在这个公众账号中，没什么不可能的~，搬好小板凳，手背后了哦~

在IT和互联网领域里面，这个词在不同场景下都会出现，比如“USB接口”，“让后台给我提供一个接口，我直接调用这个接口”，“这里你设计一个接口，我来实现”，分别对应于硬件场景，后台场景，以及面向对象的程序设计场景，我先用一句听不懂的非常抽象的话来描述下，**接口就是提供具体能力的一个标准和抽象**，OK，你肯定没听懂，我下段开始举例子，说人话来解释。

接口就是提供一种别人可调用的能力的标准，比如你写一封简历找工作，这个简历就是你的接口，这个接口描述了你具备的能力，比如有如下三点1. 熟练使用Office 2. 极度会拍领导马屁 3. 以前在学生会工作，具备非常强的协调能力。对外暴漏了这个接口之后，老板看你具备这三项神奇的能力，聘用了你，领导说，快给我拍拍马屁，那就是调用了你第二项能力。

这里例子表明，任何一个接口都被定义为了能力的集合（就是指例子中那三种），这个例子解释了前面那句不好理解的话的前半句，接口提供了能力，假设你听明白了，哈。

下面解释后半句，为什么是一个标准和抽象呢？这是神马意思涅？我们举例USB接口，大家都知道这个USB接口是一个国际标准，用来连接设备的，注意哦，亲，这里出现了”标准“这个词，这个国际标准定义了什么呢，定义了USB接口全部可以对手机进行充电，并且可以传输数据，并且定义了相应的电压和电流标准等等。那真正在市场上出售的USB，有可能是华硕，三星这样的大厂家做的，也有可能是东莞一个手工作坊出的，但是他们都遵从了这个国际标准，不遵从的话，显然你根本就卖不出去，因为你这个接口连不上PC和手机。这段话包括了两层意思，第一层意思是接口的定义是一套标准和抽象的能力，他只是声明出来，让别人去实现。第二层意思是接口的标准定以后，实现者可能是另外的可能完全不相关的实体。

目前讲了三层意思：

1. 接口定义了一组能力

2. 接口有定义者和实现者

3. 接口定义一般是抽象的，不包括具体的实现

再来回顾文章开头说的那三个场景，USB接口只是一个标准，任何符合这个标注的USB线都能插入到这个接口上。“后台给你提供一个接口”，这句话在工程中一般表示的是提供一项能力，仅仅只提供一项能力来供你使用，这个跟我们上文讲的接口的定义不完全一样，比如：我做后台，提供了一项能力是，终端可以到我这里调用我的这个接口查询当前所在位置的天气，这种用于在开发过程中讲的是比较多的，常用于前端和后台的联调。”你来设计一个接口，我来实现“，这种一般是在面向对象的程序设计中，对一种能力的抽象，然后分别由不同的开发者来实现，比如我们要实现两种门，一种门是密码锁，一种是钥匙锁，那抽象出来的通用的接口能力就是开门和关门两个能力，而密码锁和钥匙锁分别来实现，显然他们对开门和关门的实现是不一样的，一种是输入密码，一种是用钥匙，如果你负责开门或关门，你只需要看到接口说，可以关门和锁门，根本不用关注关门和锁门的具体实现，有效隔离了调用者与具体实现过程。“门”这个例子是最简单的一种面向对象设计的实现，以后给你们讲讲哦，你们先简单预习下，哈。哈。哈。哈。

讲完了哦，记住一句话就可以了，接口象征着提供出来的能力，定义者和实现者一般是不同的，调用者并不需要关注具体细节，只需要关注接口暴漏出来的能力就可以了。

以后如果程序员说，我需要定义一套接口，你应该明白它是在抽象一种能力集，保证调用者只需要知道这个能力并调用，实现者不需要关心谁调用，只安安心心的做好功能就好了。是不是显得很牛逼，牛逼，逼。。。。。。，**接口的这种思想，首先保证了大规模程序开发的可行性，通过接口的设计，一个系统被清晰的定义成了多种能力的集合，每一个开发者只关注自己的模块实现就好了，而调用者才负责完成整个程序的业务逻辑**。其实不止程序员需要这种抽象能力，产品经理难道不需要对一个复杂业务进行这种抽象和封装吗？

以后如果程序员说，你给我封装一个接口就好了，我直接调用，你应该理解，他说的意思就是，别他妈让我知道你是怎么实现了，只要我要用的时候，你给我正确的结果就好了。

接口讲完了，希望你能听懂，以后能跟程序员好好交流了，时不常很随意的说一下，后台给你暴漏个接口，你调用一下不就行了，这种装逼应该不会遭雷劈，哈哈。

最后再回答几个后台留言问题。

问题1：你为什么做这个事情？
答：我就想看看能不能每天坚持做一个事情，能不能坚持至少一年，生活找点节奏感。

问题2：微信有原创，你为什么不用呢？
答：可能是收听的用户数量还不够，总之目前是没有获得原创功能邀请的。

问题3：你觉得最多有多少人会收听你？
答：15亿啊，因为人人都是产品经理。

问题4：你是爷们儿还是妹子？
答：是爷们儿，亲，你失望了吧，哈哈。

问题5：你多大了？
答：比TFBOYS大，具体无可奉告，人家也是很矜持的呢，哈~。

问题6：有的时候没办法直接转化到工作中使用啊，能讲点儿和我工作相关的吗？
答：亲，不要那么“功利”嘛，再说我也不知道你做什么的啊，你又没在后台告诉我。就当我是你一个朋友，整天跟你叨逼叨说点儿技术方面的事情，只要输入够了，总有一天会有输出，信哥，不一定得永生。



## 2016-01-25-压缩算法浅析

zip文件、rar文件想必大家都使用过，啥？没用过？那你肯定双击打开过.7z格式的文件吧？


没错，这种图标的文件就是压缩文件，由于我们经常将一批相关的文件“打包压缩”到同一个压缩文件中，所以我们平时还会称这些文件为“压缩包”。

这种文件都需要解压后才能使用，而且一般情况下，解压后的全部文件的总大小都会比压缩包本身大得多，就好像从一个只能容纳一只喵星人的箱子里，牵出来一只大象。

那么压缩文件是如何将“大象”放到箱子里的呢？聪明的你肯定已经知道了答案，那就是“压缩算法”。

压缩算法主要分为两大类：

### 有损压缩

顾名思义，**有损压缩算法**在“压缩”文件的时候，**会导致原始文件中的部分数据丢失**，使用这种压缩算法压缩后的文件，**解压后无法还原成原始文件**，只能得到原始文件的一部分。如果我们可以准确的判定哪些数据是可以“丢失”的，使用这种算法将会得到比较低的压缩率（压缩后文件大小除以原始文件的大小）。就像旅游时买的东西太多，无法装到行李箱时，需要把一部分商品的包装拆掉减小体积。

前面说的可能有点抽象，我们来举一个具体的栗子：使用MP3编码格式对原始音频文件进行压缩编码时，可以选择将人耳无法感知的高频数据丢弃，从而达到10%甚至更高的压缩率。

### 无损压缩

与有损压缩不同，**无损压缩需要保证压缩后的文件在解压后可以得到完整的原始文件**，也就是说必须把大象放进瞄箱子后，还要保证还能把大象能从箱子里牵出来。这种压缩算法的应用场景是显而易见的。当我们将一个五千字的文本文件压缩后，不想在解压后只能得到四千八百个字。

由于要保证压缩后的文件保存有100%的原始文件信息，所以无损算法就无法利用“丢弃一部分原始数据”的方式来提高压缩率。那么无损压缩算法是如何实现文件压缩的呢？下面再来一个栗子：

在这篇文章中，“压缩算法”这个词我们一共使用了13次，如果文章是用Unicode编码，每个词占用的空间是8个字节（一个汉字用两个字节表示），那么所有的“压缩算法”就占用了14*8=112个字节。

现在，我们在压缩文件中建立一个字典“压缩算法:A”，表示把“压缩算法”映射为字符“A”，原来需要8个字节表示的字符现在只需要一个字节表示（一个英文字符用一个字节表示），这样，我们对文章中“压缩算法”这几个字符的压缩率就是（字典大小 + 13次A字符的大小）/（压缩前总大小）=（10+13 * 1）/112=21%

栗子终归是栗子，真正使用的无损压缩算法要复杂的多，简单列几个ZIP压缩算法相关名词大家感受下：LZ编码、Huffman编码、Deflate树...

总而言之，**有损压缩主要是利用“丢弃无用信息”的方式实现文件压缩，压缩率比较高；无损压缩是利用数据的统计冗余进行二次编码，可以保留100%的原始数据**，就好像我们把海绵放在了真空压缩袋中，打开袋子还能取出一块完整的海绵。

最后，附上两类压缩算法对应的常见文件类型。

![](http://img.smyhvae.com/2016052263.jpg)


## 2016-01-26-产品经理需要掌握的开发技巧之：Chrome DevTools的使用


今天要聊的开发技巧并不是要让各位产品大拿们转岗成为开发，来抢我的饭碗。只是想告诉大家，如果知道这些技巧，也许会对你的工作带来一些方便，就像学会了茴香豆的茴字有四种写法。

Chrome DevTools是Chrome浏览器自带的一个调试工具，在浏览器里面按下F12键或者在设置-更多工具里面就能找到它。这个工具主要是给前端工程师调试页面用的，但是我们也可以利用它来做一些和开发无关的事情，下面来看看。

**1. 修改页面内容：**

你或许有这种需求，要改动网页上的一段文案或者字体颜色，看一下效果是否满意，或者说为了装逼，想秀一下自己支付宝8千万的余额，这些都可以通过简单地修改页面内容来实现。

**操作方法**：选择Elements这个Tab，点击左边小箭头，移动箭头到你要更改的地方点击，对应页面元素你就找到了，修改里面的内容会立刻显示到页面上

![](http://img.smyhvae.com/2016052264.jpg)

**2. 查看手机版网页：**

有时候想看某个H5页面在手机浏览器里或者在微信里面打开是什么样子的，并不需要拿出手机来看，只需要在开发工具里面，使用模拟屏幕工具，照样可以达到目的，这样是不是更方便截图呢？

**操作方法**：点击左边的手机图标，选择你想要的机型，输入网址，手机版页面就会展现在你面前。

![](http://img.smyhvae.com/2016052265.jpg)

**3. 下载图片、视频、音频：**
有很多网页限制了你右键另存图片或者音视频，不要灰心，毕竟你是懂技术的产品经理，这张图片已经被你的浏览器拉到本地了，你肯定能把它找出来的。

**操作方法**：选择Resources这个Tab，如何找到Images目录，下面是这个页面中用到的全部图片，只需要找到你想要的图片，就可以右键保存了；如果你还懂一些代码，也可以用方法1中查找页面元素的方法去找到图片URL。

![](http://img.smyhvae.com/2016052266.jpg)


**4. 模拟低网速用户：**

也许偶尔会收到用户的抱怨，说你家网站在2G/3G下打开速度很慢，或者说很费流量，但是平时你的体验却感受不到这些，这个时候你可以用DevTools的模拟网速工具，来体验一下低速环境自家网站的效果。同时你还能看到每个请求耗费的时间和流量，如果发现一些比较夸张的现象，可以立马截图去找开发优化，这时开发哥绝对不会拒绝你的需求。

**操作方法：**选择Network这个Tab，右上方可以选择一个想要模拟的网络环境，然后输入网址，所有网络请求耗时和流量都展现下方列表里了。

![](http://img.smyhvae.com/2016052267.jpg)

先介绍这4个小技巧，Chrome DevTools里面还有很多其它功能，拿出你体验产品的好奇心，前去挖掘吧，说不定还能发现什么惊喜呢。


## 2016-01-27-程序员，你整天在忙啥

平时工作的时候，经常有产品妹子呼哧呼哧的跑来找我，说你快看你快看，这儿程序有问题，你得改一改。我拿来一看，内心顿生鄙夷，这特码明明是后台的问题，你找我一个做前端的弄啥咧。但是为了顾全同事间的革命友谊，我还是会笑呵呵的说好啊好啊，我先调查一下，如果不是我的问题，我转给其他人。

也难怪，隔行如隔山。这几天后台有不少同学问前端后端前台后台的概念，今天我就冒着被组织追杀的危险，跟大家聊一下程序员每天在忙啥，你会看到，不同岗位的程序员，工作上到底有什么区别。

要理解程序员不同的岗位，首先你得看下市场上有什么样的需求。用户上网、打开APP，本质上是在获取信息。信息就是数据，数据在哪里？数据在服务器上。我们之前讲过，互联网一切皆下载，下载的就是服务器上的数据。不同的数据有不同的展示形式，视频数据会用视频播放器来播，网页数据要用浏览器来看，朋友圈里的新动态，要用微信APP来展示。所以你看到了，整个过程需要两拨人合作完成。一拨人负责管理数据，一拨人负责展示数据。这也就是最简单的前台和后台的划分。那些整天守着服务器捣鼓数据的，是后台开发。那些整天琢磨如何做出花里胡哨的展示界面的，是前端开发。

先说说前端开发。前端开发概念比较广，用户直观看到的东西，都属于前端开发的范畴。现在比较流行的有三个，Web前端开发、Android终端开发、iOS终端开发。

### Web前端开发

![](http://img.smyhvae.com/2016052268.jpg)

这些人整天和浏览器打交道。昨天的文章讲的ChromeDevTools，就是他们天天用的东西。他们写出来的代码，要放到浏览器里去运行，然后就成了你看到的各种网页。但是你不要以为人家只是一做网页的，这几年大有Web前端一统江湖的趋势，因为他们写的代码不需要发布版本就能上线，不信你可以查看前面关于ReactNative的文章。如果哪天你也想写写代码体验人生，建议看看Web前端的知识，之前讲过简单的HTML+CSS+JavaScript，学着敲一下，然后打开浏览器看看效果，你会发现其实人人都可以当程序员。


### Android终端开发

![](http://img.smyhvae.com/2016052269.jpg)

他们个个都是爬墙高手，因为他们的老大哥被关在了墙外。他们个个油光满面，大好青春都浪费在了无穷无尽的机型适配上面。他们用Java语言写代码，但是Java语言天生相比很多语言执行速度慢，所以他们天天被用户吐槽卡顿，但是没有办法，只能不停的优化再优化。


### iOS终端开发

![](http://img.smyhvae.com/2016052270.jpg)

iOS开发血统纯正，一般人手一套Mac+iPhone，光是生产设备就要上万。他们的开发工具叫XCode，号称最优秀的编程工具。程序界有句名言叫不要重复造轮子，意思是别人已经写过的代码，就不要重复写，直接拿来用。iOS这么多年，有很多轮子可以用，都在Github上。本来要一个星期做完的功能，用好Github可能一下午就实现了。所以我们说，我们不生产代码，我们只是Github的搬运工。当然这个是不会轻易告诉产品经理的。

### 后台开发

![](http://img.smyhvae.com/2016052271.jpg)

在介绍后台开发之前，我们先来看看后台服务器面临的困难。你的产品刚刚上线，只有几十上百个用户的时候，你只需要一台PC，加上稍微快点的网速，随便下载个开源的服务端软件就能勉强应付得来前端的数据请求。后来你下血本搞运营，引来了一大波用户，达到成千上万级别的时候，你就得租一台正儿八经的服务器了。再后来，用户量呈指数上涨，你开始幻想从此登上人生巅峰的时候，忽然发现无论有多少台服务器，总是没办法快速响应前端的请求。

后台开发就是来解决这样的需求的。为了让各个服务器同时并行工作，他们研究分布式算法，把大任务拆成小任务，分布给各个服务器单独运算。为了提高数据库的存取速度，他们研究非关系型数据库，也就是NoSQL，把它们用在社交、O2O应用的后台。为了解决硬盘速度远远跟不上内存速度的问题，他们研究缓存技术，简单来说就是数据从硬盘里取出来就不放回去了，这样下次还用就不用再去硬盘取了。当然，也有一些后台开发专注于业务逻辑，前端想请求什么样的数据，大家坐在一起商量一个协议，他们负责写个接口，前端来调用就是了。

还有一种被称为科学家的程序员，他们天天看论文搞学术，不参与实际的产品开发，但是每发一篇paper都能搞一个大新闻出来。我们今天习以为常的东西，比如程序的运行编译，计算机的架构原理，都是几十年前的科学家程序员摸索出来的。也许几十年后，现在看起来高大上的机器学习、自然语言处理等技术，会成为每个程序员的必修课。

当然，程序员远远不止这些，限于篇幅仅仅列举互联网行业的一些代表。最后，如果你发现你身边有这样一个人，他前端后台，样样精通，文能提笔发paper，武能调试除bug。请不要害怕，这种人叫做：全栈工程师。


## 2016-01-28-微信红包照片，不给钱怎么看

微信红包照片昨天席卷朋友圈，我打开的时候，哎呦，全是模糊的图片，我以为自己得了白内障，可吓人了呢：）。

瞬间就有程序员破解了微信的技术实现原理，也就是不花钱看照片，有的妹子还真把大长腿照片往上发啊~

**1. 不给钱看到清晰图片的技术原理**

对于发照片的人来说，红包照片和普通照片没有任何区别，朋友圈服务器里面存储的就是你发的清晰的图片，只不过发送到朋友圈的时候，客户端告诉了服务器喊话，“这是一张红包照片哦，服务器你别忘记了哦“。

对于看照片的人来说，你进入到朋友圈的那一瞬间，刚才被上传到服务器上的那张清晰照片被拉取回来，但是服务器同时告诉你，“亲，这是一张红包照片哦”，客户端理解“我擦，先别显示，红包照片必须打碼模糊，不能让那帮孙子直接看到底裤”，于是一个高斯模糊的函数被施加在这张图片上了，也就是我们看到的模糊图。当你付款后，客户端把这层处理去掉，你就看到了清晰图，就这么简单。

聪明的程序员就想，既然下发到客户端的是一张普通照片，那我清空所有微信的缓存，重新进入朋友圈的时候，这个时候缓存被清空，会重新去服务器拉取这张照片，这个时候我通过抓包不就拿到了图片的数据了嘛，果然，通过网络抓包，得到图片数据，就看到了那张清晰的图片。

好多亲说，如果从后台下发下来的就已经是模糊的图片不就行了吗？这个时候是没办法直接拿到清晰图片了，但是会影响什么呢？

首先，用户点开一张红包图片的时候，就不会产生一块随机清晰的区域了，没有这种感觉，估计“**挑逗性**”会大大下降，付款率应该会有下降吧。

再有，如果付了款还要去后台拉一张图片，体验也大大下降，这种延时拉取，不满足用户付款后需要享受的即刻获得的尊贵感，并且对于一张图浪费了两次流量，并且对于后台服务器也是双倍的带宽耗费。我相信这种设计不是漏洞，是综合了多种用户场景和体验平衡的决策。

再说，15亿中国人，会抓包的比例太小了，微信被破解，反而会加大传播广度，太合适了。

**2. 为啥客户端没有更新版本，客户端就具备这种能力**

这是因为这个功能早就埋到以前的版本中了（即判断是否是一个红包照片以及模糊的处理的代码早就写进客户端了），是由云端指令来控制这个功能是否打开，因为微信一直和后台在保持长链接，所以对每一个客户端下发一个开关指令打开这个功能相当容易，这条指令翻译成人话是这样的“请在今天下午五点打开红包照片功能，直到八点结束，只在这区间生效”。

类似于，16岁的时候你就具备繁衍后代的能力了（早就发布了），只不过一直没有收到国家的许可（云端指令），直到22岁，国家说可以领证了，这个时候你才能做爱做的事情。


## 2016-01-29-微信红包照片事件后记

微信红包照片的发布一时间挑动了无数人好奇的心。在大家都在吐槽朋友圈都看不起的时候，一波免费看红包照片的攻略随之而来。对一些搞技术的人来说，把收费的内容搞成免费的特有成就感，国人免费主义的思想也是根深蒂固，所以网上才有那么多的破解软件。

但是换个角度说，安全技术上的攻防战也是促进安全技术发展的一个重要因素，只有这些丧心病狂的攻击者不断挑衅，软件开发者才会更加重视自己软件在安全性上的设计，用户使用的软件也才更有保障。
那么，这里就来说说微信红包照片事件的在安全技术上的两个关键词：漏洞、后门。

首先我们来说说漏洞。漏洞是指软件设计的缺陷，免费看红包照片的原理很简单，前面一片文章已经介绍过，就是利用了微信消息的缓存以及明文传输的漏洞，只是后面微信通过对图片进行加密的方式让抓包解图的方法失效，这便是一次典型的一次安全攻防。从安全角度上来讲，软件设计都不可能绝对完美，即使微信对图片进行了加密，更高明的技术宅也能够通过各种方式拿到加密的key，来破解加密的图片，只是做这件事情的价值实在太小，技术宅不屑于做罢了。

然而，任何防御都是有代价的。以微信的量级，如果红包照片正式发布时足够火爆，那么对每张图片都做一次加密，会再次挑战微信后台的处理能力。作为产品经理，不要期待软件绝对的安全，有漏洞实在是太正常不过了，关键是漏洞的价值。对漏洞价值评估的时候可不能仅仅考虑自己的因素，作为用户信任的角度来讲，用户一般不会轻易安装陌生的软件，即使安装了也不会轻易同意这些软件申请的权限，但是作为流行的软件来说，用户信任感会更强，例如读取联系人，获取位置，甚至请求root的权限都会同意，因为他们相信这些软件不会伤害自己。一旦这种类型的软件有漏洞，很容易被别的恶意软件群起而攻之，虽然这些恶意软件本身没有权限去破坏用户系统，但是他们可以利用这种已经被用户赋予高权限的软件去间接的搞破坏。例如前段时间百度系APP爆出的漏洞导致其全线Android产品下架。

作为开发来讲，需要知道自己选择的技术策略存在怎样的漏洞，而作为产品来讲需要评估漏洞的价值。如果低价值的漏洞能够节省大量的资源，其实也不是不可以接受，但是评估错误，需要承担的风险就很大。

再来说说后门。后门是潜伏在软件中的代码，用户平时感觉不到它们的存在，后台可以通过指令改变软件的行为。微信这次没有发布新版本就完成了一次红包照片的测试，说的好听点就是在软件中预埋了一些接口，说的不好听，就是留了后门程序。红包照片最初上线是明文传输的，被爆出漏洞后，修复的版本变成了加密传输的。这个过程中我们忽略了一点，就是终端行为悄悄的发生了改变，从直接展示图片变成了解密数据再展示图片。由此推测，微信应该知道最初的版本是存在漏洞的，所以它也留了修复此漏洞的后门代码。或许微信正想借此获取明文传输和加密传输图片对其服务器冲击力的数据样本。

后门程序用的好可以给程序带来很多便利，但是一旦被破解，控制权就会被别的软件接管，后果可大可小。所以要做"安全的后门"。这也是一个悖论，就像安全软件都是不安全的一样。很难说漏洞和后门是不是不好的，例如一把伤人刀在厨师手里却能做出美味的菜肴，所以坦然接受吧。

惹不住又想吐槽了，年会抽奖又是完美闪避，中奖的还是那几个，尼玛是不是抽奖系统有漏洞啊！！！

## 2016-01-30-年会又没中奖？一起来review抽奖代码！

2016年已经过去一个月了，你那些2014年制定的在2015年完成的计划，现在进度怎么样了？不管你的计划完成的怎么样，各大公司一年一度的年会可都在按部就班的进行中了。

说到年会，除了看其他同事在舞台上群魔乱舞外，最令人期待的应该就是年会抽奖了。普通公司年会抽IP6S、iPad，土豪公司抽捷豹XF（尼玛还俩），2B公司发彩票。不管奖品是啥，幸运都是相似的，没中奖的人却各有各的不幸，我都不幸了好几年了！

然而作为一个若干年没中奖的程序猿，苦逼程度却远不及下面这位：

![](http://img.smyhvae.com/2016052272.jpg)

既然CTO号召大家review抽奖代码，那咱们就说说抽奖代码。

抽奖代码的流程一般是这个样子的：通过获取一个系统生成的随机数，然后将这个随机数映射到员工名单中的某一位同事，被映射到的同事就是中奖人。这样整个抽奖过程就算完成了。

描述的可能有些抽象，咱们继续举个栗子：公司中有一百个员工参与抽奖，我们把这一百位员工按1到100编号，每个员工获得了自己的编号后，CTO点抽奖按钮，程序从系统内获取到一个[1,100]区间范围内的随机数，那么这个随机数对应的员工就是让大家眼红的幸运员工！

生成随机数是个很有学问的问题，如果有兴趣研究的话或许能发表一两篇学术论文也说不定。不过好在我们现在使用的开发语言，都已经内置了产生随机数的方法和函数，用这些方法和函数可以获得系统生成的伪随机数。

**为什么是伪随机数呢？因为通过这种方式得到的“随机数”都是系统根据公式算出来的**！既然是算出来的，那么只要输入的参数一致，那么每次获得的随机数就是同一个。输入的参数我们叫做seed。也就是说，如果程序设计者使用了一个预先确定好的seed来生成随机数，如果抽100次奖，那么这100次中奖的都会是同一个人，或者同一批人。更有甚者，虽然每次使用的seed看似不同，但这批seed会让特定的一部分人中奖概率更大！

哎哟，这里可以作弊哦，快review下这个抽奖程序里面有没有这样做。

通过上面的描述可以看到，**伪随机数的生成其实是可以预测的，因为他有固定的逻辑（公式）可循**，如果要彻底实现随机，那只能使用真随机数。

**真随机数是电脑通过对一些没有规律的自然现象量化后得到的，比如热力学噪声、量子现象等**。获取这些真随机数的获取代价显然比用时间做个seed高多了。如果大家觉得年会抽奖的算法有必要使用真随机数，也有办法做到，random.org这个网站就提供了一系列通过“大气噪声”获取随机数序列的在线API，通过这些API获取的随机数序列都是真随机数。

作为N年不中奖的人，我觉得还是有必要使用真随机数的！因为这是一个十分严肃的问题，你说呢？


## 2016-01-31-琅琊榜-编程语言篇

小时候经常看局座的节目，得知局座掌握中、英、日、阿拉伯等多门语言时羡慕不已，当时就许下一个心愿“我一定要成为掌握多门语言的男人”。今天，我的梦想终于实现了，我成为了一个程序员，也成为了掌握了多门(编程)语言的男人-_-!

段子讲完了，我们先来看张榜单，这张榜单展示了GitHub(就是以前介绍的那个最大的编程社交网站)上最热门的编程语言，今天就来简单介绍一下这些语言的特点和应用场景。

![](http://img.smyhvae.com/2016052273.jpg)

**1. JavaScript**

JavaScript没听过？H5你总听过吧，要做一个H5页面，必然要会写JavaScript。JavaScript是一种脚本语言，通常它运行在浏览器里面，为网页制造各种前端交互以及炫酷的特效，这是前端攻城狮的必备技能。最近出现的NodeJS，将它的触角延伸到了后台服务，在NodeJS的帮助下，也可以用JavaScript写后台服务器程序了。可以说，现在JavaScript是前后端通吃，这也是它能高居榜首的原因之一

**2. Java**

Java和上面的JavaScript什么关系？答案是雷锋与雷峰塔的关系，它们仅仅是名字相像而已。Java比JavaScript早出生好几年，它是SUN公司开发的一种跨平台语言，Java的应用非常广泛，它可以用来编写客户端程序、后台服务器程序以及Android App，各大银行和淘宝的后台程序，大部分都是用Java编写的

**3. Ruby**

Ruby是日本一哥们松本行弘创造的一门编程语言，它是一门简洁快速的动态语言，搭配Ruby on Rails这套框架，可以用来快速方便的开发一些网站应用程序，像GitHub和Airbnb都是基于Ruby on Rails搭建的

**4. PHP**

PHP也是一种脚本语言，主要用来编写动态网页，它的语法简单，容易快速上手，同时它的生存能力也很强，支持大部分流行的操作系统和数据库，几乎网上售卖的任何档次的网站托管服务都支持PHP。你肯定听说过“PHP是世界上最好的语言”，不过这是程序猿故意黑PHP时说的话，程序猿们黑PHP的主要原因就是因为它的门槛低容易上手，同时又很流行，他们觉得只有水平比较低人才会使用PHP，所以故意说PHP是世界上最好的语言。但是我觉得还是小平同志说的好，“不管黑猫白猫，能对付产品需求的猫才是好猫”

**5. Python**

Python也是一种脚本语言，它的能力范围也很广，可以用来写后台服务器程序，同时也可以用来写客户端程序（不过用来写客户端程序的人不多），还有的科学工作者用它来做数据分析，以替代Matlab。它的设计哲学是“优雅”、“明确”、“简单”，Python代码写出来一般都很优雅，可读性也很强，这大概也是豆瓣这种小清新网站选择Python作为主力语言的原因之一吧

**6. CSS**

CSS勉强算是一门语言吧，它的主要作用是决定一个网页里面各个元素的位置、颜色、大小等显示特性。如果能访问一个网页却没有加载出CSS，那么你看到的就是下边右图的那种场景，我相信你的内心是奔溃的

![](http://img.smyhvae.com/2016052274.jpg)

**7. C++**

C++是从C语言的基础上发展而来的，从中加入了面向对象的编程思想，通过抽象和接口，使得代码更为有序和简单，如果你看不懂这些专有名词，那么你只需知道，因为程序猿们很懒，想用更少的代码来实现同一个功能，于是他们就在一门语言的基础上发明了另一门语言。C++的应用非常广泛，客户端软件、后台服务器程序、Android App中的一些模块都可以用C++来开发

**8. C#**

C#是微软推出的一种基于.NET框架的、面向对象的高级编程语言，这门语言虽然是盖茨家发明的，但是现在它已经开源了，在Linux和OS X系统上同样可以使用。如果你想编写炫酷的Windows桌面应用或者是Windows Phone手机应用，那就需要使用C#。记得要念"C sharp"哦，不然要被开发哥鄙视的

**9. C**

C语言应该是大家接触的第一门编程语言了，即便不是CS专业的同学，也都被全国计算机等级考试折磨过吧。C语言是一门古老且基础的编程语言，就是因为它是基础语言，所以它什么都能干，从机器学习、操作系统到人脸识别、硬件开发，都会使用到C语言，简直就是通吃。程序猿们更喜欢用其它高级语言主要原因是这些语言将C语言进行了精华提取，用其它语言可以比用C语言开发效率更高，写的代码量更少

**10. HTML** 

HTML是网页标记语言，我们看到的每一个网页都是以HTML的形式从服务器下发的。它标记了页面中各个模块的分布及相应的内容，所以改变了HTML的内容，对应展示的页面也会发生相应的变化。如果你想看一个网站的页面代码，可以使用在之前的文章中提到的Chrome DevTools，查看Elements这个Tab中的内容，就是当前页面的源代码

**11. Objective-C**

虽然Objective-C没有进入前十，但是因为它有个很出名的爹Apple，所以还是简单介绍一下。Objective-C也是C语言的一个升级版，目前主要用于开发Apple旗下OS X系统和iOS上的各种应用程序。

从上面的11种语言中可以看出，其实很多语言的功能都是重叠的，Python可以写服务器程序，Java也可以写服务器程序，哪种语言才是用来开发服务器程序最牛逼的语言呢？其实这是个伪命题，并没有什么麒麟语言，只有最适合当前开发团队和产品项目的语言才是最好的语言，Facebook用PHP不也成为了世界上最大的社交网站吗？


## 2016-02-01-产品后悔药来了，讲讲热补丁技术

每年这个时候，心里总是有两个事情挂念着。一个是准备过年回家，行李打包，机票买好，数着指头过日子就等那一天了。另一个事就没那么期待了，按照惯例，年前总要发一个新版本，抓住用户放假前最后一次露脸的机会，才算圆满。但是过年这几天，公司封网，渠道关闭，发出去的版本就像射出去的箭，你知道它出了问题，却只能眼睁睁看着，风险极大。如何控制风险，这真的是一门学问，但是即使有测试同学一个一个提BUG，灰度环境一次一次放量，还是难免有个别路径覆盖不到。用户反馈论坛炸了锅，面对这种情况，只有一个字，愁死人了。

愁也没用，我们来想想办法吧。最好的办法是让用户不知不觉的情况下更新版本。如果你的产品是一个网站，很简单，让程序员准备一个新版本然后按下发射按钮就行了。如果你的产品是移动端APP，无论是iOS还是Android，都绕不开用户授权安装这一步。什么，你说Android不是有静默安装这一招吗？好吧，这东西是需要Root权限的，Root权限是你想拿，想拿就能拿的吗？当然你要实在是想拿也不是不可以，改天我写篇文章讲一讲，你开心就好了。

此路不通，我们今天的主角要登场了。热补丁，可以做到线上推送一段修补BUG的代码，终端无需更新版本，直接运行。实现方式上，Android和iOS有所不同，限于篇幅今天讲讲Android的，iOS的后面补上。

这要从Android如何运行代码讲起。我们写Android程序，一般用JAVA语言。JAVA是一种高级语言，需要有个翻译器，把它翻译成CPU才懂的机器语言，这个翻译器就是虚拟机。打个比方，清朝的皇帝不懂汉语（别当真），要看懂汉臣们写的奏折，就要雇一个翻译官。翻译官的工作就是，一条条的读取奏折里的内容，翻译成满语，然后一条条呈递给皇帝。这个例子里，奏折是我们写的JAVA代码，翻译官是虚拟机，皇帝就是掌管一切的CPU。一般一段代码执行一个功能，比如从网上下载一首歌曲，就好比皇帝看到奏折之后，开始调度资源着手执行。

要实现热补丁，现在有两种主流的方法。一种是利用ClassLoader的方法，来自QQ空间团队。原理是虚拟机在翻译JAVA代码的时候，会把所有代码分成一个一个的dex（代码集合），依次执行。既然是依次执行，就有个谁先谁后的关系，我们只要把修复的代码段下载下来，改成跟原来有BUG的代码段一样的名字，插入到这个执行队列的最前面，那么运行的时候就会执行替身，真身永远都没有机会执行到。

讲人话就是，最开始的奏折都装在一个大箱子里的，翻译官会从这个大箱子里去取奏折来翻译。后来和珅灵机一动，把所有奏折分拆成很多份，装成一个一个的小箱子。为什么这样做呢？原来和珅虽然在朝中广结党羽，但是难免有几个「不识抬举」的，他们会时不时写一些「BUG奏折」揭发和珅。一开始的时候，举报奏折混在大箱子里，和珅即使知道也没办法阻止。现在好了，和珅知道哪个奏折是「BUG奏折」之后，就会伪造一个同名的「补丁奏折」，然后单独把它装在一个箱子里，把这个箱子放到所有箱子的最前面。翻译官第二天一大早起来翻译奏折的时候，拆开最前面的箱子，就会看到里面的奏折全是赞美和珅之辞，此时真正的「BUG奏折」正安静的躺在后面的某个箱子里，永远也不会被看到（因为虚拟机有个特性，同名的代码段不能有两个在同时运行）。

另一种方法叫Dexposed，来自阿里。这种方法更简单粗暴，它直接接管虚拟机的执行代码流程，本来虚拟机要执行一段有BUG代码，我们可以让它转而掉头去执行另一段没有BUG的代码。这下不得了了，推而广之，如果我们能诱导虚拟机执行任何我们想要的代码的话，你想想，这不是就是外挂吗？好在用这种方法你只能改你自己的APP，要想改别人的APP就要Root权限。还有，这种方法对5.0以上的Android系统不好使，原因是谷歌从5.0开始把虚拟机从Dalvik换成了ART。

还是看例子，和珅这次直接买通了翻译官，要求他每次看到举报和珅的「BUG奏折」之后，直接扔掉，用另一份准备好的「补丁奏折」替换之。然而，也不是人人都是可以被收买的，比如「Dalvik同志」就是自己人，「ART同志」就是一个两袖清风的人。
热补丁技术不光可以用来打补丁，还可以在线更新代码添加新需求。很神奇是吧？俗话说，只有想不到的需求，没有做不到的技术。如果你的产品还没用上这项技术，赶紧给他们提需求吧。


## 2016-02-02-没线，并不可怕？

我们身边有很多可以不用数据线就能对手机文件进行管理的APP，形态上有很多，例如传书，传视频，看文件列表等等。这类APP在PC端一般都不需要对应的客户端，只需要在浏览器中操作即可（有的APP为了提升体验，也会提供相应的PC客户端）。

浏览器不是用来看网页的吗，为什么可以做这样的无线文件管理的工具呢？这里来分析一下其中使用到的技术。

无线文件管理的使用场景是手机和PC在同一个局域网下。连接的过程一般是手机APP会提供一个IP地址，类似与192.168.1.139：80，这样的形式，这时，只需要在PC端的浏览器中输入这个地址，就可以连接手机，进行文件管理操作了。我们来看看这个过程中发生了什么：

首先，该局域网中的路由器为手机分配了一个在此局域网中的唯一标识IP，就如同为电话分配的电话号码。有了这个标识不同的设备才能在局域网中找到彼此，建立通讯。与我们平时看到的域名地址如www.baidu.com不同，这是一个纯数字组合的地址，域名地址是为了方便记忆，最后还是会被DNS（域名解析系统）服务器转换成IP地址。除了英特尔网，一般只有较大的局域网，例如公司网才会有专门的DNS服务器，而家用的局域网一般是没有DNS服务器的，所以暴露的地址都直接是纯数字形式的IP地址。这个IP地址并不是用户在使用这个功能时临时分配的，而是手机在连上局域网时就已经分配好的，这里只是借花献佛显示出来而已。IP地址后面还跟了一个数字，这个是端口号，因为要和应用建立通讯光靠IP地址是不够的，IP地址只帮助外部的请求找到了对应的手机，但是手机上的APP那么多，每个APP又有那么多功能，一个外部请求具体要和哪个功能建立通讯则是靠端口号来区分的。端口号和IP不同，它是在具体APP的网络通讯功能被启用时临时分配的。所以当一个无线文件管理的APP显示了这样的IP+端口号的信息时，它要告诉我们的是这台手机（IP）的无线文件管理功能（端口号）已经准备就绪，等待连接。

然后，我们在浏览器中输入这个地址确认时，就是向这个地址发了一个HTTP的请求，这和我们平时输入一个域名希望打开一个网页的请求没有什么本质区别。这个请求因为有IP和端口号的指引，精确的找到了对应手机的无线文件管理功能。手机侧在收到这个请求时，会将手机文件系统的目录信息（一般是根目录）读出来并数据化，将这些数据放在请求的响应中，送还给浏览器，为了方便用户查看，手机侧会将返还的文件系统的结构数据包装成漂亮的HTML的网页（当然有的APP做的也很简陋），最终展现给用户的是一个网页，里面显示了一个个文件（或目录）的链接，当用户点击这些链接时会再次向手机侧发送一个请求，这次的请求中则会携带用户点击的文件（或目录）的信息，手机侧则会根据请求的不同返回不同的文件结构信息。

这里所有的通讯都是建立在我们经常听到的TCP/IP协议上的，因为使用浏览器作为管理端，所以使用了HTTP协议（建立在TCP/IP协议基础上更高层的协议），如果APP提供了专用的PC管理客户端，那么也可以在TCP/IP协议之上，使用自己定义的协议。TCP/IP就像现实中的物流，只负责货物能够顺利到达收货人手中，至于货物是什么它可不管，收货方和发货方自己协商好就行了。

因为手机端和PC端的使用场景更为广泛，所以用它们来举例，但只要都遵循相同的协议，端可以是任何形态。


## 2016-02-03-不得不知的TCP和UDP

TCP/IP协议，你一定经常听说吧，其中TCP(Transmission Control Protocol)称为传输控制协议，IP(Internet Protocol)称为因特网互联协议，好吧，这都是什么2B名字，根本不知所云，这个时候，计算机科学对于一个没有经过深入研究的人，毫无用户体验可言。

其实TCP/IP协议，是一个协议簇，就是一大堆协议的集合，这一大套协议定义了整个互联网通信的基础，比如一次网络链接要经过哪些步骤，一块数据传输过程中应该如何解释，这块数据该如何展示给编程者等等问题。就好比小时候玩过家家的游戏，谁负责当爸，谁负责当妈，谁负责当儿子，都有明确的指派，谁负责买菜，买菜之后的钱交给谁来管理，如果没花了，怎么办，每天应该几点起床，起床之后应该谁叠被，都会明确指出，每个人都会默默遵从人物角色和规则。TCP/IP整个协议集合大概做的就是这个事情，他包含了很多个不同的角色(对应于协议)，并定义好了数据如何传输，不同角色之间如何协商。

理解了TCP/IP是什么，你应该可以看懂一些简单的技术博客或百度百科里面的一些描述了，时时刻刻认为，它里面包涵很多个协议，这些协议就是一整套规则，它定义了整个互联网如何连接，如何协商的最基础规则。

TCP/IP协议又分为了4层，分别为应用层，传输层，IP层，物理层。

重点介绍下传输层，也就是TCP，UDP两个协议，也是今天最想描述清楚的。TCP的英文前面抄写过了，UDP(User Datagram Protocol)，也是读过之后根本不懂啥意思了。

反正这两个协议，是用来传输数据的，因为他们叫传输层嘛，那不做这个事情，毫无用处了。

我们想象一个场景，网络中任意两个端要通信，会采用什么样的传输方式呢？

想象下人类之间的通信吧。

**第一种是拨电话**，我拨通了你的手机号码，直到你回答“喂，你好”，我听到了这个话之后，我们之间才继续进行交谈。

**第二种是发短信**，我给你的手机号码发送一条短信，然后就没有然后了，有可能你没收到，有可能你收到了一会儿又给我回复。

第一种对应的就是TCP，第二种对应的是UDP，TCP是需要对方确认的，也就是传输之前需要进行“三次握手”(这里又是一个专有名词，就是传输的两端要经过三次确认，才能开始通信)。UDP是比较粗暴的，不管对方什么情况，直接发送，不需要确认过程。

很多博客和书籍中说的，TCP是可靠的链接(因为中间有个Control的单词，带上了这个单词，以为着更可靠哦)，UDP是不可靠的链接就是这个意思。可靠的链接带来的是效率的下降，比如一次网络请求很大一部分时间都是浪费在互相确认的过程当中，资源消耗比较多，但是保证了数据的传输是可靠的，并且数据传输是有序的。不可靠的链接带来的是效率的提升，但可能服务质量有下降。

今天想写这个，主要是想摆脱一种人为的误区，不要以为UDP不可靠，就没有什么应用场景，据说QQ发送数据就是靠UDP发送的呢，虽然是不可靠的链接，但是还是用了很多校验算法保证了数据质量的稳定，同时保证了效率。TCP虽然耗时，但是对于稳定性优先的场景，还是应该有限选用TCP，比如浏览器中访问网页用的就是TCP。此外在一些长连接系统里面，比如微信，连接通道应该也是用TCP建立的，因为要维护一条稳定的信息传输通道。

具体协议是如何控制的，数据包是如何传输的，怎么校验数据的正确性，还有重传特性，这些都是协议中重要的控制过程，但是不做详述了，不但枯燥，而且对于实际的产品并没有什么卵用。具体选用什么样的数据传输方式，应该根据场景而定。

PS：写了4，5个小时，删了改，改了删，删了再改，不知道讲没讲清楚，如果没说清楚，欢迎给我留言，我们探讨之后，我再搞个续集：）


## 2016-02-04-程序员冒死揭露黑产系列之：年产百亿的DDoS攻击

久违的“黑产”系列又更新了，不知道之前的几篇文章有没有帮助大伙儿走向人生巅峰。什么？利润太小？没关系，这次咱们来介绍个年产百亿的。

DDoS（Distributed Denial of Service）的中文译名是“分布式拒绝服务”，音译“弟弟欧埃斯”。

DDoS的基本原理是**通过对服务器发送大量无用的请求，耗尽服务器资源（CPU、内存等）导致服务无法正常运行，正常请求无法得到响应。**

要实现DDoS攻击，就需要攻击者比被攻击者需要更多的硬件资源（更好的Cpu和更大的带宽），一般DDoS攻击者有两种途径获达到这个目的，一是通过向流量平台租赁流量实现流量攻击，另一种是通过种植“肉鸡”，构建僵尸网络，利用云控指令对被攻击者发起攻击。

拿商铺卖东西来举例子是解释DDoS攻击的标配，这里我也入乡随俗一下。

假设小明在当地沃X玛买到了一桶过期的泡面，导致春运途中饥肠辘辘。怀恨在心的小明决定节后要好好教训一下沃X玛，便开始散布谣言：情人节沃X玛做活动，当日到店购买巧克力和玫瑰买一送一还附送高档宾馆2折优惠券。于是，2月14号大量不明真相的小青年们都去了沃X玛，抢完了货架上的玫瑰和巧克力，但是在结账时却被告知没有此活动，导致收款通道出现大量排队后却没有购买任何商品的用户。同时由于排队等待时间过长，前来购买普通商品的用户也都放弃在沃X玛消费，而转到其他超市消费。最终，2月14日沃X玛营业额严重下滑，经理被免职。

这就是小明对沃X玛超市发动的一次成功的DDoS攻击。

聪明的你可能已经看出来了，DDoS的可怕之处正是**被攻击者无法正确的区分哪些是攻击者发来的请求（被谣言欺骗的小青年），哪些又是正常的请求（没听过谣言的其他顾客）**。

上面介绍的是DDoS的基本原理，攻击者真正使用的技术手段多种多样，但基本上都会利用TCP等协议栈缺陷或者系统本身的缺陷达到最大化利用攻击资源的效果。这里介绍一个比较典型的SYN Flood攻击方式。

说到SYN Flood，就必须要详细说一下昨天文章里说到的TCP协议的三次握手过程：

![](http://img.smyhvae.com/2016052275.jpg)

第一次握手，客户端向服务器发送一个SYN报文，意思是“Hi，我要跟你建立TCP连接”。

第二次握手，服务器向客户端发送一个SYN+ACK报文，ACK是对第一次握手中SYN报文的确认，意思是“朕同意建立链接”。

前两次握手过程，服务器和客户端相互确认了TCP连接的一些参数，如图中的Seq等。

第三次握手，客户端向服务器发送一个ACK报文，确认第二次握手中的SYN报文被成功接收，TCP连接成功建立，服务器和客户端开始数据的传输。

当利用SYN Flood攻击时，客户端不发送第三次握手的ACK报文，服务器的状态就会被卡在第二次握手，我们称之为半连接。服务器维护半连接状态需要一定的资源，并且在较短的时间后，还会向客户端重发SYN+ACK报文，持续等待30秒到2分钟后还没有收到客户端的ACK报文，服务器才会关闭这个半连接。DDoS攻击者就是利用这段等待时间，用“肉鸡”产生数量巨大的半连接，占尽服务器的CPU和内存资源。一旦出现这种情况，正常的TCP连接就无法建立了。

综上所述，DDoS攻击技术成熟，实现简单，真可谓“居家旅行，杀人灭口的必备良药”，至于如何年入百亿，就看各位看官的手段了！


## 2016-02-05-2059万淘宝账户被盗，竟然是因为它！

最近警察叔叔通报了一则消息“某犯罪团伙盗窃了淘宝9900万个账户信息，其中2059万账户为确实存在并且密码吻合”，天了噜的，这某犯罪简直比朝阳群众还厉害啊，一下搞掉了2059万淘宝账户，阿里的开发真是吃X的啊！

后来阿里发了个声明，表示他们也是躺枪的，并不是因为开发吃X了，而是遭受了某犯罪团伙的“**撞库**”攻击，他们家的开发还是很强的，帮助很多用户挡住了这次攻击。不止是淘宝，撞库攻击在12306和京东身上也发生过。

撞库是个什么鬼？它的原理很简单，就是利用了大部分用户的一个坏习惯，在不同的网站上喜欢用同一组账号和密码，犯罪分子用在A网站窃取的账号密码来尝试登录B网站，有很大的概率可以成功登录，因为账号密码可能都一样嘛。

举个栗子🌰，我用账号2密码B注册了淘宝账户，由于我很懒，在注册某个1024网站时，我还是用的这组2B账号密码。我们知道，淘宝的安全是做的很好，某犯罪团伙当然也知道，他们不会直接和淘宝硬碰硬，而是把稍微弱一些的1024网站拿下，然后拿1024会员的账号密码去登录淘宝，当然大部分账号是登录失败的，但当遇到我这组2B的账号密码时，就可以成功登录了，然后我在淘宝买了什么玩具，这个犯罪团伙就都知道了。

对于撞库的攻击，大部分网站都无能为力的，你总不会拒绝一个有正确账号密码的用户登录吧？当然，更专业的一些的网站，可以从其它维度来验证是否是一个正常的用户，比如说，如果不在该账号经常使用的城市登录，就发一个短信进行二次验证。

从一个用户的角度来看，为了保护自己的信息安全，最好还是在不同的网站使用不同的账号密码，这样即便某个网站沦陷了，也不会波及到在其它网站的账户安全。很多人会觉得不同网站不同的密码记起来太麻烦，这里有个小技巧，就是你给自己定一个规则，比如是“一句话＋网站昵称”，那么淘宝的密码就是duoshou@mayun，京东的密码就是duoshou@naicha，这既避免了撞库，也便于记忆。

好了，想想自己淘宝的密码是否是唯一的吧，如果不是，赶紧去改吧，不然你买的那些XX娃娃都要被送到别人手里去了。


## 2016-02-06-提需求的正确姿势是什么

在论坛、知乎上经常看到一些「年轻的」产品经理发的引战帖，大意是：「开发大哥，我代码写的少，你可别骗我，这么简单的需求，明明一下午可以搞定，你跟我说一个星期？如果让我来的话，巴拉巴拉巴拉...」。看到这种论调，一些没耐心的程序员就会一笑了之，甩下一句「You can you up,no can no bb」，或者「你这么屌，你咋不上天咧」之类的回复潇洒走人，但是作为一名爱管闲事的程序员，我怎么能放过这个绝佳的「站在制高点上俯瞰众生」的机会呢？

先来反驳一下这位「年轻的」产品经理。写代码是一个典型的「纸上得来终觉浅，绝知此事要躬行」的事情，往往一些看似很简单的需求，实际上会遇到很多坑。你看过「人在囧途」吧？一段很简单的回家路，谁知道会有那么多的坎坷。就是这种感觉。

举个例子，你要实现一个「视频播放的时候，用户可以设置屏幕亮度」的功能。实际上系统提供了「设置屏幕亮度」的程序接口，你只需要去调用就可以了，核心代码可能就一两行，够简单吧？但是，一运行你就会发现各种问题。如果用户在我的APP里提高了屏幕亮度，退出之后要不要给人家还原呢？如果用户只是暂时离开了我的APP，退出又回来，我是不是要给人恢复成原来设置的亮度呢？这些都是产品逻辑问题，你们沟通之后很快就解决了。但是后来测试发现，「设置屏幕亮度」的接口是一个很耗时的接口，可能会造成整个APP的卡顿，这时候你就得考虑用多线程来解决。引入多线程之后，线程之间的资源共享问题如何解决，谁先谁后的问题如何解决，等等...

「年轻的」产品经理不会想这么多，自己爽完提上裤子就跑了，留给程序员一堆烂摊子，程序员能开心的帮你干活吗？还有就是，程序员写代码可不光是完成功能那么简单，代码写的规范不规范，鲁棒不鲁棒，扩展性怎么样，都是需要事先下功夫去设计的。我一开始写代码的时候，就喜欢那种实现一个功能的快感，迫不及待的要秀给别人看，后来体会到并不是那么回事。写代码就像谈恋爱，一开始轰轰烈烈，海誓山盟，谈的久了，你会发现往往一些简单的小事，要完全负起责任，才是最难的。

说了这么多，就是想让你理解程序员写一行代码，究竟要「熬过多少患难，湿了多少眼眶」。这是动之以情。接下来我们谈谈如何正确的提需求，就是要晓之以理了。

- 提需求要有节奏感

不要误会，这个节奏感不是啪啪啪的节奏感，而是说你提的需求，要跟着项目的版本周期走。一般一个不是太拖沓的互联网产品，每个版本会经过功能开发、单元测试、集成测试、beta验证、上线几个阶段，我们分别来看一下。

功能开发阶段，简直是程序员的美好时光。下午懒散的阳光打在脸上，泡一杯浓香的卡布奇诺加一点点糖，戴上女朋友送的Beats大耳机循环一首轻音乐，手指在机械键盘上跳来跳去，噼里啪啦的，就像脑海中忽闪忽闪的灵感，根本停不下来，对对，就是这样的感觉。

这期间程序员要么做产品经理提的需求，要么闷头做一些技术需求。这是产品经理提需求的最佳时期，程序员刚刚结束了上一个版本紧张的发布期，急需要一些新鲜的需求来压压惊。技术需求是一些性能优化、代码重构之类的事情，这个虽然是程序员自己给自己提的需求，但是你一定要给他时间去做，不然程序员每天总觉得自己写的代码乱糟糟的，没有安全感。

单元测试是一个功能模块的需求做完之后，提给测试同学去找bug。集成测试时所有模块的需求都单元测试完成之后，整体来一轮测试。这时候程序员天天在改bug，你奇思妙想来一个新需求，他可能要象征性的反抗一下，但是大多数会乖乖去做。

到了beta和发布阶段，大家都绷紧了神经，天天盯着用户反馈和线上的各种指标。这时候你突然被一块石头砸中，有了一个绝妙的需求，请hold一下，一定要hold住，因为你提任何需求都是会拉仇恨的。

- 先自己尝试评估一下需求难度

这个就有一点技术含量了。有些需求天生是很难的，比如智能推荐、智能识别、搜索引擎这种，需要很强的技术能力。还有些需求，需要前后端联调，后端开接口，商量协议，这些时间算上去总时间要翻倍。除了这些，剩下的就是相对的了，取决于是否有现成的轮子。程序员常说，「不要重复发明轮子」，就是说如果有现成的代码，就直接用不要自己再花时间写了。现成轮子可以来自开源社区、自己项目的积累、还有系统平台提供的支持。如果某个需求有现成轮子可用，那它的难度应该至少要减半。

你想知道开源社区都是有哪些轮子，可以平时多看一些别人整理的技术博客，你可能并不需要知道里面技术上是如何实现的，你只需要记下，这个功能是有轮子可以用的，就够了。你想知道自己项目积累了哪些轮子，去问你们的开发吧，找他们抽支烟、吃个饭，很容易就套出来了。有些项目比较成熟，像推送、埋点上报、自动更新这些都有轮子可以用，但一些年轻的项目则不然，建立这一套东西也要花不少时间。你想知道系统平台提供了哪些轮子，就买一本介绍你们产品平台的技术书，比如《疯狂Android讲义》、《iOS Programming》，大体翻一下就行了，主要是了解一下这个平台到底可以做哪些事情。

没有轮子可以用的需求怎么评估呢？少侠，你眼光不错哦，每天进来看看，你就知道答案啦。

- 下点功夫做准备

这是个普遍的道理，你让别人给你办事，吩咐半天讲不清楚，别人肯定不耐烦。如果你的需求是抄的别人的，可以拿别人做好的效果演示一下，这是最直接了当的。你的需求是业界首创的，可以简单画个流程图，如果这时候你能用上一两个技术上的术语，程序员肯定觉得你碉堡了。需求讲清楚了也要顺便让人理解为什么。这时候不要留情，把程序员带到你的产品世界里，用你丰富的经验打败他，他就会乖乖的跟你走了。

还有一点很重要，产品经理要给开发协调一些其他资源，像设计、测试这些，如果能提前准备好，那么即使是beta甚至上线阶段加需求，程序员也会十分感动然后再拒绝你的。

最后忍不住吐个槽。有些产品经理动不动就拉老大来给程序员施压，我觉得这种是最low的，连文章开头那些「年轻的」产品经理，水平都比他们高到不知道哪里去了。就好比两个小朋友打架，你打不过人家，喊的不是「放学你等着，有种操场见」，而是「我要告老师，看他怎么收拾你」。哎我说，不要怂啊亲。

PS:以上建议只是我自己的胡思乱想，是一家之言。你千万别有「快来看啊，这家伙又在装逼教我们做人啦」这样的想法。如果你觉得我伤害了你，我希望你分享出去让更多人受到伤害。如果你觉得我说的好像是那么回事儿，我也希望你分享出去让更多人来听我叨逼叨（好吧我说实话，其实就是年前给自己定的关注量KPI没完成，怒求一波分享和推荐，T T）。


## 2016-02-07-听说除夕跟红包助手更配哦

自从去年微信红包火了以后，每逢佳节各个微信大群发红包之际，喜悦声或哀叹声此起彼伏，没抢到红包的只恨自己不能再快一点。

既然快速抢红包已经成为需求，那么红包助手横空出世也是意料之中的事情。平台所限，红包助手只在Android手机上出现，它的原理是怎样的呢？虽然不root手机也能用，但是它到底安全吗？我们一一来分析一下。

首先，我们先从Android的视图相关的一个概念说起：View树。我们一般平时看到的Android应用的界面都是一个大的View树构成的。一个大的视图界面首先有一个根View节点，这个根View节点下会有若干个子View节点，而每个子View节点下又有若干个子View节点，如果一个View有子节点，那么它同时也是一个ViewGroup，如果没有子节点，那么它就是一个叶子View。就这样不断的一层层嵌套，就构成了一个大的View树。

![](http://img.smyhvae.com/2016052276.jpg)


例如常见的聊天列表：

![](http://img.smyhvae.com/2016052277.jpg)

这里比较明显的是消息列表是个大的ViewGoup，里面嵌套了很多行的消息条目View，同时每一个消息条目行同时也是一个ViewGroup，里面又嵌套了很多小的View元素，例如顶头的头像View，名称文本View，描述View等等。

为什么我的手机界面是这样的，有兴趣的产品童鞋可以到手机的设置-开发者选项-显示布局边界，打开这个选项就可以了，每一个完整的View/ViewGoup都被被蓝色的边角和红色的分界线标记出来。

不是讲红包助手的原理吗，怎么讲起View树了？别急，我们的前戏还没完呢，我们再来看一个Google应该都没想到的事情。Google为有障碍的又想使用手机的人提供了辅助功能，例如帮助视觉有障碍的人读出他点击的控件的名字，帮助肢体有障碍的人点击指定的按钮等等。原理就是利用上面的View树，用户的点击事件最终会落到一个具体的View上，这个View包含了一系列描述信息，点击View时，系统就会将View上的描述信息读出来，这样不用看到界面也能操作手机了，同时，还能通过需要反向检索当前View树上各个View节点的描述信息，只需要知道某个具体View上的描述，系统就能代替点击对应的View，这样就可以不用触摸，通过声音就能操作了。

这一辅助功能被国人开发者发扬广大了，例如很多APP有自动装的功能，只要开启了自动装，不需要root，它就能替你点击安装过程中界面上的指定按钮，我们在批量更新的时候确实很方便。（可以想象Google工程师脑门上的三滴汗）
前戏完了，我们开始讲讲红包助手的技术实现吧。（感觉好像我不需要再说什么了，大家也都能猜到了）

虽然红包助手一般都不要求root权限，不过都会引导用户开启辅助功能。一旦开启辅助功能，红包助手就能够监听通知栏的的信息内容了，比如监听到来自微信的消息里面有红包（当然会对描述信息做更精确的匹配），就会自动替用户点击通知栏的消息，这样用户就进入到了对应微信群的聊天界面了，整个聊天界面也是一个大的View树，红包助手开始检索树上红包的描述信息，然后替用户滚动屏幕，直到红包消息出现在屏幕中，不必多说，后面还能帮你点红包，拆红包了。不过貌似最近的红包助手都只是做到了滚动到红包消息这一步，难道是怕替你点了，要是抢少了，会被骂，干脆你自己点，抢多抢少就不关我的事了？

其实整个原理还是比较简单的，红包助手好，不过终究是个外挂程序，至于其安全性，用户心里自己得有杆秤，毕竟可以读取通知栏信息这一条就足以让整个安全支付体系土崩瓦解（可以读用户支付的最后一道屏障-验证码）。抢红包其实也是一种乐趣，有了这种外挂，乐趣会少了许多，毕竟，开着外挂抢一晚上红包又能抢多少呢？

不过如果你加的是土豪群，宗旨是:工作做得好，不如红包抢得好，那就当我没说好了…


## 2016-02-08-Ajax技术的妙用

今天是大年初一，恭祝各位朋友猴年快乐，多赚钱，少生气~

过年的我懒惰极了，心中有个小人儿总在说，过年要不就休息吧，另外一个小人儿跳起来说，不要只写了两个月就开始阳痿哦。

曾经说过要至少坚持写一年的我，还是要为吹过的牛逼负一点点责任，自己选择的路，跪着也要走下去，说完了感觉好悲壮，哈哈。（刚吃完饺子，我开始认真的写了）

在我们再熟悉不过的搜索引擎的搜索框中，你输入一个关键词，会有很多联想词出现，有很大的命中概率，好像我们并没有再发起一次网络请求，网页也没有重新刷新，这些词是如何从后台返回到当前网页，并且再显示到输入框下面的呢？

![](http://img.smyhvae.com/2016052278.jpg)

当你在地图类应用中随意的放大缩小，整个网页也没有重新刷新，这个时候新出来的许多街道细节，是怎么从后台传回来的呢？

![](http://img.smyhvae.com/2016052279.jpg)

说明下，“网页没有重新刷新”的意思是没有像你打开百度之后，一个空网页渲染到屏幕上，点了网页中的一个链接，这个链接又打开了一个新的网页。有没有整个网页重新刷新对用户来说有着截然不同，各位客官请脑补下，上面两种情况如果刷新会是什么2B样子，我刚输入“除”字，网页重新刷新了一遍，输入“夕”字之后，又白了一下然后整个页面显示，对于“挑剔的你，应该是不可接受的吧。

注意两个前提，第一个是网页没有刷新，第二个是本地网页从后台获取了新数据(假设亲没有认为所有的数据都是写死在本地的哦)。

BB了半天，这种技术叫做Ajax(汉语翻译为“阿贾克斯”或“额寨克思”，注意哦，前者不是荷兰的那只足球队)，是Asynchronous Javascript And XML的首字母缩写，翻译过来为“异步JS和XML”，本来JavaScript和XML都是成熟的语言和技术标准，已经存在了很多年，直到谷歌在google map项目上应用，才展示了这项技术组合新的威力，看看上一段那两个条件，这项技术主要解决的就是不用刷新网页，来和后台交互获取数据，并应用于当前网页。

我们来看看网络抓包的结果，在搜索框中输入了“除夕”两个字之后，在一次网络请求中返回了这个结果，这个结果就对应于下拉列表中的联想词（该字符串经过了在线转成可视化JSON的处理，否则截图太小不好展示）。

![](http://img.smyhvae.com/2016052280.jpg)


Ajax具备的这两项能力怎么实现的呢？

**1. 发起网络请求**，这个发起网络请求的能力由浏览器的内置能力提供，所有的浏览器都提供了XmlHttpRequest这个对象，这个对象可以由网页调用，用来连接一个特定的地址。 

**2. 不用刷新，动态操作网页**，介绍一个你在这行永远绕不过去的一个词叫DOM(Document Object Model)，中文翻译叫做“文档对象模型”，也是相当不好理解，这时候需要你有一些拟人化的思维了哦，亲，我们把一个网页想象成一个人，一个人由骨骼和肌肉组成，骨骼相当于这个叫DOM的东西，定义了一个网页大概的结构，下图对应了一个最简单的网页的骨骼和框架。

![](http://img.smyhvae.com/2016052281.jpg)

在这个图中，有html、body、h1、p等标签构成了这个网页的DOM模型，而JavaScript天生为了网页而生，就是为了操作DOM而存在的，简单的理解，也就是JavaScript可以动态的操作整个网页。

有了这些基础知识，我们来导演下整个“百度联想词”的整个过程，输入“除夕”，这个时候利用了XmlHttpRequest对象发起了到百度后台的一次请求，随后这次网络请求返回了若干个联想词的json串，这个时候百度网页中的JavaScript程序开始进行处理，进行json串的解析，并将这些解析后的字符串插入到网页的DOM结构当中，页面经过重新渲染，在当前页面上展示了一个下拉列表框，并填入了刚才从后台得到的联想词。

读了这么长的文章，还是应该有点收获的：

1. ajax是一项用于异步拉取数据并展示在当前页面的技术，这对于需要延迟加载数据还有触发式加载数据好处大大的，当前的绝大多数网页为了速度快，都会用到这项技术，比如一个内容型网页，你访问的时候，这个网站的后台会把这个页面的基本框架吐回给浏览器，也就是一个网页的基本样子已经有了，比如一个视频网站所有的电影名字，演员都有了，但是那张电影的海报是框架完成之后，再发起ajax请求去拉取的，这样能最大的缓解用户的焦虑感。

2. DOM的概念和理解对于一个从业者至关重要，建议你自学写一两个网页，就能理解它的意思了。


## 2016-02-09-红包抢的好，钱包也要捂紧了——HTTPS技术

逢年过节的，安全问题不容忽视，今天给大家带来的内容是HTTP的“安全版”——HTTPS。

![](http://img.smyhvae.com/2016052282.jpg)

HTTPS中文学名“安全超文本传输协议”，比HTTP多了个“安全”。那么HTTPS是如何实现“安全”的呢？

在传统的HTTP协议中，应用层的HTTP协议将应用程序提供的数据封装后，明文交给位于运输层的TCP协议发送到网络上。由于是明文传输，发送的信息可以在传输过程中被任意篡改，甚至被完全替换。

从上文可以看出，HTTP协议的主要缺点就是明文传输。

为了解决这个问题，**HTTPS协议在HTTP和TCP之间添加了一层SSL协议**。SSL是用来保障网络上数据传输安全的一套协议，它在传输层对HTTP进行封装加密，然后将数据交由TCP协议发送到网络上。

**使用HTTPS的服务器，需要在受信任公司申请一套数字证书**，也就是密码学中的公钥和私钥，用于进行非对称加密。公钥加密的数据需要用私钥解密，私钥加密的数据需要用公钥解密。

![](http://img.smyhvae.com/2016052283.jpg)

当准备好数字证书后，就可以使用HTTPS协议进行数据传输了，我们来看看HTTPS协议建立连接的流程：

![](http://img.smyhvae.com/2016052284.jpg)

1、客户端发起https请求；

2、服务器将公钥发送给客户端，客户端可以根据公钥验证服务器的身份。

3、客户端生成一个加密密钥，公钥加密后，将密钥传输给服务器，服务器用私钥解密报文获得客户端密钥；

4、服务器和客户端的数据传输都通过客户端密钥进行加解密。

讲完技术后，又到了举栗子环节了：

抗日战争时期，我党两个指挥部之间需要进行加密电报通信安排作战计划，但是两方当前用的都是非加密的电码本（明文传输），通信内容很容易被敌方破解。正巧，指挥部A（服务器）有一个便携保险箱（公钥）和钥匙（私钥），于是便派通信员小张单独将保险箱（公钥）秘密送达了指挥部B（客户端），保险箱的钥匙（私钥）还是被保存在指挥部A。指挥部B（客户端）收到箱子后，一看上面印着的五角星，便知其来由，于是将加密后的电码本（客户端加密密钥）放在了箱子里，将箱子锁好，由小张带回了指挥部A。指挥部A收回箱子后，用钥匙将保险箱打开，这样，两个指挥部便都有了加密后的电码本（客户端加密密钥），后续的作战计划电报报文都用新的密码本编码，保证了信息的安全传递！

综上所述，**HTTPS协议可以保证信息在网络中传输的可靠性，主要用于对传输安全敏感的场景**，如网上银行、支付宝、财付通等，**另外HTTPS也可以有效的防止页面被网络中的三方（比如运营商）篡改**，如果你的网站经常被运营商改的乱七八糟，可以让开发尝试下HTTPS了。


## 2016-02-10-如何访问家庭服务器？

今年过年回家，带回来一个DIY的小服务器，放在家里做一个资源共享服务，让家人可以存放并共享一些手机拍摄的照片和视频。不过平时我也不在家，遇到什么问题或者故障，需要远程登录到家里的服务器里处理，那么问题就来了，怎么绕过层层网络，从外地访问到家里的服务器呢？

首先要解决的就是动态IP地址的问题。一般公共服务器的IP地址都是一个固定的IP，这是要花钱买的，可是我家里使用的是普通的电信宽带，运营商可没有那么好心，会免费送我一个固定IP，而是分配了一个动态的IP地址给我，一般来说隔一两天就会换成另一个IP地址。比如说我今天记住了家里的IP是121.12.21.12，可以通过这个IP进行远程访问，但是隔了两三天，就变成了121.12.21.xx，我在外地并不知道家里的IP变成了什么了，这样就完全抓瞎了。

当然，作为一个程序猿，我可以在服务器上写个定时任务，一旦检测到家里IP发生了改变，就发封邮件给我，告诉我最新的IP地址是多少。这样每次我要远程访问家里服务器，先去查一下邮箱，找到最新的一封邮件里面的IP地址，再做操作，不过这样是不是挺麻烦的？

这种麻烦事可以用**DDNS（Dynamic DNS）**服务来解决。我们平时上网，都是简单地输入一个域名，然后通过DNS服务，将易懂的域名翻译成难以记住的IP地址，然后浏览器就直接访问对应的IP地址了。同样的，我也可以用一个域名ddns.example.com来指向到家里的IP地址，每次家里的IP地址发生了改变，就通过DDNS服务来更改这个域名指向的IP，这样我可以只用记住那个域名，不用去管理动态IP的变化了。网上有很多免费的DDNS服务，有需要的可以搜索一下～

其次还需要解决另一个问题，就是内网穿透的问题。由于家里有多台网络设备，我们都会用上一台路由器，将家庭网络隔离成一个单独的局域网。我们知道局域网内的主机，在公网上是不能直接访问的，我要想在外地访问局域网里面的这台服务器，就需要在局域网上打个洞，做一次内网穿透。最简单的办法，就是在路由器上做**端口映射**，一般的路由器都有这个功能。比如我将路由器的外网（IP为121.12.21.12）2222端口映射到内网服务器（IP为192.168.1.3）的22端口，那么我访问121.12.21.12:2222其实就是访问到了192.168.1.3:22，这样就解决了公网访问局域网主机的问题。

最后我只需要记住在远程访问工具(SSH)里面访问ddns.example.com:2222，就可以连接到家里的192.168.1.3这台服务器的22端口了，随它运营商去更换IP也不怕了～

## 2016-02-11-大年初四，让我们一起来动手撸代码吧

不管你承认不承认，过了初三这年算是过完了。为了开个好头，大年初四，就让我们一起来动手撸代码吧。别问我为什么这么变态，归结起来还是那句悲伤的台词，「自己选择的路，跪着也要走下去」(此处应有「一剪梅」的音乐缓缓响起)。

今天我们结合一个简单的「hello，2016」程序来了解一下代码是如何被计算机解释和执行的，整个过程分为「写代码，编译代码，运行代码」三步。这些东西你工作中可能并不会用到，权当满足一下好奇心吧。之前讲过，写代码是一件「纸上得来的终觉浅，绝知此事要躬行」的事情，如果你手上恰好有一台mac，可以动手敲一下，效果翻倍哦。

代码从本质上来说就是一些句子。这些句子程序员能看懂，经过编译器的解释，计算机也能看得懂。下面是一段最简单的C语言代码，如果一切顺利的话，你会看到在屏幕上显示「hello，2016」这样的文字。现在你可以打开一个文本编辑器，照着敲一下，然后保存成hello.c，放在桌面上。

![](http://img.smyhvae.com/2016052285.png)

第一行#include <stdio.h>，意思是我们要引用stdio.h这个文件的一些功能。还记得之前我们讲过的接口的概念吗，stdio.h里面就是一系列的接口，其中就有printf(提供打印一句话的能力)这个接口。你想调用printf这个接口，就要先把stdio.h引入进来。

第二行main()是整个代码的入口。所谓做事要有始有终，一个程序可以没有终点(死循环了)，但是必须要有个起点。计算机在执行的时候，看到main()，就知道要从这里开始执行代码了。

最后一行实现了整个代码的主要功能，各位都懂英语，翻译过来就是「请在屏幕上显示hello，2016这一行文字」。

这样我们就完成了写代码的工作，然后我们进入编译阶段。编译是指把源代码翻译成机器可以理解的可执行程序的过程。我们上面写的代码太高级了，是人类可以理解的，但是计算机理解0101这样的二进制，所以就需要有个编译器来帮我们翻译一下。现在你可以打开「终端」，敲入下面的命令，编译就完成了。

![](http://img.smyhvae.com/2016052286.jpg)

gcc就是一个著名的编译器，专门用来编译C语言的代码。这句话的意思是，「请使用gcc把hello.c编译成一个叫hello的可执行文件」。这里你可能会问，我们平时看到的可执行文件不都是以exe结尾的吗？其实文件本身是没有后缀名的，它只是磁盘上的一段数据。后缀名只是大家觉得应该有个区分，于是windows上的可执行文件就加上了.exe，图片就加上了.jpg，视频就加上了.avi。


这个命令执行完之后，会在当前目录下生成一个叫hello的文件，文件里面都是一些0101之类的二进制，不信你用文本编辑器打开，保证你看不懂。

这个编译命令虽然只有短短几个单词，但是编译器却悄悄的干了很多事。

预处理。编译器看到第一行的#include <stdio.h>，就得把stdio.h这个文件整个插入到你的代码里。

编译和汇编。这个阶段会把整个源代码翻译成计算机可以理解的可执行文件，中间会用到很多编译原理的知识。编译原理是程序员的必修课，虽然我现在已经忘得差不多了。

链接。你的代码里用到了printf，这个功能是另一个程序提供的，你必须把具有printf功能的可执行文件找到，和你的可执行文件打包在一起，链接就是做这个事情的。

编译完成之后，我们生成了hello这个可执行文件，然后就是运行代码了。运行代码的命令是这样的：

![](http://img.smyhvae.com/2016052287.png)

当你看到hello，2016的时候，恭喜你，你已经成功了。这里要解释一下，当你在终端里敲入./hello的时候，发生了什么。

首先计算机会帮你创建一个进程。还记得我们之前讲过进程的概念吗，它是一个隔离的时空，为一个程序提供了完整的运行环境。我们的hello2016的程序就将在一个独立进程里运行。

创建进程之后，我们编译好的代码会被读到内存里。在运行的时候，我们进程看到的内存会被分为几个区域。

1. 代码段和数据段。我们写的代码就存在这里。经过编译之后，它已经变成了一条条的指令，CPU会一条一条的读取这些指令来运行。数据段存了我们程序里的一些静态数据。比如年会抽奖的程序，程序员不老实，把他自己的名字写在代码里，那么他的名字就存在数据段。

2. 堆和栈。这个简单来讲就是我们程序运行的时候申请的内存。你看到各种管家统计的应用占用内存情况，就是指的这个内存区域的大小。

3. 共享库。这个咱们后面再讲。

总结一下，我们写的代码经过编译器的编译，成为计算机可以理解的可执行文件。计算机在运行时，为我们的程序分配一个进程，创建相应的内存结构，一行一行的读取代码段里的指令并执行。这就是代码运行的整个过程。


## 2016-02-12-移动,您还记得那年动感地带的无限流量卡吗？

春节已经过半，最近走亲访友感觉比上班都还累啊，好不得空坐下来继续兑现自己坚持一年的诺言。

回老家忘换手机流量套餐了（一直图省钱办的省内套餐），说多了都是泪啊，又想起多年以前自己错过的一次发横财的机会啊。那会儿还在读大学，刚刚接触手机上网，可新鲜了，依稀记得那时移动动感地带有两种比较好的GPRS套餐，一个是15元30M/月（好像是），还有个30元无限wap流量套餐，当时办了无限流量的套餐，爽了一两个月，可是按照当时的网络环境，那酸爽的速度，每个月估计只能玩个20M左右的流量，当时还是学生党，觉得好亏啊，就换成15元包流量的了，很快无限wap套餐的卡成了绝唱，而没有换套餐的卡后来都被称作“神卡”，在网上开始天价售卖，特别是移动后来不区分wap和net了，这种卡的价格更是被抄到新高。

唉，不说这伤心事了，wap和net到底是啥玩意儿？

比较早接触手机上网的童鞋肯定对wap和net是有印象的，那时移动的用户占统治地位，手机上网时需要先设置一下接入点，移动可选的是cmwap和cmnet，联通和电信也是类似。那是我也不是很清楚这两者的区别，大致的感觉就是wap接入点虽然慢点，但是套餐相对便宜点，要是不小心连到net可能还会被莫名扣费。所以当时换手机时都很小心的把接入点设成wap的。

wap是啥呢？拿中国移动举例，wap其实就是中国移动自己的内部网，那些访问的wap网站资源都在中国移动自己内部的服务器上，一般情况下，wap接入点是访问不了非移动服务器的资源的。而net接入点则没有这个限制，但是如果你用net接入点访问了非移动的服务器，那么移动就需要向对应的ISP(互联网服务提供商 )支付相应的费用了。移动有这么好？做梦呢，都从你的话费里扣掉了！所以cmwap又叫移动梦网（开玩笑）。

在国外，是没有wap和net的区分的，这是一个中国本土化的产物。为啥要区分wap和net呢？为了赚更多的钱呗。其实wap也是可以通过代理服务器访问net资源的，例如中国移动的10.0.0.172端口80，搞个这玩意咋赚钱呢，比如移动从net下载一个视频到自己的服务器上，那么它只需要支付这一个视频流量的费用，这时如果有10个wap用户下载了这个视频，它就向这10个用户伸手要钱。这种操作手段和现在很多小的二级宽带运营商类似，比如我从电信买了100M的带宽（实打实独占，价格比较贵），然后开始忽悠不明真相的的群众，说用更便宜的价格让他们用上100M的带宽，然后我忽悠了50个人用我的宽带，让他们共享这100M的带宽，然后他们访问的网站，视频啥的缓存在我的服务器上，一些比较热门的资源在我的服务器上就都有了，只要不是访问特别冷门的资源或者玩游戏，速度都还是比较快的，毕竟都是在一个局域网内部。这样，虽然我手里只有一个100M的宽带资源，但是我同时向50个人收费，想赚多少，自己算算就知道了呗，时代在变，坑钱的核心思路不变。

当时对手机应用的开发者来说，支持wap也是一件比较头疼的事情，因为运营商的代理服务器只实现了HTTP代理的功能，像POP3和SMTP协议什么的就不支持了，这样一些邮件应用使用wap接入就用不了了，如果开发者一定要支持，那么就得自己在移动的网络架代理服务器，当然这个服务器和流量都是额外的开销了，所以当时一些比较专业的邮件应用都是收费的。

当时那些保留了无限wap套餐卡的用户现在过得怎么样呢？移动后来不区分wap和net了，而且号称不换号升3G，4G，那这些用户是不是爽翻天了？据说移动履行合同的决心还是很坚定的，如果这些卡的用户不想换套餐，就让他们按照合同在3G，4G时代继续享用2G时代的网速和WAP服务。（此处应有掌声）


## 2016-02-13-把URL五马分尸

你一定每天工作显得很忙，你一定各种资讯、八卦、娱乐信息一条不漏，下班后感觉一天头昏脑胀，好像并没有真正干什么事情，有木有？

不知道你啥样，我基本每天早九晚九，浑浑噩噩，但是好像八卦一个都没落下。

你每天打开几十个页面，是否观察过它们的Url地址？今天带你“庖丁”解牛（庖丁两个字带了引号哦，你应该可以看出我是个很谦虚的人），让Url跳段脱衣舞，把它拆开细细和每个部分谈谈。

一个标准的Url地址由这几部分组成，protocol，hostname，port，path，parameters，query组成，这样显得太干巴了，还是举个栗子来说明。

照葫芦画瓢，我们按照刚才说的几个部分来拆解一下，杜撰一个链接如下：
http://news.qq.com/a/20160209/012154.htm?a=1&b=2&c=3

### Protocol

指 http:// 这部分，是协议的意思，协议就是一套规则，它定义了数据如何封装、打包、拆包和解释的规则，比如我答应过你，只爱你一个人，就是一套协议，我们两个人的交往都是按照这套规则来进行的，我同时找两个妹子，你就可以说我没有按照我们之间的协议来恋爱了。也即只有通过http这套规则访问这个页面资源。你是否还见过https、ftp、thunder这些协议头，Url地址标识一个资源，你可以通过不同的规则（协议）访问到它，当然前提是存放这些资源的服务器支持这个协议。

一个剧院，座位位置被看做资源，看客只有获取到这个资源，才能看到这个剧目。现在过年，人比较多，为了防止发生踩踏事件，不但开放正门，还多开放两个侧门。我们脑补一下，观众的票面上标识了什么信息，一定有座位的信息（几排几号），也即相当于Url的后半部分，但是这个Url的协议头，有的票面标了从正门进，有的标识了从侧门进，这就相当于协议，一种是走正门的规则进入，另一种是走侧门的规则进入，你拿着走正门的票从侧门进入，应该是被拒绝的（正常情况下，大家都是拒绝后入的呢），否则你无法获取到最终的资源（座位），所以采用何种协议，至关重要。前面所讨论的前提都是要侧门开放，也即服务器支持这种协议，不开放侧门，你的地址就是失效的哦，访问不到这个资源。

这部分就介绍完了，总之，协议头标识了用什么规则访问具体的资源，以后你看到不同的协议头，就想想这个例子。当然你也可以设计一个协议，比如叫abc://也是可以的，这种就是自定义协议。

### Hostname

Hostname称为主机名，在例子中的Url中，news.qq.com就是Hostname，主机可以理解为一台机器的名字叫news.qq.com，这台主机在qq.com这个域名下，qzone.qq.com也在qq.com这个域名下，还有很多比如v.qq.com等等。

其实我所理解的，主机名跟域名是差不多的意思，反正我是一直没区分开来理解，好像理解成一个意思，好像也没出什么错。

顺便介绍下qq.com叫做一级域名，尤其国内很多人认为www.qq.com是一级域名，其实大错特错，它只不过是一个二级域名。www等同于刚才说的news。

www.qq.com/news.qq.com/qzone.qq.com/v.qq.com分别都是二级域名。

### Path

/a/20160209/012154.htm，在host后面的一长串全部叫做path，翻译过来就是路径的意思。就是最终文件所在的路径和文件名。例如：在我的电脑中，有一个路径存储着一些我喜欢的电影（F:\CCAV\波多野结衣\1.avi），只不过此地址是在我的本地电脑上，而上面的那个路径是存储在腾讯的服务器，也即news.qq.com这个域名下的若干台机器上中的。

### Parameters

?a=1&b=2&c=3，这一部分称为参数，也叫查询。它的目的是在Url中带上去一些本地的信息传给服务器，a、b、c三个字符是我为了理解简单杜撰的（在baidu的Url中的参数是这样的：?ie=utf-8&f=8&rsv_bp=1&tn=baidu），这些Key-Value的键值对标识了一些特定的意义，但最终是要服务器进行判断处理的。其中参数部分加上一些你随便填写的值并不会出错，比如加上&d=4，只不过服务器不解析这部分罢了。

### Port

Port称为端口号，一般http的端口号为80，https为443，可以理解为计算机可以有很多个提供服务的点，比如可以用默认的80端口来提供服务，同时也可以用81来服务。把一个主机比喻成一间房子的话，那么这间房子可以有65536个门，门就是端口号，这么多端口都可以达到进出的目的。我们上面的Url没有写任何的端口号，即默认为80。http://news.qq.com:8080/a/20160209/012154.htm?a=1&b=2&c=3#p=1，这个Url指定了从8080这个端口号，也即从这个门访问资源，那这个网页服务器必须在这个端口首先部署服务（也就是先把门打开，才能提供服务），才能供用户访问。

不管再长的Url都是由这几个关键部分组成的，只要你会分割出上面介绍的几个主要部件，就能看出各部分的意义，这是互联网的基本功，希望亲们能够理解。


## 2016-02-14-IP地址枯竭的后悔药：网络地址转换（NAT）

这两天被美国发现的「引力波」搞的懵逼了，不知道跟星爷《美人鱼》里张雨绮相比，哪个波更厉害，总之看完《美人鱼》后的观后感主要可以总结成六个字：王导瞎的不轻。

这两个波离咱们都太遥远，今天还是继续咱们的约定，讲一讲NAT技术。

我们先看看下面这张图：

![](http://img.smyhvae.com/2016052288.jpg)

通过www.ip138.com上查到的「本机IP」与从系统属性中查到的IP竟然不一致。

到底哪个结果是对的呢？这里先不公布答案，我们带着这个问题开始我们今天的内容。

每一台连接到网络中的网卡，都需要有一个IP，有了IP网卡才可以在网络中收发信息。然而在丰富的IP地址库中，有三类地址被定义为「私有地址」：

![](http://img.smyhvae.com/2016052289.jpg)

所谓「私有地址」，就是说这些地址只允许被用在私有网络中，不能作为Internet上的接入地址使用。如果你的设备是接入的家庭网络或者公司的局域网，那么你的IP肯定会落在上图的三个IP段之内。

私有网络中的设备如果需要访问Internet上的内容，就需要用到NAT（网络地址转换）技术。NAT技术有三种实现方式：

**1、静态转换（Static Nat）**

内网地址与外网地址是一一对应的关系，如果内网中有10台主机需要访问外部网络，就需要有10个外网IP来做映射，而且这10个内网ip和外网ip间的对应关系是固定的。如果需要让内部网络的一台主机作为外网的服务器，就需要用到静态转换。

**2、动态转换（Dynamic Nat）**

与静态转换类似，但是内网IP与外网IP的对应关系是不固定的，一般ISP会使用这种方式给接入用户提供访问外网的能力。

**3、端口多路复用**

这种实现可以让一个外网IP地址被多个内网IP同时共享，它与前两种实现的主要区别是将端口（详见《把URL五马分尸》）作为一个映射的纬度。家用的路由器，一般都是通过「端口多路复用”来实现的NAT。

现在，文章开头那两个IP地址的问题大家应该已经有了答案：www.ip138.com上查到的IP是NAT转换后的外网IP，而系统属性中查到的IP是内网IP。

我们来梳理下这个过程：

1、浏览器访问www.ip138.com，向服务器124.167.236.102的80端口发送GET请求包，该请求包的源地址为192.168.1.106（内网IP），源端口为3333；

2、请求包到达路由器后，NAT服务发现源地址为内网地址，于是将请求包中的源地址修改为119.182.101.189（路由器外网地址），源端口修改为4444，并记录下这个映射关系（NAT TABLE）；

3、www.ip138.com服务器收到请求包后，向目标地址119.182.101.189（路由器外网地址）和端口号4444发送响应数据包；

4、路由器收到响应数据包，NAT服务通过查询NAT TABLE，将目标地址改为192.168.1.106（内网地址），端口号改为3333，然后发送到内网网络，浏览器就收到了响应数据。

NAT技术将内网主机屏蔽在一个或几个外网IP地址后，降低了内网主机直接暴露到外网上的安全风险，另外端口多路复用技术大大的降低了IP地址的需求量，减缓了IP地址的枯竭。

## 2016-02-15-乱码导致的悲剧告白

昨天是情人节，程序猿小强终于鼓起勇气给女神发了一封告白邮件，然而最终还是没有把女神约出来。是因为小强不够高？不够帅？不够富吗？No！是因为女神看到的告白邮件是下面这样的火星文，心中一万头草泥马奔腾过后，点了delete键...

![](http://img.smyhvae.com/2016052290.jpg)

要想避免遇到这种悲剧，还是来了解一下字符编码吧。

我们都知道，任何信息在计算机中都是以二进制01的形式存在，通过不同的01组合，可以表达出不同的信息，这就是编码了。我们通常所说的字节(byte)，就是一个最基本的单元，它由8个0或者1来表示，可以组合出256种状态，如果每一种状态代表一个符号，那么一个字节可以编码出256个不同的符号，从00000000到11111111。

计算机最早是美国人在折腾，于是他们捣腾出一套ASCII码表，也就是将一个字节中的0～127种状态分别用来表达数字0～9，大小写英文字母，还有一些标点符号。比如说大写字母A，就是用65来表示，二进制是01000001。这个ASCII表在英文编码中没有什么问题，但是当它流传到欧洲其它国家时就遇到问题了，例如一个法文字母é怎么表示呢？于是他们又捣腾出一个扩展ASCII码表，将剩下的128～255拿来表示其它国家语言的字符。

欧洲国家挺好对付的，他们语言都是各种字母拼起来的嘛，无非就是扩展一下ASCII码表，但是来到中国，ASCII码表就彻底懵逼了，特么你们连茴香豆的茴字都有四种写法。于是就有了GB2312编码，它是用两个字节来表示一个汉字，总共可以表示256*256=65536个汉字，但是GB2312中只收录了6763个简体汉字。就是因为GB2312只收录了简体汉字，所以当它去了香港台湾，同样也懵逼，搞不定繁体汉字，后来将GB2312扩展成了GBK编码，这样里面包括了简体繁体，以及一些少数民族的文字。

中文的问题解决了，还有韩文、日文、阿拉伯文以及世界上那么多种文字，能不能有个终极解决方案啊！答案就是Unicode，Unicode是一个字符集，目前它收录了120737个字符，包括了各个国家的文字、符号以及一些表情，比如，U+0041表示英语的大写字母A，U+4E0A表示汉字"上"。

那么UTF-8、UTF-16和UTF-32又是什么鬼？其实它们都是Unicode字符集的不同编码方式。UTF-8是一种变长的编码，可以用1-4个字节来表示一个字符，如果一个字符在Unicode中越靠后，那么它需要的字节就越多。UTF-16是以两个字节或者四个字节来表示一个字符，而UTF-32就是始终都以4个字节来表达一个字符。与UTF-8相比，UTF-16和UTF-32就不是那么环保了，所以目前互联网上最流行的字符编码就是UTF-8了。

我们再回到小强的悲剧现场，造成这场悲剧的原因就来源于乱码，小强写的情书是以UTF-8编码的，结果女神的邮箱却错误地以GBK编码来显示，而同一个数字在这两种编码中对应着不同的文字，所以女神看到的全都是火星文了。

当然，现在的邮箱系统基本上都有自动检测编码，小强的悲剧很难真正的发生，如果你真的害怕万一，那么想表白还是打电话吧:)


## 2016-02-16-你喜欢菊花吗

你肯定见过不少菊花。进度条也是菊花的一个变种：

![](http://img.smyhvae.com/2016052291.jpg)

透过现象看本质，今天我们来探讨一下这些加载界面的前世今生。

首先不得不说，菊花是技术妥协的产物。菊花所代表的「异步加载」技术，实际上是因为大家发现很多情况下「同步加载」执行速度太慢，可能会卡住整个界面，才被用来曲线救国的。为什么有些同步加载执行慢呢？这个就要从当代计算机的架构说起了。

现代计算机执行任务主要依靠CPU的运算和存储设备对数据的读写。有些任务是吃CPU的，比如图片解码、matlab里一些数学方程的运算，以及一些比较复杂的网页的排版(例如在手机上打开www.qq.com，页面元素太多，排版非常耗时)。这种任务叫做CPU密集型任务，一般不适合用同步加载的方式执行。

也有些任务是高度依赖存储设备的，比如读取数据库里的一些信息，加载磁盘上的一张图片，以及从网上下载一部电影。不同的存储设备的运行速度有天壤之别，一般来说离CPU越近的速度越快，大体上是寄存器>高速缓存>内存>硬盘（>网络。其实你可以把整个互联网也看成你电脑的一个大硬盘，只不过它是用网线来传输数据）。这个我们之前的文章讲过，忘记的可以翻一下《大伙常见的存储设备简介》一文。内存是一个分水岭，排在内存前面的存储设备速度很快，几乎是一瞬间的事情，所以可以做到「立刻加载」。硬盘因为是机械结构（里面有个小马达），因此速度非常慢（大概是内存的10万分之一）。凡是跟内存之后的存储设备打交道的任务，都不适合「同步加载」，这样的任务叫做IO密集型任务。

所以菊花的使用方法是，当用户跳转到一个新的场景，或者加载一个新的网页时，必须要执行一些CPU或IO密集型的耗时任务才能让用户看到内容，这时前台用让用户欣赏转动的菊花，后台开启新线程执行这些任务。新闻客户端加载一个新闻的时候，就是一个典型的例子。

![](http://img.smyhvae.com/2016052292.png)

经常有产品经理说带菊花的交互方式不好，用户永远是希望马上看到内容的。当然，没有什么技术是不可能实现的，有些场景下，不使用菊花也是可以的，秘密就在那个进场的动画上。

一般进入一个新的场景，都会有一个入场动画（比如微信打开一个新的聊天窗口是从屏幕右边推过来），这个动画时间一般是200-300毫秒左右，在我们看起来是一瞬间的事情，但是对CPU来说就非常漫长了。这时候我们前台做入场动画代替转菊花，后台开新线程做耗时任务，等动画做完，入场完毕，内容也加载的差不多了（如果还没完成就再弄个菊花贴上去）。

这里你可能会问，一边做入场动画，一边做耗时任务，不会卡动画吗？一般来说不会。动画实际上是一遍一遍的渲染界面（间隔16毫秒左右，所以我们看起来是连续的）。之前我们讲过「渲染」的概念，界面的渲染要经过「测量、排版、绘制」几个阶段。其中前两个阶段是依赖CPU完成的，绘制一小部分靠CPU，大部分是靠GPU。还有一点，不管是Android还是iOS，动画一旦启动起来，就不再测量和排版了，只是每一帧绘制一下，刷新一遍屏幕就可以了，这时候GPU在满负荷运作。结论就是做动画是一个GPU密集型任务，无论我们后台执行的是CPU密集型任务还是IO密集型任务，都不用担心会卡住动画。

但是有一点需要注意。如果你的内容加载只花了100毫秒，出场动画做到一半的时候就把该干的事情干完了，这时候直接把内容展示出来，动画多半是要卡住了，因为新内容上屏一般是要重新测量和排版的。在一个非常流畅的动画中间卡了哪怕一帧，用户都会感觉像吞了shi一样难受。所以一般做法是在动画结束后再填充加载好的结果，一下子展示出来。

说了这么多，不知道你get到了没有。菊花是一种简单又常见的交互，其根本目的是使我们的界面交互更流畅自然。作为一名互联网从业人员，奉承用户体验至上，因此对于界面流畅的追求，应该是没有止境的。


## 2016-02-17-谁是我爸爸？

很多产品经理可能一直以来有这样一个疑问，这么多程序猿是怎么在一起撸代码的啊？

方法一：每个人都只写一个独立的模块，坚决不和其他程序猿有交集。（当然，这是活在梦里的想法）

方法二：一个程序猿改某个代码文件的时候其他也需要改动这个文件的程序猿先一边凉快去，等改完了再上。（听起来有点对代码进行排队轮x的意思啊...）

方法三：每个程序猿都按照自己的节奏改代码，最后把修改合到一起。

听起来，第三种方法比较靠谱，可是我们还需要依靠一个强大的文件版本管理工具才可以实现哦，这个就是svn。在开始协同撸代码前，需要在一个公共的主机上搭建svn的服务器，然后如同大厦奠基般需要创建一个svn的目录，自此，所有程序猿写的代码都需要提交到这个svn的目录上面，同时，所有程序员的代码修改都要以svn服务器上的代码为基准。

程序猿在svn上撸代码时有三个重要操作：更新，编辑冲突，提交。首先程序猿将服务器上的最新代码更新到本地，然后以此代码为基准在本地开始进行自己的修改，当自己修改的比较满意后，会想要将这些本地的修改提交到服务器上，但是由于修改的这段时间，别的程序猿也可能提交了一些代码，所以需要再次更新一下，看看这段时间别人修改的代码和自己修改的部分有没有冲突，这里svn提供了差异比对的功能，如果有相同部分的代码被修改了，svn就会在更新的时候给出提示，需要程序猿对这些代码修改冲突的地方进行检查并再次修改保证没有冲突后，才可以提交代码。（代码提交高峰期可能出现一提交就冲突，刚修改完冲突，一提交又冲突，这个才郁闷啊）

有的程序猿比较懒，会跳过更新，编辑冲突，直接进行提交，如果运气好，提交的文件在这段时间别人都没有修改过，那么就没有冲突，可以提交成功。但是如果提交的时候svn进行比对发现有文件被别人修改过了，这个时候会强制提醒程序猿走一次更新，编辑冲突的流程。一旦提交成功，svn服务器便会详细记录此次提交，并递增的分配一个版本号。

这里看到，svn有两个重要的功能，文件提交记录和文件修改比对。

程序猿们在协同编码的时候也会发生一些有趣的事情。一个人写代码会有bug，几个人同时写代码那就更容易出bug了，这样就会产生bug纠纷，就好比程序代码被轮x了，怀孕了，现在要找父亲了，可父亲是谁呢？被列为嫌疑犯的程序猿肯定都不希望孩子是自己的，不免会互相争论一番。传统解决方法就是慢慢调试，找到产生bug的相关代码，然后让写bug的程序猿去修复。但是让谁去调试bug呢，毕竟耗时又耗力？有人愿意担当还好，如果都觉得bug不是自己的不愿意去查bug，就又会陷入僵持了。这个时候svn就派上用场了：进行代码回退。svn服务器因为详细记录了每次提交，所以它可以完整的回退到任意一个版本上，那么就可以不断向前回退提交，然后运行程序，就可以找到究竟是哪次提交产生了这个bug，从而确认是哪个程序猿搞出来的bug。

同时根据这个理论，产生了bug追责究极大法-svn二分法，据说被此法追责到的程序猿能绕地球一圈。怎么操作呢？例如回退到版本号100上没有这个bug，回退到版本号200上有这个bug，那么就回退到版本号150上看看有没有这个bug，如果有就继续查版本号125，没有就查版本号175，以此类推，不断缩小追查区间，最终一定能确定到某一个版本号对应提交产生了这个bug，只要看看这个版本是谁提交的可以知道是谁的bug了。（当然svn的功能可不仅仅是这些哦，有兴趣的可以详细把玩一下）

古代妃子侍寝的时候都会有太监记录，这样日后怀孕了也可以推断出是不是皇帝的。

历史总是惊人的相似...


##  2016-02-18-给你点儿“颜色”瞧瞧-RGB通识

任何一个和用户有交互的产品，都离不开颜色，你是否在设计稿或代码中或者任何一个标识颜色的地方看到过，比如：#FF00FF、#169、#CCFF00FF。

先介绍下RGB的基本原理，RGB是Red、Green、Blue三种颜色的缩写，叫做三原色（小学的图画课应该是学过的）。三种颜色以最大亮度进行混合的话，会变成白色，哇，好神奇。

**整个理论以下图所示，假设在一个没有一点光的小黑屋里面，墙面展示为黑色，打开三束灯，分别红，绿，蓝，中间三种颜色交叉的地方，就形成了白色。也就是这些光会叠加产生效果，并混合成新的颜色。**

![](http://img.smyhvae.com/2016052293.jpg)

当前无论手机还是计算机，究竟支持多少种颜色呢？答案是都达到了真彩色的标准，也就是支持**1670w**种颜色，已经超过了人眼能够分辨颜色的极限了，1670w这个数字怎么来的，一会儿我们一起推算。

一般一种颜色用8bit表示，也就是01010101这样8个二进制数，2的8次方是256，所以一个颜色就分为256级，从0到255，共256级，0表示黑色（红灯还没打开），255标识红色强度最大（红灯已全部打开），这个时候255对应的二进制为11111111（你如果懂二进制的知识的话，应该很好看懂），这样RGB三种颜色分别用8为表示的话，一共24位表示一个颜色，例如111111111111111111111111，表示了RGB都是255级的亮度，也就是表示了上图当中最中间交叉的那个部分，也就是表示了白色。

但是二进制表示计算机读起来比较容易，因为计算机处理的就是01的字串，但是人可读性并不好，所以人类用16进制来标识二进制，会所见01字串的长度，16进制的意思就是逢16进1，但是我们的阿拉伯数字最大是9，那对于10到15的六个数字分别用A,B,C,D,E,F来表示，1111应该用F来表示，所以白色用16进制表示为FFFFFF，在web开发或设计中，前面加上#号标识颜色，所以你就看到了文章开头介绍的颜色表示法#FFFFFF这样的形式，在CSS设计中，如果FF这样重叠的数字，可以再进行一次缩减标识为#FFF，类似#CCFF00FF前面的CC是表示的Alpha通道，即标识的透明度。

RGB三种颜色分别有256级亮度，那三种颜色的组合数就是256*256*256=16777216，也就是2的24次方，所以分别用8位RGB来表示的颜色数量公用1670w种颜色，足以覆盖人类眼睛的辨识程度。

再介绍下经常提到的位深度的概念，在windows系统中，右键属性一张图片，看详细信息，如下图：

![](http://img.smyhvae.com/2016052294.jpg)

这里面的**位深度**就是指一张图片内的一个像素是用多少位来表示的，如我们刚才介绍的RGB分别是8位，位深度就是24，这种图片叫做RGB24，当然这个只是指RGB总共的二进制位数，也有可能是32位叫做RGB32，除了RGB的24位，剩余的8为表示Alpha通道，也就是透明信息，当前的交互和动画展现，如果没有Alpha，那做起来应该都是比较生硬的，一般都会用Alpha表示渐隐渐显的效果，在图片中是用来将图片中层叠的概念表达的更加清楚。

一般有如下几种RGB格式，包括RGB565，RGB24，RGB32，ARGB8888，最后一种的A表示Alpha，跟刚才介绍的RGB32差不多一个意思。

像RGB565这种用16位表示一个颜色，那只能表示2的16次方，表达出65536种颜色，但是好处是非常节省内存（因为一个像素只用32位一半的数据就能存储了），但是会损失图片的清晰度，一般用于纯色图片或这本身颜色就比较少的图片，会大幅减少内存的占用。

本篇基本介绍了计算机中三原色的原理，及你见过的一些陌生的颜色值的表示方法，几个简单的推理方法，介绍了下位深度的概念。当内存和图片质量发生冲突时，可考虑设计上用纯色或极其简单的颜色来设计，然后将图片用更少的位数表达，这样会大幅节省内存，前提是设计上能够保持简洁并能够达到设计效果。

**再跟大家算个帐，一张图片假设是1920×1080的大小，那这张图片至少要占用1920×1080×4字节的内存，也就是4Mb，也即一个带有alpha通道的图片，都会是这个大小，唯一有处理空间的是没有alpha，并且颜色比较简单的图，可以用RGB565来表达，这样可以减小一半的内存占用，对于程序性能来说，是不小的提升，难道内存，速度，性能指标不是产品设计当中的重要一环和重要的考量指标吗？**

颜色知识十分简单，希望以后不要对颜色感觉到任何陌生。

**评论区：**

问：1920×1080×4的这个计算是以RGB32来处理的吗？
答：是的。


## 2016-02-19-整天看用户埋点数据，知道数据是咋来的吗？


我们平时看到的报表复杂而多样，能够通过多种纬度的数据评估用户的使用习惯和对应功能的价值。然而这些报表是如何产生的呢？今天咱们就看看上报数据一步一步变成报表的大致流程。

所有上报的数据都是为了记录一次事件的发生或者描述一个状态，具体的上报数据可以设计为KEY-VALUE的形式或者数据组合的形式。KEY-VALUE的形式主要用来统计简单的计数类上报，如按钮点击的次数，某个选项的值等，KEY用来区分不同的事件，VALUE代表事件发生的次数、状态值等；数据组合的主要用来描述一个事件或者状态需要多种属性描述的场景，比如下载成功事件，描述这个事件的数据组合可能包括对应的下载地址、下载渠道来源、下载耗时等信息。

当上报数据设计好后，后续的工作才能正常开展。下面一步一步说。

### 1、埋点

所谓「埋点」，就是在正常的功能逻辑中添加统计逻辑。拿统计微信右上角「+」的点击次数为例，上报的数据可以采用KEY-VALUE形式，我们定义KEY为「CLICK_ADD_BTN」，VALUE的值为点击的次数。当用户点击「+」时，展示菜单的代码会通过按钮的「回调」（详见《聊聊同步、异步和回调》）来触发执行，程序猿在业务代码执行完后，又加上了统计代码，把「CLICK_ADD_BTN」对应的VALUE加1，「+」被统计到了一次使用。

### 2、上报

并不是每统计到一次事件或者状态就会发起数据上报，客户端统计到的数据会先暂时存储在内存或者磁盘上，当用户启动、退出应用程序的时候，或者在其他更合适的时机，将当前周期统计到的事件批量上报到服务器，这样做的目的主要是**考虑到与服务器多次建立连接的性能损耗**（详见《不得不知的TCP和UDP》）**和流量问题**（相同大小的数据分多次发送比一次发送要消耗更多流量），另外**客户端在上报具体的统计事件之外，还会将标识用户的ID一并上报，后续用于计算用户相关的数据如日使用用户和留存率等。**

### 3、后台记录日志

数据上报到服务器后，服务器会将客户端上报的原始数据存储到服务器的磁盘中。一般来说，**非强实时性的数据上报到服务器后，并不会立即参与计算，获得最终的统计结果**，比如一个功能的日使用次数，日用户数，日留存等数据，而是等到服务器负载较低的时间段利用预先配置的计划任务进行离线处理。这样处理的目的是为了节约服务器资源（钱），因为大家肯定不想因为计算统计数据而影响实时业务的处理效率。

### 4、计算&入库

报表中展示的数据，并不是客户端上报的原始数据，比如「+」的使用次数、使用用户数、日留存率这三组数据，都是通过对客户端上报的`「CLICK_ADD_BTN」`对应VALUE值的累加并结合上报用户ID二次计算得出的。

如果我们的产品达到微信这种日登陆数五六亿，那么每天上报的统计数据将是海量的，为了从这种海量的数据中计算出「+」的使用次数、使用用户数等信息，就需要用到「数据仓库工具」，比如当下流行的Hive处理工具，它基于Hadoop分布式系统基础框架，利用计算机集群的能力进行分布式计算。**当「数据仓库工具」计算出最终的结果后，计划任务会将结果（「+」的日使用次数、日使用用户数等数据）保存到数据库中，也就是「入库」过程**。「入库」后的数据才能与前端对接，组成报表展示系统。

一般情况下，**原始数据经过数据仓库工具处理后，对应的日志文件还会在服务器上保留一段时间（一般3~7天），以便追溯统计问题**，所以，如果发现统计数据有问题问题，一定要及时反馈给负责的程序猿，否则就会「死」无对证咯。

### 5、展示

当数据「入库」后，报表的展示就水到渠成了。**报表系统通过前端页面用户的输入获取查询条件，然后通过后台数据库查询获得结果，在前端展示出来。**

这里只是简述了埋点数据上报、统计的大致流程，每个过程中还有很多细节要解决，如后台日志乱码问题、客户端异常导致数据丢失等。一旦数据出现问题，经常需要联系各方人员定位原因。在此呼吁广大的产品大虾一定要关心、爱护为你做统计需求的程序猿，他们上辈子都是偷了蟠桃的孙悟空。

对咯，今天别忘了看报表哦。

**评论区：**

问：当用户点击「+」时，展示菜单的代码会通过按钮的「回调」（详见《聊聊同步、异步和回调》）来触发执行，程序猿在业务代码执行完后，又加上了统计代码，把`「CLICK_ADD_BTN」`对应的VALUE加1，「+」被统计到了一次使用。 对这个有点不理解，不应该是每点击一次就产生一条日志，然后后台通过计算对应日志条数来算点击次数的吗？直接在客户端就加1了？
答：为了节约流量，客户端会先在上报周期内对相同操作进行本地统计数据的累加，然后将累加值上报到服务器，由Hive进行全局累加等计算。

问：对于埋点，分为统计按钮类交互，同时还有统计访问量等，这块都可以跟你的SDK形成统一的呼应，对于PC和手机端，上传的方式也不同，可以再全一点哈。
答：埋点统计的数据可能会根据不同的用途分成多类，但从数据上报到报表生成的流程大体是一致的。


## 2016-02-20-Apple Pay来了，苹果用了什么黑科技？

Apple Pay进入中国了，又给大家找了一个合适的理由去剁手了，为了体验美帝的先进产品，花点钱也是值得的:)

Apple Pay的本质就是把手机变成了一张特殊的银行卡，使用普通银行卡消费是刷卡+密码，使用Apple Pay消费是刷手机+指纹，结果都一样，授权POS机可以我的账户上扣掉一笔钱，具体的资金流动都是由银行来处理。Apple Pay给我们带来的不同，就是刷卡时更快更爽的体验了。那么让你更爽的体验背后用了什么黑科技呢？

先来了解一些概念，如果你都听说过，那么请直接跳过~

「近场通讯 NFC」是一种短距离的高频无线通讯技术，允许电子设备之间进行非接触式点对点数据传输，在十厘米（3.9英寸）内交换数据。

「安全单元 Secure Element」是一块独立的电子芯片，它有自己的微处理器、存储和加密硬件，与手机操作系统和硬件是隔离开来的，只有授权的应用可以访问安全单元内的数据。

「Touch ID」是iOS的指纹识别服务，它通过指纹传感器，可以将单个指纹转化成一组数学表达式，可用于解锁一些机密信息，而且最重要的是，它只会对活体指纹进行处理，砍下来的手指是没用的。

「Secure Enclave」 是在Apple A7及后续版本的CPU中集成的一个安全执行环境，用来处理一些敏感信息，需要从Secure Enclave中传入传出的数据都是用特殊密钥进行加密传输的。

我们先从绑卡流程说起，当你扫描银行卡或者输入银行卡相关信息后，Apple并不会存储你的银行卡信息，而是先将这些数据加密，传输给银行。银行会先鉴定你输入的信息是否正确，如果正确，则以银行卡和绑定的iOS设备为一个组合生成一个唯一的设备ID和交易动态码密钥，然后系统会将其存储在「安全单元」，这样只有Apple Pay可以读取这个设备ID和交易动态码密钥。

然后就是支付流程了，在支付时，Apple Pay通过「NFC」与POS机通信，将收款商家信息及金额传入iOS设备，这时将iOS设备激活并请求用户使用「Touch ID」扫描指纹授权。当用户将手指放在「Touch ID」上，会根据当前用户的指纹计算出一个数学表达式，传入「Secure Enclave」，在「Secure Enclave」中对比已存储的指纹数据，如果一致，则认为是同一个用户，授权通过。授权通过后，「Secure Enclave」会通知「安全单元」生成一个只对当前这一笔交易有效的Token，然后再通过「NFC」将设备ID和交易Token发送给POS机，简单的说就是将一组一次性的账号密码发送给了POS机，POS机再将这组数据传输给银行。银行在收到交易信息后，通过设备ID能过查询到最初绑定到银行卡号，再对比Token的有效性，如果鉴定是一个有效Token，则认为这笔交易可以执行，然后进行资金处理，并通知POS机交易成功。

我们可以看到，在整个Apple Pay使用过程中，只有首次绑卡时，输入了你的银行卡信息，在随后的交易中，始终都是以设备ID作为银行卡的标识，所以即便你的iOS设备遗失或者遭到破解，也不能反向破解出你的银行卡信息。如果在交易中，有人窃听了Apple Pay与POS机的通信内容，试图复制这份内容伪装成用户再次交易，这也是不可行的，因为每次交易都有一个特定的Token，这个Token使用过一次之后，就不可以再次使用了，即便是重放一次复制的通信，也最终会被银行拒绝。

感叹一下，Apple在交易的每个环节真的是下了大功夫来保证交易安全，用Apple Pay可以放心的买买买了，可是还有一个比较大的问题在阻止我使用Apple Pay，那就是银行卡里没钱了...

**评论区：**

问：比较好奇活体指纹如何判断？温度吗？
答：是的，利用生物电、温度和湿度等“活体特征”。

问：跟支付宝比，唯一劣势就是不能查余额，没有余额宝，谁还喜欢把钱放银行卡呢？
答：它和支付宝还是差别很大呢，Apple Pay只是提升了刷卡体验，而支付宝是一套完整的支付平台。


### 2016-02-21-技术进阶：生产者与消费者模式

今天闲话少说，咱们先来看一个例子。

为了响应国家万众创业的号召，你开了一家外卖餐厅。餐厅里有一台电话，可以接受订单。有一台电瓶车，你平时就骑着去送餐（我们先假设菜都是事先做好的）。

一开始的时候，整个过程是单线程的，你首先接电话接受订单，然后骑电瓶车去送餐。送完餐再回来接电话，以此循环。我们假设接电话需要5分钟，送餐半小时，那么每个订单需要35分钟处理完毕，如果有两个用户同时打来电话的话，其中一个就要等待35分钟才能被受理。

可见单线程的模式体验非常差，机智的你自知此路不通，开始谋划多线程并发的方案。咱们借此机会先来复习一下多线程的知识。

多线程是一种并发执行的技术，主要目的是最大化的利用各种资源，提高程序整体性能。在我们计算机中，CPU、磁盘、显卡、网络带宽这些都是资源。比如拷贝文件的时候，主要在使用磁盘资源，这时候其他资源是闲置的，如果使用多线程，就可以把CPU、网络带宽资源利用起来，做到一边拷贝文件，一边打LOL。在上面的例子里，订餐的电话、送餐的电瓶车都是资源。之所以单线程的方式体验差，就是因为在使用电瓶车送餐的时候，电话资源一直是空闲的，这就是一种浪费。这里需要注意一点，在有些场景里，资源是单一的（比如单核CPU计算圆周率），这时候使用多线程是没有意义的，反而会因为线程之间的切换造成额外的开销。

作为一种改进，你雇了一个小伙子帮你送餐，你就专心在店里接电话。现在终于可以多线程并行工作了：一个线程用来处理送餐任务，我们暂且命名为送餐线程，一个线程用来处理下订单任务，叫订餐线程。二者可以同时工作。

但是问题也随之而来。很显然，送餐线程和订餐线程是相互依赖的，换句话说，没有订餐，哪里来的送餐任务呢？小伙子出去送餐了，这期间即使下了订单也送不了，那电话到底是接还是不接呢？这样的结果就是，两个线程互相依赖，互相等待，整体效率和前面单线程差不多。这就是所谓的并发协作问题，虽然系统支持并发，但是因为协作不好，效率一样低下。

如何解决这样的问题呢？很简单，只需要添加一个订单箱就行了。订餐线程不停的接受订单，然后把订单丢到订单箱里。送餐线程先检查下箱子里有没有订单，有的话就取出一个去送餐，以此循环。当然，因为订餐线程只需要5分钟就可以生成一个订单，而送餐线程需要半小时才能消化一个订单，必然会造成订单箱里的订单越来越多。这时你可以设置一个上限，比如最多20个，超过20订餐线程就不工作了，再有客户打来电话你就不要接了。有的时候生意不好，送餐回来发现没有订单，这时候大家就等着，直到有新的订单产生。这样一来两个线程各自为政，互不干扰，问题就解决了。

这就是生产者消费者模式的基本思想。在上面的例子里，订餐线程就是生产者，生产的是「订单」。送餐线程是消费者，消费的也是「订单」。这个模式的精髓在于，它定义了一个「缓冲区」，就是上面的订单箱，把生产者和消费者隔离开来，让他们不用彼此依赖，各自开开心心的干活。这个其实是很难得的，软件开发讲究「解耦」，最好的情况是大家虽然在一起干活，但是不用担心彼此的实现细节。对于生产者而言，它只能看到「缓冲区」，对于消费者，它也只能看到「缓冲区」，就是这个意思。「解耦」的代码很优雅，不光程序员看着舒服，还可以用来应对天天改需求的产品经理。今天开餐厅，「缓冲区」里是「订单」，明天改成开电影院，「缓冲区」里就是「电影票」，换汤不换药，他好我也好。

Talk is cheap，看个实际例子。现在很多APP，像微博、知乎、今日头条这样的，都有Feeds流。

![](http://img.smyhvae.com/2016052295.jpg)

当用户快速滑动Feeds列表的时候，会有很多图片加载出来。每一张图片的加载都会经历「网络下载」、「图片解码」、「图片显示」几个阶段。其中「网络下载」是把图片的原始数据从服务器上拉取下来，是一个非常消耗网络带宽资源的过程，其速度受限于你的网络速度（WIFI、4G要快些，2G、3G慢）。「图片解码」是把从网上拉取到的原始数据解码成可以显示的像素数据，例如从网上拉取到一张jpeg格式压缩过的图片，这一步会把这张图片解码成通用的图片格式，抹去jpeg编码的信息。这一步主要是由CPU完成的。最后图片显示，我们简单理解成一个GPU密集型任务。

现在，如果用生产者消费者模式来设计Feeds流的图片加载过程的话，我们需要两个「缓冲区」。一个是「原始数据缓冲区」，里面盛放着从网络下载下来的原始数据。对它而言，生产者是「网络下载」线程，消费者是「图片解码」线程。另一个是「图片缓冲区」，里面盛放着解好码的图片，对它而言，生产者是「图片解码」线程，消费者是「图片显示」线程。整个过程一环扣一环，但是又相互独立：对于「网络下载」线程来说，它只管拼命下载，下载完一张就丢到「原始数据缓冲区」，然后去下载另一张；对「图片解码」线程来说，它只管消费「原始数据缓冲区」里的原始数据，然后生产解码好的图片放入「图片缓冲区」。「图片显示」线程则只管消费「图片缓冲区」中图片。整个过程最大化的利用了CPU、GPU和网络带宽资源。

有一个细节需要注意。如果你的网速很慢，「网络下载」线程运行缓慢，但是「图片解码」线程速度很快，不一会儿「原始数据缓冲区」就空了。这时候「图片解码」线程就会一直停在那里等待，这个等待会不会造成CPU占用率100%呢？不会的。你要把CPU的「等待」和「死循环」区别开来。虽然「死循环」也可以实现这个功能，就是一直不停的询问缓冲区有没有新的数据，但是效率很低，又不环保。现代操作系统都支持「等待」、「唤醒」，本质上是利用CPU的中断机制，可以做到只要缓冲区里又有了数据，马上通知消费者。这也是之前讲过的轮询和回调的一种简单应用。 

生产者消费者模式在计算机领域还有很多应用的实例，很多多线程并发协作的问题都可以用它解决，是程序员的必修课之一。


## 2016-02-22-如何让家里畅享360度无死角的wifi上网？

现在手机几乎成了生活必备品了，走到哪里先找wifi也成一种习惯了，甚至wifi信号强弱的变化都会时刻牵动自己那颗与永不断线的心了（同意的举手）。但是在家里玩手机或者pad的时候难免会遇到一个窘境：房子越来越大，房间越来越多，但是来开通网络的师傅只会给家里的一个网孔开启上网通道。这样，路由器就只能放在附近的地方，但是路由器的穿墙能力有限，稍微远点隔墙地方信号就很差，上网体验自然也是糟糕。

产品经理总是在考虑如何改善用户体验，今天我们就自己动手来改善一下自己家里的wifi上网体验。

先不要那么急功近利的想知道方法，我们先来了解一下相关的一些网络知识，日后装B可用。说到wifi那就离不开路由器。走到哪里都先找wifi的你了解给你提供wifi信号的路由器吗？我们来了解下wan，lan，wlan吧。

现在一个路由器的标准造型就是一个盒子，屁股上几个网线孔（我很想用另外一个词，但是想想还是算了），外加天线。天线我们都知道是用来发射wifi信号帮助无线设备建立局域网连接的，就是常说的wlan。但是那几个网线孔的区别是啥呢？仔细观察一下会发现其中一个孔和其它几个还是不一样的，颜色上有区别或是标上了wan的字样（其它几个孔一般都是1，2，3，4），这个wan端口是用来连接外网端口的（就是开网师傅开的那个网口），其它几个端口我们称之为lan端口，用来连接局域网里面的有线设备的。通过lan或者wlan连接到路由器上的设备都在一个局域网下了，它们如果想和外网通讯都必须通过wan端口。

如果路由器wan端口空着不用，再关掉它的DHCP服务（主要用来给连接设备分配ip的），那么路由器就变成了一个交换机，可以和连接它的设备收发数据，但是不能分配ip。平时通过路由器上网一般都是通过路由器拨号，其它设备连到lan端口上网，共享带宽。如果想通过交换机上网，那么每个连到lan端口的设备需要独立拨号上网才可以，这是设备ip就不是路由器分配的了，而是网络商分配的，虽然多个设备连到一个交换机上，但是每个带宽是独享的哦，这种方式合租的童鞋们可能有需求。

基于这个原理，如果家里有两台路由器，一台可以当作普通路由器正常使用，而另一台则可以关闭掉它的DHCP服务，让它退化成一个带wifi功能的“交换机”。这样只需要将这个“交换机”放到屋内信号不好的地方，再用一根超长的网线将两个路由器的lan端口连接起来，连接到“交换机”上的设备就可以间接的通过另一端的路由器分配的ip上网了，就可以实现更大范围的wifi信号覆盖了。哈哈，屌丝可以这样做，产品经理都是有洁癖的，怎么能忍受这种事情，我们需要更优雅的解决方案。

那么大杀器电力猫来了，电力猫是个神奇的东西（不知道的可以自行百度），简单来说它可以将网络信号以载波的形式通过电力传输，这个叫电力载波（PLC）。（图是借的）

![](http://img.smyhvae.com/2016052296.jpg)

电力猫通常是一对（后面用A，B代替），怎么用呢？我们将正常的路由器从lan端口分一条网线连到电力猫A上，然后将电力猫A插到电源上，再到我们需要放置“交换机”的房间插上电力猫B（应该每个房间都有电源插孔吧），再用一根网线连接电力猫B和“交换机”的lan端口。这样，我们通过电力猫将电线改造成了超长的“网线”，剩下的就不用说了，连上wifi享受无死角的信号吧。

其实电力猫并不是什么新鲜玩意儿，但是在国内普及程度实在太低了，没玩过的可以试试，也不贵，百十来块就能整一对儿。PS：wifi中继器其实也可以扩展wifi信号覆盖，只是中继器也不能离路由器太远，电力猫则没有这个问题。

生命在于折腾嘛...

##  2016-02-23-3个软件开发中不好理解的名词

每天写这个公众号，其实也在做产品。

今天的题目来源于后台留言，人家是十分重视用户反馈的，今天讲讲这几个大家提问的几个不好理解的词。

### SDK

SDK是SoftWare Development Kit的简称，中文叫做「软件开发工具包」，SDK是一整套工具的集合，这套工具是基于当前系统或者平台的开发工具。鲁班离不开刨子、锤子、斧子等工具来做一套家具。程序员也离不开SDK来开发应用程序。比如家里的工具箱就是「SDK」。

例如：在Android平台上开发Android App，我们必须从官网下载Android SDK，然后利用这套SDK提供的API来调用系统能力，比如我通过Android SDK来调用系统屏幕一直「常亮」的功能，如果没有这个工具箱提供的这个工具，那巧妇难为无米之炊，程序猿可能会大叫一声「臣妾做不到啊」。

再例如：在产品合作当中，常常会面临这样的场景，我们团队不擅长做视频，但项目中又必须加入视频播放场景，另一个团队却是视频领域积累多年的专业团队，这个时候，合作基本都会基于SDK级别，也就是视频专业团队要为我们做好一个视频SDK，我们基于这个SDK，只要调用其SDK封装的极其简单的「播放」「暂停」接口，我们团队就可以完成视频播放这样复杂的需求场景。注意哦，这种是基于SDK的合作，也就是对方提供给我一个能力和工具集合，我只负责调用，而不用关心其具体实现。

再再例如：工作中，利用已有能力，不去重复创建轮子，是一种捷径，这种「轮子」绝大多数都封装成了SDK，希望工作中你要多积累一些已有能力，并尽量利用。

### API

API是Application Programming Interface的简写，中文称为「应用程序编程接口」，简单理解一个API就是一个函数，这个函数提供了某一样特殊的能力，比如一个API是用来吐出某一个地理坐标下天气的能力，这就是一个API，API也常被成为API函数。API通常暴露了一个系统的某一项能力。

在应用开发中，系统暴露的能力是以SDK的形式发行交给开发者的，所以SDK中一般封装了很多API，这些API就对应着系统或平台的能力。

API又分为「公有API」和「私有API」，公有API是系统以SDK形式暴露出来，对所有开发者可见。私有API一般是系统内部使用或者仅限于系统自带的一些应用程序使用，不允许应用程序开发者使用的，这种一般对应于一些敏感的能力，比如认为此API可能被滥用，造成用户体验下降或此API对其他应用程序可能是危险的，前些天不就有些厂商的App利用了苹果公司的私有API被下架了嘛~

公有API随便用，都是系统授权的。私有API谨慎使用，系统未来可能会不再支持或触犯厂商规则。

### 架构

架构指一个软件系统的结构。一个软件系统或者系统中的某一个模块，都会涉及到架构，架构清晰表示软件结构良好，如果你去过国企的那种大厂房，吊车在什么位置，流水线在什么位置，工人的工作台在什么位置，成品下线后，怎么走入到包装环节，这其实就是一种架构设计。

架构就是考虑了一个软件系统的所有设计要素后，梳理清楚模块划分，以及模块之间的关系，所形成的类似刚才「厂房」的一种结构设计，在「厂房」的例子中，是如何布局所有的工具和人员，在软件中是如何布局好各个模块的作用和相互关系。

面向对象的程序设计，是设计一个好的架构的一种好的思维抽象方法和程序设计方法，它的目的是为了一个好的架构服务，再谈到架构，你就把架构想象成一个大厂房，程序员要在这个厂房里面把所有的部件都摆放好，这么理解应该是可以的。

以后再跟大家谈谈「控件」「组件」「框架」的一层层的升级，都分别指什么，相信还有一些同学不清楚。

**评论区：**

问：反正我一直就简单粗暴的理解成SDK是API的集合。
答：绝大多数情况是，但一些系统调用是没有封装为sdk的

问：就是说SDK是一个工具箱，里面有面向系统的各种工具集合，而API是工具箱里面针对某个功能的工具。不知道这样理解对不对？
答：基本对的，只是有的api不是有sdk封装的，是系统直接提供的。

问：佩服啊，解决了俺产品狗们多年来心中的疑惑。请问您坐标在魔都吗？
答：不在，不在大城市，买不起房子。


## 2016-02-24-如何抱上微信的大腿？——说说授权登录的那些事儿

当前市面上流行的手机游戏，很多都会用到微信的授权登录系统，就是这个：

![](http://img.smyhvae.com/2016052297.jpg)

你肯定点过这个「确认登录」按钮，而且不止一次。然而，你没有想过，在微信里，这个功能是如何实现的？为什么不用我输入用户名和密码，游戏app就获得了我的微信好友信息？它安全吗？带着这几个问题，我们开始今天的探索之旅。

在进入技术细节前，我们先来看一个栗子。

从前有个大户人家姓白，富可敌国，家中收藏了大量的奇珍异宝。有一天，当地博物馆的馆长找到白先生，想为白先生在博物馆设立一个展台，每天借白先生家中的一些收藏品放在展馆展示。白先生觉得这个主意不错，但又不想把库房的钥匙给馆长，就让馆长去联系库房商量宝物借用事宜。库房跟白先生确认这件事之后，给了馆长一蓝一红两张令牌：蓝色的令牌上标注着使用日期，在有效期内，馆长可派人用蓝色令牌随意借还张家的宝物；当蓝色的令牌失效后，馆长需要派人带着红色令牌到库房这里换新的蓝色令牌。馆长拿到这两张令牌后，欣然离去。

上面的栗子，简单描述了移动应用微信登录的授权流程，以及授权后用户数据的获取方式（使用令牌），文中的「白先生」就是用户，他授权「馆长」（三方应用）使用自己存放在「库房」（微信服务器）中的宝物（用户数据、关系链等）。「蓝色令牌」是「库房」给「馆长」借用宝物的通行证，有一定的时效性，这是由于**「蓝色令牌」使用的较为频繁，万一「遗失」或者「被盗」，造成的损失也有限**。「红色令牌」则是「馆长」更换「蓝色令牌」的凭证。

**微信授权登录系统基于OAuth（发音：偶奥斯）2.0协议标准**，它提供了一套简单，安全的交互流程，让三方应用可以在不知道用户微信登录名和密码的情况下，访问用户在授权方服务器上的私密数据和资源。**当三方应用需要使用微信授权登录功能时，需要先在微信开放平台获得对应的AppID和AppSecret**。下面，我们看下微信授权登录系统的授权流程：

1、用户请求三方应用用微信号登录。

2、三方应用使用AppID向微信开放平台（客户端）发送登录请求。

3、客户端加载授权页面，请求用户确认。

4、用户点击确认按钮。

5、微信客户端拉起三方应用，并将临时授权码（code）传递给三方应用，予授权完成。

6、三方应用使用临时授权码（code）、AppID和AppSecret，通过https协议向微信开放平台（服务器）请求access_token。

7、服务器返回`access_token`和`refresh_token`。

`access_token`就是从服务器获取用户数据的「蓝色令牌」，`refresh_token`则对应「红色令牌」。`access_token`的有效期是两个小时，refresh_token的有效期是30天。

通过分析授权流程可以看出，**要想获取`access_token`，需要同时具备临时授权码（code）、AppID和AppSecret这三个信息**，其中临时授权码由用户点击「确认登录」按钮后由服务器生成，它的有效期只有几秒，所以三方应用只要妥善的保管AppSecret和access_token，整个流程的安全性是值得信赖的。

另外，微信已经提供了该功能对应的SDK，使得三方应用的接入工作变得十分简单。

微信等社交软件，经过几年时间苦心经营建立的关系链，其他的三方应用则只需要简单的接入就可以共享这个巨大的宝藏。然而，当大家都沉浸在这个宝藏中时，微信的生态圈也越来越壮大了。子曰「大家好才是真的好！」，古人诚不我欺！

PS：有朋友问作为一个加班专业户，怎么还有时间写文章？其实只要你认为当前在做的事情有意义，一直坚持下去并不难。至于时间嘛，就像乳沟，挤挤总会有的，这不今天一不留神挤到凌晨2点了。

**评论区：**

问：不用refresh_token为什么不可以？
答：可以，refresh_token是可选的。


## 2016-02-25-你了解计算机时间吗？小心肾6变砖6

最近Apple老是搞出一些大新闻，感觉每天都能上头条，请问汪峰现在在哪里？即使你不关心「Apple Pay入华」，也不在乎「库克拒绝给FBI开后门」，但是这条「iPhone时间调到1970年1月1日将会变砖」应该要引起你的重视了。今天的封面少年就以身试法体验了一下这个iOS的新特性（bug），效果棒棒哒:)

究其原因还得从Unix时间说起。在我们生活中，时间的表示方法有多种，有的人喜欢这么写「2016/2/24 23:41:34」，老外们喜欢这样写「Wed, 24 Feb 2016 15:41:34 GMT」，而在程序中只会写成「1456328494」这样。这个就是Unix时间，它是用一个正整数来表示一个时间与基准时间（UTC时间的1970年1月1日0时0分0秒）相差的秒数，而「1456328494」表示我写文章的时间点距基准时间已经过去了1456328494秒。

而iOS这个坑是怎么趟上的呢？据砖家分析，这是因为一群活着东8区的人类，把系统时间改成了基准时间（1970年1月1日0时0分0秒），这个时候的时间戳是0，但是因为东8区要在UTC时间上加8个小时，那么算下来系统的Unix时间就是负8小时。可是Unix时间都是正整数啊，如果给一个负数，数字就会变成从最大的正整数倒着往下走了（假设你懂二进制），那么在32位的机器上的负8小时就会变成「2038年1月18日19时14分07秒」，这种情况系统还能应付，可是到了64位的机器上就变成了「292,277,026,596年12月4日7时30分08秒」，这个时候再启动手机，系统就懵逼了，完全搞不定这么久远的年代啊，结果就变砖咯...

你也许会笑了，又不是TFBoys这种土豪，谁会去设置这种奇葩时间呢？如果我说，存在某种手段，可以悄悄的把你手机时间改到1970年，你是不是就慌了呢？这种手段就是依赖了手机上的时间同步机制。

NTP（Network Time Protocol）网络时间协议是流行的一种同步时间的协议，iOS上也用它来同步时间。我们在网络上部署了一些标准的时钟服务器，其它设备都通过NTP协议来计算自己的时钟与标准时钟的误差，再调整自己的时钟来弥补这个误差，这样设备上的时间就和标准时间一致了。

![](http://img.smyhvae.com/2016052298.jpg)

简单学习一下NTP的原理，图中Device A是我们的设备，Device B是标准时钟服务器，同步流程如下：

1. Device A发送一个NTP消息给Device B，这个消息包含了它离开Device A时的时间戳，该时间戳为10:00:00 am (T0)
2. 当这个NTP消息到达服务器Device B时，Device B会加上自己的时间戳，该时间戳为11:00:01 am (T1)
3. 然后再将这个NTP消息返回给Device A，当该NTP消息离开Device B时，再加上Device B的时间戳，该时间戳为11:00:02 am (T2)
4. 当Device A接收到该NTP消息时，Device A的本地时间戳为10:00:03 am (T3)

这样我们可以算出两个时间，一个时间是消息往返两个设备的时延Delay=(T3-T0)-(T2-T1)=2秒；另一个时间是 Device A相对Device B的时间差offset=((T1-T0)+(T2-T3))/2=1小时。

如果你手机连接的局域网上有一台时间服务器，它将自己的时钟设置为1970年的那个基准时间，然后将这个局域网内的所有NTP协议，都劫持到这台服务器上，那么其它使用了自动同步时间的设备，时间都会变成1970年。如果恰好这个时候你重启了手机，那么恭喜你，你得到了一块砖头。


##  2016-02-26-上帝视角看支付宝隐私门

有些同学不知道我在说什么事儿，我先介绍一下。大体上是，支付宝Android版被人发现在不需要相机的时候，也调用了系统开启相机的某些接口。有人半夜听到了咔嚓声，也有人说流量飞涨，于是就怀疑支付宝在后台偷偷拍照并上传到服务器。一传十十传百，就成了「支付宝隐私门」。

后来支付宝出面解释，说是后台打开相机只是为了提前申请权限，防止用户在真正使用相机的时候（比如扫二维码）被系统的权限申请提示框打断流程。

先不说谁对谁错，很多同学在围观的时候，把以前的老账也拿出来一起算了，什么支付宝你还欠我一张敬业福啊，支付宝APP拖慢手机运行速度啊，甚至把支付宝抄微信界面的事儿也搬出来洗刷一番。这就比较LOW了。咱们作为新时代的互联网人，对事不对人是基本的素质，对事要有证据也是基本的原则，不论对错先开喷，跟咸鱼有什么区别？

那么正确的围观姿势是什么呢？当然是当你洞悉一切、明察秋毫之后，站在上帝视角，笑看众生你撕我我撕你啦。

整个事件的争论点在于，支付宝在后台到底是真正的「申请权限」还是「偷偷拍照」。我们先来了解一下权限是个什么东西。

Android系统和其他系统一样，有各种各样的权限。权限就是用来限制APP使用一些系统认为敏感的功能的，我们之前的文章《聊聊Android的系统权限》给大家介绍了各大APP常用的一些权限，这里摘抄几个。

- 网络访问
- 读取手机状态和身份
- 修改或删除外置存储中的内容
- 相机 
- 开机启动

程序员写的代码，最终是要运行在Android系统里的。程序员想使用手机的一些功能，小到显示一张图片，大到拍照发短信打电话，都要让Android系统来帮忙完成。这个过程就叫做「调用系统接口」。然而，系统接口不是你想调，想调就能调的，调用的第一步就是权限检查。

在原生Android系统上，起码在6.0棉花糖以前，整个权限检查还是相当粗放的。为什么这样说呢？我们来看一下一个APP使用相机拍一张照片需要做哪些事情。

1、把自己需要的权限写在一个叫「程序清单」的文件里。这里我们需要相机权限，就要写< uses-permission   android:name =”android.permission.CAMERA”  />。看不懂不要紧，这只是一种书写格式，是为了方便计算机阅读的，咱们改天详细讲讲。

2、把这个文件打包到你的APK中。

3、用户从市场上下载了你的APK，在安装的时候，会弹出一个权限说明，这些就是你「程序清单」文件中的权限，系统把它翻译成人话给用户看。

![](http://img.smyhvae.com/2016052299.jpg)


4、用户看到这些权限后，只有选择安装还是不安装的权利。但是大多数用户会选择安装。

5、选择安装就代表用户认可你申请的这些权限，以后你在使用相机的时候，只需要「调用系统相机接口」就可以了。系统自然会放行。

等一下，我们再看支付宝，在整个过程中，根本没有所谓的「预先申请权限」这个说法啊。只要你安装了支付宝，就代表你同意了它的一切权限申请，在程序运行的时候应当是畅通无阻的啊。

问题就出在这是在Android系统上。众所周知，Android系统由Google开发，代码开源，人人都可以七改八改编个新系统出来。MIUI、Flyme、还有国外的CM都是这样改出来的加工品。它们率先意识到了原生系统在权限管理上的不足，主动帮Google填了这个大坑。例如在MIUI上有一个权限管理中心，APP申请的权限都记录在这里。每次APP想「调用系统接口」实现一些功能的时候，都要用户确认才能继续进行。当然用户也可以选择一直允许，这样以后APP要做同样的事情，系统就会统统放行了。

后来Google还是耐不住寂寞，终于在6.0系统上补全了这个功能，然而6.0系统的市场占有率，到现在都，额，不值一提。

不光这些亲生的领养的Android系统拥有加强版的权限管理，各种安全管家、安全卫士们，在获得了ROOT权限之后，也可以做同样事情。它们又是如何做到的呢？

原来，「调用系统接口」虽然只几个字，但是从代码上来看却有很大学问。我们之前讲过，APP运行在一个封闭的进程里，它要与Android的系统进程进行交互，就必须突破进程的隔离壁垒，实现进程间的通信。在Android上，提供了一种叫Binder的通信机制来做这个事情。

我不打算长篇大论讲Binder，毕竟就算是「给程序员讲技术」，也不一定能一两篇文章讲明白。我们还是主动下降一个维度，简单讲一下过程吧。

现在我们有两个进程，一个是APP进程，一个是相机进程。APP进程要发起相机预览请求（就是拿到摄像头拍到的画面），相机进程则要对该请求作出响应。二者互相隔离，谁也不认识谁。

第一步就是让他们找到彼此。这个不难，系统会有一个总管（第0号进程，谁都认识它），手里掌握着所有可以提供服务的进程的信息。APP进程会首先找到它，然后通过它认识相机进程。

第二步呢，就是让他们能够互相传递数据。他们找到彼此之后，选择了一个双方都能找到的地方——「内核空间」来交换信息。APP进程先把请求数据托管在内核空间，然后由内核空间通知相机进程去拿数据。相机进程收到通知后，就会去内核空间拿到请求数据，解析之后作出响应。

所以，各种管家、卫士们在拿到ROOT权限之后，就可以驻扎到这个内核空间，进行权限检查了。当它们看到APP端有数据过来的时候，拆开包裹一检查，发现是请求相机预览的，这时就会弹一个提示框，让用户做选择。如果用户认为可以，就放行。用户拒绝，就伪造一个假数据直接打发APP。

![](http://img.smyhvae.com/20160522100.png)

从这个角度来讲，支付宝要么每次扫码的时候，让Android系统或者管家们弹一个提示框，要么一开始运行的时候，让用户选择「一直允许」，免去一次次设置的麻烦。那么为什么支付宝要选择后者呢？要猜测其动机，可以从这个角度去考虑。其实iOS访问相机也是需要授权的，为什么iOS不存在所谓的「提前授权」问题呢？大家都知道，iOS系统就那么一个，即使授权不通过，系统给你的回复也是统一而明确的。但是Android就不行了，Android碎片化严重，包括各种管家、卫士们在拒绝你的权限请求的时候，根本没有一个统一的返回格式，甚至一声不吭直接扔掉了。所以APP就需要不停的「轮询」来检测自己的权限请求有没有成功。这样做必然会造成请求等待，还不如放到APP启动的时候在后台来做。

很遗憾，我并没有回答如何区分「申请权限」和「偷偷拍照」二者如何区分，因为需要进一步的证据，比如可以把此时的内存状态原封不动的取出来看看没有图片信息，或者网络抓包看有没有上传图像数据。

至于产品流程和用户知情权之间的权衡，我相信作为产品经理的你肯定有自己的判断。作为程序员，只有一句话：叔叔，这锅我们不背！


## 2016-02-27-你的包裹到了——说说网络数据传输

我们都知道网络中有大量的数据在传输，看网页，聊天都离不开网络数据传输，可是在网络中传输数据究竟是啥样呢？在我们收到一份网络数据之前，我们先来看看我们是如何收到一份快递的。

要致富先修路，首先我们需要有条路，无论这路是地上的，海上的还是天上的。如果你网购的是一个杯子，卖家发货时会对杯子做简单的包装，然后送到快递公司，快递公司会对物品再包装一下，然后经过各个物流中转站，走高速，坐火车，乘飞机漂洋过海来看你，快递员将包裹交给你签收后，你拆开快递公司的包装，再拆开卖家的包装，终于拿到了属于自己的杯具。

这就是网络数据传输在现实世界的映射。我们来看看网络知识体系中不可不看的一幅图：

![](http://img.smyhvae.com/20160522101.png)

如果把买的杯具看做数据，那么物理层就相当于现实中的路，是数据传输的介质，如果没有路就谈不上寄收包裹了。

有了物理层建设好的基础设施，数据链路层就像在物流的两个中转站运送的交通工具，它要在物理层的基础上尽可能保证包裹能够正确的运送，可以想象那些跑在路上装满包裹的卡车吗？

网络层就好比物流公司，这个层次站得就比较高，看得比较远了， 而中间节点的路由器就好比物流中转站 ，要把包裹寄到目的地可不是派辆车无脑在各个中转站送来送去就完了，从广州寄往上海的包裹，要是最后送到北京了可不是什么好事，物流公司得知道如何利用当前的各个物流中转站，避开拥堵，选择尽量短的路线来运送众多包裹，一堆包裹送达到一个物流中转站后，会按照目标地点分类，物流公司做了宏观把控后，这些包裹就被重新分开装配，再分别被运送到各个其它的中转站。

最后在物流公司的调配下，包裹最终送到了你手中。但事情还没完，收到包裹还有传输层的事呢，传输层主要用来决定如何处理差错的，现实中如果你买的杯具却收到了餐具，你跟卖家沟通后，卖家会让你寄回去，然后重新给你寄杯具，只是网络世界的卖家比较大方，数据包错了，买方直接扔掉，卖方重发就好了，传输层有两个比较重要的协议TCP，UDP，可参考之前的文章《不得不知的TCP和UDP》。再上面三层也跟目标收到数据后怎么处理相关了，这里就先不展开说了。

可能你会问，我知道这些有什么用呢，哈哈，说不定哪天物流公司搞了套优化的配送体系被用到现在的网络模型中了，又或者网络协议有了革新，被用到各个物流公司，谁知道技术中的思维在产品中又会发挥怎样的效果呢？

<br>

## 2016-02-28-名词解释：控件、组件、框架

前几天，写了《3个软件开发中不好理解的名词》，矮油，那天阅读量不错哦。

也许是：

这篇文章真的满足了广大用户对一些计算机词汇混淆或不理解的需求？

还也许是：

题目上用了“3个×××××”这样的运营小技巧？我是专门跟人家跪添请教，砖家说：“题目带数字，并且放在最前面，用户更愿意打开，因为说了‘3个’这样的量词，让用户以为，他/她可以掌控住自己的时间，不会让用户觉得陷入一篇文章，产生巨大的压力”，我打心眼里是希望你轰轰烈烈「陷入」的，哈哈。

还还也许是：

星期二的原因？从后台数据来看，星期二阅读人数一般都比较高，可见，你们周一的状态普遍比较低迷。数据上还有一些特点，等我自己设定的「用户数KPI」完成的时候，我就告诉你们，哈哈。

到底是啥原因，不猜了，假设是真的有需求~

今天再介绍下「控件」「组件」「框架」这几个程序员经常在一起叨逼叨（这里是对程序员在技术上热烈讨论表示尊敬，绝对不是鄙视）的词。

这几个词的本质是程序设计中的「粒度」问题，且听哥娓娓道来~

### 控件

任意打开一个App或者一个网页，应该很常见输入框、按钮、单选框、复选框等等的控件，控件表示程序设计中最小粒度的可复用可编程的部件，就像化学周期表中的每个元素一样，「氢氦锂铍硼」都是不可分割的，但是它们可以组成的物质不计其数，难道一个网页或一个App不是由这些最小的控件组成的吗？

### 组件

有一个「组」字，可以简单理解为是一个组合功能的控件，功能比控件要复杂，可能存在比较复杂的交互。说起来太拗口了，还是说说实例，比如TabHost（脑补下进入微信的界面，最下面有4个按钮），它具备了加入若干个页面，并定义了按Tab切换的交互，是由最基本的按钮控件和其他控件一起组合而成，这种称为组件。系统也提供很多组件，它包含了许多行为和属性，相对于控件，控件的只能更单一，更细粒度。当然你说把组件叫成控件可以不？也没有什么不可以，可以把它理解为功能复杂的最小单位。

### 框架

由很多控件和组件组装在一起，并且能够在某一领域里面完成一些列操作，理解为一把「瑞士军刀」，能够把某一领域内的问题完成的干净漂亮。比如：jQuery框架是对原生js的封装，提供更方便快捷的JS操作。J2EE框架提供了一套企业级的网站解决方案。LAMP提供了一套利用开源系统搭建网站的框架。如果你接触过刚才提到的技术，就比较容易什么是框架了，有的框架提供了更友好、更快捷、更丰富的解决方案。有的是将各种技术组合，来使其对解决某一类问题（比如搭建网站）更加容易使用和快捷。

在茫茫的大海上，有一只海燕哪~（不好意思，跑偏了，我是宋小宝粉丝）

在茫茫的大海上，一个由航母、驱逐舰、潜艇组成的海军战斗群正缓缓向主席台走来，这一航母编队能够实现「海上预警」「海上侦查」「编队航行」「武装打击」「抵御海盗」等多种科目演习，这就是一个框架，能完成很多种战术动作，针对各种情况都有解决方案。这个航母编队的每一艘船都有「×××口径火炮」20门，这个火炮装备在多艘船上，是可复用的，是组件。这个火炮上面的发射管，装填器，导火索等等都是最基础的控件。


**评论区：**

问：之前了解了架构，今天懂了框架。然后又混淆了这俩有什么区别…还有，构架
答：架构是你自己的系统结构，也就是你作为程序员编程设计的结构，框架是别人设计的，让你使用的。

问：那组件和sdk啥关系？
答：组件是sdk的一部分功能和能力。


## 2016-02-29-讲讲那些被人选择性忽略的技术——Wi-Fi篇

现在的年代，是一个无线网络高度普及的年代。在我们身边，无时无刻不充斥着各种无线信号，今天咱们就说说这些无线信号中的一种：Wi-Fi。

Wi-Fi的中文名是「无线保真度」，是Wi-Fi联盟持有的一个品牌，这个联盟没别的事儿，整天瞎忙活就是为了解决各个符合IEEE 802.11标准产品间的联通性问题。所以，Wi-Fi对应的技术，就是IEEE 802.11标准。关于IEEE 802.11标准的演进历程，可以看下图：

![](http://img.smyhvae.com/20160522102.png)

上图中802.11ac标准就是我们日常所说的5G网络，它的理论传输速度可以达到6.93 Gbps，目前市面上的5G路由器标称的传输速度也在1Gbps左右。不过由于5G网络的频带较高，所以它的「穿墙」能力略差。（如需解决「穿墙」问题，请参阅《如何让家里畅享360度无死角的wifi上网？》）

一个无线网卡，和一个无线网络接入点（Wireless Access Point）就可以组成一个Wi-Fi系统。我们家中使用的无线路由器，就是有无线AP功能的路由器。

在Wi-Fi网络中，无线网卡与无线网络接入点建立数据连接之前，要经历两步：SCAN（扫描）、Authentication（认证）。

![](http://img.smyhvae.com/20160522103.jpg)

拿我们的家用路由器举例，当我们在路由器的设置界面配置了「启用SSID广播」后，需要接入Wi-Fi网络的设备（例如手机等）就能识别到路由器创建的无线网络。识别的手段有两种:主动扫描与被动扫描。

主动扫描：接入设备向自己支持的所有Wi-Fi信道上发送广播，询问对应的信道上是否有无线接入点。当无线路由器接收到接入设备的广播后，就会对接入设备做出回应，并告知对方自己的SSID、支持的认证方式、加密算法等基本信息。

被动扫描：无线路由器定期的向自己所在的信道上发送广播，广播的内容与主动扫描中的响应大致相同，当接入设备收到广播后，便「发现」了无线路由器建立的Wi-Fi网络。

当接入设备确定要接入路由器的Wi-Fi网络时，就进入了802.11标准的认证流程。

即便Wi-Fi网络没有设置密码，也会执行认证流程，叫做「开放系统认证」。整个认证过程大概是这样：接入设备说「你好！」，无线路由器说「请进！」。（什么人你都往家里领啊？）

设置了密码的Wi-Fi网路，认证流程会稍微繁琐，如下图：

![](http://img.smyhvae.com/20160522104.jpg)

细心的老朋友可能会感觉整个过程似曾相识，没错，整个过程类似于HTTPS连接过程中对称密钥传输流程的简化版（详见《红包抢的好，钱包也要捂紧了——HTTPS技术》），在这里就不多冗述了。

成功认证后，接入设备就可以在Wi-Fi的海洋里无限畅游了。


